
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Concepts">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="持久化卷" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>持久化卷 | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="持久化卷" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/concepts/storage/persistent-volumes/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/concepts/storage/persistent-volumes/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/concepts/storage/persistent-volumes/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"持久化卷","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/concepts/storage/persistent-volumes/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/concepts/storage/persistent-volumes/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/concepts/storage/persistent-volumes/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/concepts/storage/persistent-volumes/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Concepts</h1>
  <h5>Detailed explanations of Kubernetes system concepts and abstractions.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" class="YAH">CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="概念" href="/docs/concepts/"></a>
    
  

  
    <div class="item" data-title="Overview">
      <div class="container">
        
  

    

    
      <a class="item" data-title="认识 Kubernetes?" href="/docs/concepts/overview/what-is-kubernetes/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 组件" href="/docs/concepts/overview/components/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes API" href="/docs/concepts/overview/kubernetes-api/"></a>
    
  

  
    <div class="item" data-title="Working with Kubernetes Objects">
      <div class="container">
        
  

    

    
      <a class="item" data-title="理解 Kubernetes 对象" href="/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>
    
  

  

    

    
      <a class="item" data-title="Names" href="/docs/concepts/overview/working-with-objects/names/"></a>
    
  

  

    

    
      <a class="item" data-title="Namespaces" href="/docs/concepts/overview/working-with-objects/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Labels 和 Selectors" href="/docs/concepts/overview/working-with-objects/labels/"></a>
    
  

  

    

    
      <a class="item" data-title="Annotations" href="/docs/concepts/overview/working-with-objects/annotations/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Object Management Using kubectl">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes 对象管理" href="/docs/concepts/overview/object-management-kubectl/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命令式命令管理 Kubernetes 对象" href="/docs/concepts/overview/object-management-kubectl/imperative-command/"></a>
    
  

  

    

    
      <a class="item" data-title="使用配置文件对 Kubernetes 对象的命令式管理" href="/docs/concepts/overview/object-management-kubectl/imperative-config/"></a>
    
  

  

    

    
      <a class="item" data-title="Declarative Management of Kubernetes Objects Using Configuration Files" href="/docs/concepts/overview/object-management-kubectl/declarative-config/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Architecture">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Nodes" href="/docs/concepts/architecture/nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="Master 节点通信" href="/docs/concepts/architecture/master-node-communication/"></a>
    
  

  

    

    
      <a class="item" data-title="云控制器管理器的基础概念" href="/docs/concepts/architecture/cloud-controller/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extending Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="扩展 Kubernetes 集群" href="/docs/concepts/overview/extending/"></a>
    
  

  
    <div class="item" data-title="Extending the Kubernetes API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用聚合层扩展Kubernetes API" href="/docs/concepts/api-extension/apiserver-aggregation/"></a>
    
  

  

    

    
      <a class="item" data-title="自定义资源" href="/docs/concepts/api-extension/custom-resources/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Compute, Storage, and Networking Extensions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="服务目录" href="/docs/concepts/service-catalog/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="镜像" href="/docs/concepts/containers/images/"></a>
    
  

  

    

    
      <a class="item" data-title="容器环境变量" href="/docs/concepts/containers/container-environment-variables/"></a>
    
  

  

    

    
      <a class="item" data-title="容器生命周期的钩子" href="/docs/concepts/containers/container-lifecycle-hooks/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Workloads">
      <div class="container">
        
  
    <div class="item" data-title="Pods">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Pod Overview" href="/docs/concepts/workloads/pods/pod-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Pods" href="/docs/concepts/workloads/pods/pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 生命周期" href="/docs/concepts/workloads/pods/pod-lifecycle/"></a>
    
  

  

    

    
      <a class="item" data-title="Init 容器" href="/docs/concepts/workloads/pods/init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod Preset" href="/docs/concepts/workloads/pods/podpreset/"></a>
    
  

  

    

    
      <a class="item" data-title="Disruption(中断)" href="/docs/concepts/workloads/pods/disruptions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Controllers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Replica Sets" href="/docs/concepts/workloads/controllers/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Replication Controller" href="/docs/concepts/workloads/controllers/replicationcontroller/"></a>
    
  

  

    

    
      <a class="item" data-title="Deployment" href="/docs/concepts/workloads/controllers/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="StatefulSet" href="/docs/concepts/workloads/controllers/statefulset/"></a>
    
  

  

    

    
      <a class="item" data-title="Daemon Sets" href="/docs/concepts/workloads/controllers/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="垃圾收集" href="/docs/concepts/workloads/controllers/garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Jobs - Run to Completion" href="/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>
    
  

  

    

    
      <a class="item" data-title="Cron Job" href="/docs/concepts/workloads/controllers/cron-jobs/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configuration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="配置最佳实践" href="/docs/concepts/configuration/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Compute Resources for Containers" href="/docs/concepts/configuration/manage-compute-resources-container/"></a>
    
  

  

    

    
      <a class="item" data-title="分配 Pod 到 Node 上" href="/docs/concepts/configuration/assign-pod-node/"></a>
    
  

  

    

    
      <a class="item" data-title="Taint 和 Toleration" href="/docs/concepts/configuration/taint-and-toleration/"></a>
    
  

  

    

    
      <a class="item" data-title="Secret" href="/docs/concepts/configuration/secret/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeconfig 文件组织集群访问" href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 优先级和抢占" href="/docs/concepts/configuration/pod-priority-preemption/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Services, Load Balancing, and Networking">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Service" href="/docs/concepts/services-networking/service/"></a>
    
  

  

    

    
      <a class="item" data-title="DNS Pod 与 Service" href="/docs/concepts/services-networking/dns-pod-service/"></a>
    
  

  

    

    
      <a class="item" data-title="应用连接到 Service" href="/docs/concepts/services-networking/connect-applications-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Ingress resource" href="/docs/concepts/services-networking/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Network Policies" href="/docs/concepts/services-networking/network-policies/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Storage">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Volumes" href="/docs/concepts/storage/volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="持久化卷" href="/docs/concepts/storage/persistent-volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage Classes" href="/docs/concepts/storage/storage-classes/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Volume Provisioning" href="/docs/concepts/storage/dynamic-provisioning/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Administration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="集群管理概述" href="/docs/concepts/cluster-administration/cluster-administration-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="证书" href="/docs/concepts/cluster-administration/certificates/"></a>
    
  

  

    

    
      <a class="item" data-title="云供应商" href="/docs/concepts/cluster-administration/cloud-providers/"></a>
    
  

  

    

    
      <a class="item" data-title="管理资源" href="/docs/concepts/cluster-administration/manage-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/concepts/cluster-administration/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="日志架构" href="/docs/concepts/cluster-administration/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 kubelet 垃圾收集" href="/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦（Federation）" href="/docs/concepts/cluster-administration/federation/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Kubernetes 中的代理" href="/docs/concepts/cluster-administration/proxies/"></a>
    
  

  

    

    
      <a class="item" data-title="Controller manager metrics" href="/docs/concepts/cluster-administration/controller-metrics/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  
    <div class="item" data-title="Policies">
      <div class="container">
        
  

    

    
      <a class="item" data-title="资源配额" href="/docs/concepts/policy/resource-quotas/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 安全策略" href="/docs/concepts/policy/pod-security-policy/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/concepts/storage/persistent-volumes.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>持久化卷</h1>
        

        <p>本文档介绍了 Kubernetes 中 <code class="highlighter-rouge">PersistentVolume</code> 的当前状态。建议您在阅读本文档前先熟悉 <a href="/docs/concepts/storage/volumes/">volume</a>。</p>

<ul id="markdown-toc">
  <li><a href="#介绍" id="markdown-toc-介绍">介绍</a></li>
  <li><a href="#卷和声明的生命周期" id="markdown-toc-卷和声明的生命周期">卷和声明的生命周期</a>    <ul>
      <li><a href="#配置provision" id="markdown-toc-配置provision">配置（Provision）</a>        <ul>
          <li><a href="#静态" id="markdown-toc-静态">静态</a></li>
          <li><a href="#动态" id="markdown-toc-动态">动态</a></li>
        </ul>
      </li>
      <li><a href="#绑定" id="markdown-toc-绑定">绑定</a></li>
      <li><a href="#使用" id="markdown-toc-使用">使用</a></li>
      <li><a href="#持久化卷声明的保护" id="markdown-toc-持久化卷声明的保护">持久化卷声明的保护</a></li>
      <li><a href="#回收" id="markdown-toc-回收">回收</a>        <ul>
          <li><a href="#保留" id="markdown-toc-保留">保留</a></li>
          <li><a href="#回收-1" id="markdown-toc-回收-1">回收</a></li>
          <li><a href="#删除" id="markdown-toc-删除">删除</a></li>
        </ul>
      </li>
      <li><a href="#扩展持久化卷声明" id="markdown-toc-扩展持久化卷声明">扩展持久化卷声明</a></li>
    </ul>
  </li>
  <li><a href="#持久化卷类型" id="markdown-toc-持久化卷类型">持久化卷类型</a></li>
  <li><a href="#持久化卷" id="markdown-toc-持久化卷">持久化卷</a>    <ul>
      <li><a href="#容量" id="markdown-toc-容量">容量</a></li>
      <li><a href="#卷模式" id="markdown-toc-卷模式">卷模式</a></li>
      <li><a href="#访问模式" id="markdown-toc-访问模式">访问模式</a></li>
      <li><a href="#类" id="markdown-toc-类">类</a></li>
      <li><a href="#回收策略" id="markdown-toc-回收策略">回收策略</a></li>
      <li><a href="#挂载选项" id="markdown-toc-挂载选项">挂载选项</a></li>
      <li><a href="#状态" id="markdown-toc-状态">状态</a></li>
    </ul>
  </li>
  <li><a href="#persistentvolumeclaim" id="markdown-toc-persistentvolumeclaim">PersistentVolumeClaim</a>    <ul>
      <li><a href="#访问模式-1" id="markdown-toc-访问模式-1">访问模式</a></li>
      <li><a href="#卷模式-1" id="markdown-toc-卷模式-1">卷模式</a></li>
      <li><a href="#资源" id="markdown-toc-资源">资源</a></li>
      <li><a href="#选择器" id="markdown-toc-选择器">选择器</a></li>
      <li><a href="#类-1" id="markdown-toc-类-1">类</a></li>
    </ul>
  </li>
  <li><a href="#声明作为卷" id="markdown-toc-声明作为卷">声明作为卷</a>    <ul>
      <li><a href="#命名空间注意点" id="markdown-toc-命名空间注意点">命名空间注意点</a></li>
    </ul>
  </li>
  <li><a href="#原始块卷支持" id="markdown-toc-原始块卷支持">原始块卷支持</a>    <ul>
      <li><a href="#使用原始块卷作为持久化卷" id="markdown-toc-使用原始块卷作为持久化卷">使用原始块卷作为持久化卷</a></li>
      <li><a href="#持久化卷声明请求原始块卷" id="markdown-toc-持久化卷声明请求原始块卷">持久化卷声明请求原始块卷</a></li>
      <li><a href="#在-pod-规格配置中为容器添加原始块设备" id="markdown-toc-在-pod-规格配置中为容器添加原始块设备">在 Pod 规格配置中为容器添加原始块设备</a></li>
      <li><a href="#绑定块卷" id="markdown-toc-绑定块卷">绑定块卷</a></li>
    </ul>
  </li>
  <li><a href="#编写可移植配置" id="markdown-toc-编写可移植配置">编写可移植配置</a></li>
</ul>

<h2 id="介绍">介绍</h2>

<p>对于管理计算资源来说，管理存储资源明显是另一个问题。<code class="highlighter-rouge">PersistentVolume</code> 子系统为用户和管理员提供了一个 API，该 API 将如何提供存储的细节抽象了出来。为此，我们引入两个新的 API 资源：<code class="highlighter-rouge">PersistentVolume</code> 和 <code class="highlighter-rouge">PersistentVolumeClaim</code>。</p>

<p><code class="highlighter-rouge">PersistentVolume</code>（PV）是由管理员设置的存储，它是群集的一部分。就像节点是集群中的资源一样，PV 也是集群中的资源。 PV 是 Volume 之类的卷插件，但具有独立于使用 PV 的 Pod 的生命周期。此 API 对象包含存储实现的细节，即 NFS、iSCSI 或特定于云供应商的存储系统。</p>

<p><code class="highlighter-rouge">PersistentVolumeClaim</code>（PVC）是用户存储的请求。它与 Pod 相似。Pod 消耗节点资源，PVC 消耗 PV 资源。Pod 可以请求特定级别的资源（CPU 和内存）。声明可以请求特定的大小和访问模式（例如，可以以读/写一次或 只读多次模式挂载）。</p>

<p>虽然 <code class="highlighter-rouge">PersistentVolumeClaims</code> 允许用户使用抽象存储资源，但用户需要具有不同性质（例如性能）的 <code class="highlighter-rouge">PersistentVolume</code> 来解决不同的问题。集群管理员需要能够提供各种各样的 <code class="highlighter-rouge">PersistentVolume</code>，这些<code class="highlighter-rouge">PersistentVolume</code> 的大小和访问模式可以各有不同，但不需要向用户公开实现这些卷的细节。对于这些需求，<code class="highlighter-rouge">StorageClass</code> 资源可以实现。</p>

<p>请参阅<a href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/">工作示例的详细过程</a>。</p>

<h2 id="卷和声明的生命周期">卷和声明的生命周期</h2>

<p>PV 属于集群中的资源。PVC 是对这些资源的请求，也作为对资源的请求的检查。 PV 和 PVC 之间的相互作用遵循这样的生命周期：</p>

<h3 id="配置provision">配置（Provision）</h3>

<p>有两种方式来配置 PV：静态或动态。</p>

<h4 id="静态">静态</h4>

<p>集群管理员创建一些 PV。它们带有可供群集用户使用的实际存储的细节。它们存在于 Kubernetes API 中，可用于消费。</p>

<h4 id="动态">动态</h4>

<p>当管理员创建的静态 PV 都不匹配用户的 <code class="highlighter-rouge">PersistentVolumeClaim</code> 时，集群可能会尝试动态地为 PVC 创建卷。此配置基于 <code class="highlighter-rouge">StorageClasses</code>：PVC 必须请求<a href="/docs/concepts/storage/storage-classes/">存储类</a>，并且管理员必须创建并配置该类才能进行动态创建。声明该类为 <code class="highlighter-rouge">""</code> 可以有效地禁用其动态配置。</p>

<p>要启用基于存储级别的动态存储配置，集群管理员需要启用 API server 上的 <code class="highlighter-rouge">DefaultStorageClass</code> <a href="/docs/admin/admission-controllers/#defaultstorageclass">准入控制器</a>。例如，通过确保 <code class="highlighter-rouge">DefaultStorageClass</code> 位于 API server 组件的 <code class="highlighter-rouge">--admission-control</code> 标志，使用逗号分隔的有序值列表中，可以完成此操作。有关 API  server 命令行标志的更多信息，请检查 <a href="/docs/admin/kube-apiserver/">kube-apiserver</a> 文档。</p>

<h3 id="绑定">绑定</h3>

<p>再动态配置的情况下，用户创建或已经创建了具有特定存储量的 <code class="highlighter-rouge">PersistentVolumeClaim</code> 以及某些访问模式。master 中的控制环路监视新的 PVC，寻找匹配的 PV（如果可能），并将它们绑定在一起。如果为新的 PVC 动态调配 PV，则该环路将始终将该 PV 绑定到 PVC。否则，用户总会得到他们所请求的存储，但是容量可能超出要求的数量。一旦 PV 和 PVC 绑定后，<code class="highlighter-rouge">PersistentVolumeClaim</code> 绑定是排他性的，不管它们是如何绑定的。 PVC 跟 PV 绑定是一对一的映射。</p>

<p>如果没有匹配的卷，声明将无限期地保持未绑定状态。随着匹配卷的可用，声明将被绑定。例如，配置了许多 50Gi PV的集群将不会匹配请求 100Gi 的PVC。将100Gi PV 添加到群集时，可以绑定 PVC。</p>

<h3 id="使用">使用</h3>

<p>Pod 使用声明作为卷。集群检查声明以查找绑定的卷并为集群挂载该卷。对于支持多种访问模式的卷，用户指定在使用声明作为容器中的卷时所需的模式。</p>

<p>用户进行了声明，并且该声明是绑定的，则只要用户需要，绑定的 PV 就属于该用户。用户通过在 Pod 的 volume 配置中包含 <code class="highlighter-rouge">persistentVolumeClaim</code> 来调度 Pod 并访问用户声明的 PV。<a href="#claims-as-volumes">请参阅下面的语法细节</a>。</p>

<h3 id="持久化卷声明的保护">持久化卷声明的保护</h3>

<p><strong>FEATURE STATE:</strong> <code class="highlighter-rouge">Kubernetes v1.9</code> <a href="#" id="feature-state-dialog-link" class="ui-state-default ui-corner-all"><span class="ui-icon ui-icon-newwin"></span>alpha</a></p>
<div id="feature-state-dialog" class="ui-dialog-content" title="alpha">
  <p>This feature is currently in a <em>alpha</em> state, meaning:</p>
  <ul>
    <li>The version names contain alpha (e.g. v1alpha1).</li>
    <li>Might be buggy. Enabling the feature may expose bugs. Disabled by default.</li>
    <li>Support for feature may be dropped at any time without notice.</li>
    <li>The API may change in incompatible ways in a later software release without notice.</li>
    <li>Recommended for use only in short-lived testing clusters, due to increased risk of bugs and lack of long-term support.</li>
  </ul>
</div>
<script>
$(function(){
    
    $( "#feature-state-dialog" ).dialog({
        autoOpen: false,
        width: 600,
        buttons: [
            {
                text: "Ok",
                click: function() {
                    $( this ).dialog( "close" );
                }
            }
        ]
    });

    // Link to open the dialog
    $( "#feature-state-dialog-link" ).click(function( event ) {
        $( "#feature-state-dialog" ).dialog( "open" );
        event.preventDefault();
    });

});
</script>

<p>PVC 保护的目的是确保由 pod 正在使用的 PVC 不会从系统中移除，因为如果被移除的话可能会导致数据丢失。</p>

<p>注意：当 pod 状态为 <code class="highlighter-rouge">Pending</code> 并且 pod 已经分配给节点或 pod 为 <code class="highlighter-rouge">Running</code> 状态时，PVC 处于活动状态。</p>

<p>当启用<a href="/docs/tasks/administer-cluster/pvc-protection/">PVC 保护 alpha 功能</a>时，如果用户删除了一个 pod 正在使用的 PVC，则该 PVC 不会被立即删除。PVC 的删除将被推迟，直到 PVC 不再被任何 pod 使用。</p>

<p>您可以看到，当 PVC 的状态为 <code class="highlighter-rouge">Teminatiing</code> 时，PVC 受到保护，<code class="highlighter-rouge">Finalizers</code> 列表中包含 <code class="highlighter-rouge">kubernetes.io/pvc-protection</code>：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl described pvc hostpath
Name:          hostpath
Namespace:     default
StorageClass:  example-hostpath
Status:        Terminating
Volume:        
Labels:        &lt;none&gt;
Annotations:   volume.beta.kubernetes.io/storage-class<span class="o">=</span>example-hostpath
               volume.beta.kubernetes.io/storage-provisioner<span class="o">=</span>example.com/hostpath
Finalizers:    <span class="o">[</span>kubernetes.io/pvc-protection]
...
</code></pre></div></div>

<h3 id="回收">回收</h3>

<p>用户用完 volume 后，可以从允许回收资源的 API 中删除 PVC 对象。<code class="highlighter-rouge">PersistentVolume</code> 的回收策略告诉集群在存储卷声明释放后应如何处理该卷。目前，volume 的处理策略有保留、回收或删除。</p>

<h4 id="保留">保留</h4>

<p>保留回收策略允许手动回收资源。当 <code class="highlighter-rouge">PersistentVolumeClaim</code> 被删除时，<code class="highlighter-rouge">PersistentVolume</code> 仍然存在，volume 被视为“已释放”。但是由于前一个声明人的数据仍然存在，所以还不能马上进行其他声明。管理员可以通过以下步骤手动回收卷。</p>

<ol>
  <li>删除 <code class="highlighter-rouge">PersistentVolume</code>。在删除 PV 后，外部基础架构中的关联存储资产（如 AWS EBS、GCE PD、Azure Disk 或 Cinder 卷）仍然存在。</li>
  <li>手动清理相关存储资产上的数据。</li>
  <li>手动删除关联的存储资产，或者如果要重新使用相同的存储资产，请使用存储资产定义创建新的 <code class="highlighter-rouge">PersistentVolume</code>。</li>
</ol>

<h4 id="回收-1">回收</h4>

<p>如果存储卷插件支持，回收策略会在 volume上执行基本擦除（<code class="highlighter-rouge">rm -rf / thevolume / *</code>），可被再次声明使用。</p>

<p>但是，管理员可以使用如<a href="/docs/admin/kube-controller-manager/">此处</a>所述的 Kubernetes controller manager 命令行参数来配置自定义回收站 pod 模板。自定义回收站 pod 模板必须包含 <code class="highlighter-rouge">volumes</code> 规范，如下面的示例所示：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-recycler</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">default</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol</span>
    <span class="na">hostPath</span><span class="pi">:</span>
      <span class="na">path</span><span class="pi">:</span> <span class="s">/any/path/it/will/be/replaced</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">pv-recycler</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">k8s.gcr.io/busybox"</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/sh"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">test</span><span class="nv"> </span><span class="s">-e</span><span class="nv"> </span><span class="s">/scrub</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">rm</span><span class="nv"> </span><span class="s">-rf</span><span class="nv"> </span><span class="s">/scrub/..?*</span><span class="nv"> </span><span class="s">/scrub/.[!.]*</span><span class="nv"> </span><span class="s">/scrub/*</span><span class="nv">  </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">test</span><span class="nv"> </span><span class="s">-z</span><span class="nv"> </span><span class="se">\"</span><span class="s">$(ls</span><span class="nv"> </span><span class="s">-A</span><span class="nv"> </span><span class="s">/scrub)</span><span class="se">\"</span><span class="nv"> </span><span class="s">||</span><span class="nv"> </span><span class="s">exit</span><span class="nv"> </span><span class="s">1"</span><span class="pi">]</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/scrub</span>
</code></pre></div></div>

<p>但是，<code class="highlighter-rouge">volumes</code> 部分的自定义回收站模块中指定的特定路径将被替换为正在回收的卷的特定路径。</p>

<h4 id="删除">删除</h4>

<p>对于支持删除回收策略的卷插件，删除操作将从 Kubernetes 中删除 <code class="highlighter-rouge">PersistentVolume</code> 对象，并删除外部基础架构（如 AWS EBS、GCE PD、Azure Disk 或 Cinder 卷）中的关联存储资产。动态配置的卷继承其 <a href="#reclaim-policy"><code class="highlighter-rouge">StorageClass</code> 的回收策略</a>，默认为 Delete。管理员应该根据用户的期望来配置 <code class="highlighter-rouge">StorageClass</code>，否则就必须要在 PV 创建后进行编辑或修补。请参阅<a href="https://kubernetes.io/docs/tasks/administer-cluster/change-pv-reclaim-policy/">更改 PersistentVolume 的回收策略</a>。</p>

<h3 id="扩展持久化卷声明">扩展持久化卷声明</h3>

<p>Kubernetes 1.8 增加了对扩展持久化存储卷的 Alpha 支持。在 v1.9 中，以下持久化卷支持扩展持久化卷声明：</p>

<ul>
  <li>gcePersistentDisk</li>
  <li>awsElasticBlockStore</li>
  <li>Cinder</li>
  <li>glusterfs</li>
  <li>rbd</li>
</ul>

<p>管理员可以通过将 <code class="highlighter-rouge">ExpandPersistentVolumes</code> 特性门设置为true来允许扩展持久卷声明。管理员还应该启用<a href="/docs/admin/admission-controllers/#persistentvolumeclaimresize"><code class="highlighter-rouge">PersistentVolumeClaimResize</code> 准入控制插件</a>来执行对可调整大小的卷的其他验证。</p>

<p>一旦 <code class="highlighter-rouge">PersistentVolumeClaimResize</code> 准入插件已打开，将只允许其 <code class="highlighter-rouge">allowVolumeExpansion</code> 字段设置为 true 的存储类进行大小调整。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">gluster-vol-default</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">kubernetes.io/glusterfs</span>
<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">resturl</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://192.168.10.100:8080"</span>
  <span class="na">restuser</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">secretNamespace</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">secretName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">allowVolumeExpansion</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>一旦功能门和前述准入插件打开后，用户就可以通过简单地编辑声明以请求更大的 <code class="highlighter-rouge">PersistentVolumeClaim</code> 卷。这反过来将触发 <code class="highlighter-rouge">PersistentVolume</code> 后端的卷扩展。</p>

<p>在任何情况下都不会创建新的 <code class="highlighter-rouge">PersistentVolume</code> 来满足声明。 Kubernetes 将尝试调整现有 volume 来满足声明的要求。</p>

<p>对于扩展包含文件系统的卷，只有在 ReadWrite 模式下使用 <code class="highlighter-rouge">PersistentVolumeClaim</code> 启动新的 Pod 时，才会执行文件系统调整大小。换句话说，如果正在扩展的卷在 pod 或部署中使用，则需要删除并重新创建要进行文件系统调整大小的pod。此外，文件系统调整大小仅适用于以下文件系统类型：</p>

<ul>
  <li>XFS</li>
  <li>Ext3、Ext4</li>
</ul>

<p><strong>注意</strong>：扩展 EBS 卷是一个耗时的操作。另外，每6个小时有一个修改卷的配额。</p>

<h2 class="note" id="持久化卷类型">持久化卷类型</h2>

<p><code class="highlighter-rouge">PersistentVolume</code> 类型以插件形式实现。Kubernetes 目前支持以下插件类型：</p>

<ul>
  <li>GCEPersistentDisk</li>
  <li>AWSElasticBlockStore</li>
  <li>AzureFile</li>
  <li>AzureDisk</li>
  <li>FC (Fibre Channel)</li>
  <li>FlexVolume</li>
  <li>Flocker</li>
  <li>NFS</li>
  <li>iSCSI</li>
  <li>RBD (Ceph Block Device)</li>
  <li>CephFS</li>
  <li>Cinder (OpenStack block storage)</li>
  <li>Glusterfs</li>
  <li>VsphereVolume</li>
  <li>Quobyte Volumes</li>
  <li>HostPath （仅限于但节点测试—— 不会以任何方式支持本地存储，也无法在多节点集群中工作）</li>
  <li>VMware Photon</li>
  <li>Portworx Volumes</li>
  <li>ScaleIO Volumes</li>
  <li>StorageOS</li>
</ul>

<p>原始块支持仅适用于以上这些插件。</p>

<h2 id="持久化卷">持久化卷</h2>

<p>每个 PV 配置中都包含一个 sepc 规格字段和一个 status 卷状态字段。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolume</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv0003</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">capacity</span><span class="pi">:</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
  <span class="na">volumeMode</span><span class="pi">:</span> <span class="s">Filesystem</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">persistentVolumeReclaimPolicy</span><span class="pi">:</span> <span class="s">Recycle</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">slow</span>
  <span class="na">mountOptions</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">hard</span>
    <span class="pi">-</span> <span class="s">nfsvers=4.1</span>
  <span class="na">nfs</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/tmp</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">172.17.0.2</span>
</code></pre></div></div>

<h3 id="容量">容量</h3>

<p>通常，PV 将具有特定的存储容量。这是使用 PV 的容量属性设置的。查看 Kubernetes <a href="https://git.k8s.io/community/contributors/design-proposals/scheduling/resources.md">资源模型</a> 以了解 <code class="highlighter-rouge">capacity</code> 预期。</p>

<p>目前，存储大小是可以设置或请求的唯一资源。未来的属性可能包括 IOPS、吞吐量等。</p>

<h3 id="卷模式">卷模式</h3>

<p>在 v1.9 之前，所有卷插件的默认行为是在持久卷上创建一个文件系统。在 v1.9 中，用户可以指定一个 volumeMode，除了文件系统之外，它现在将支持原始块设备。 volumeMode 的有效值可以是“Filesystem”或“Block”。如果未指定，volumeMode 将默认为“Filesystem”。这是一个可选的 API 参数。</p>

<p><strong>注意</strong>：该功能在 V1.9 中是 alpha的，未来可能会更改。</p>

<h3 class="note" id="访问模式">访问模式</h3>

<p><code class="highlighter-rouge">PersistentVolume</code> 可以以资源提供者支持的任何方式挂载到主机上。如下表所示，供应商具有不同的功能，每个 PV 的访问模式都将被设置为该卷支持的特定模式。例如，NFS 可以支持多个读/写客户端，但特定的 NFS PV 可能以只读方式导出到服务器上。每个 PV 都有一套自己的用来描述特定功能的访问模式。</p>

<p>存储模式包括：</p>

<ul>
  <li>ReadWriteOnce——该卷可以被单个节点以读/写模式挂载</li>
  <li>ReadOnlyMany——该卷可以被多个节点以只读模式挂载</li>
  <li>ReadWriteMany——该卷可以被多个节点以读/写模式挂载</li>
</ul>

<p>在命令行中，访问模式缩写为：</p>

<ul>
  <li>RWO - ReadWriteOnce</li>
  <li>ROX - ReadOnlyMany</li>
  <li>RWX - ReadWriteMany</li>
</ul>

<blockquote>
  <p><strong>重要</strong>！一个卷一次只能使用一种访问模式挂载，即使它支持很多访问模式。例如，GCEPersistentDisk 可以由单个节点作为 ReadWriteOnce 模式挂载，或由多个节点以 ReadOnlyMany 模式挂载，但不能同时挂载。</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Volume 插件</th>
      <th style="text-align: center">ReadWriteOnce</th>
      <th style="text-align: center">ReadOnlyMany</th>
      <th style="text-align: center">ReadWriteMany</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">AWSElasticBlockStore</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">AzureFile</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">AzureDisk</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">CephFS</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">Cinder</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">FC</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">FlexVolume</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">Flocker</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">GCEPersistentDisk</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">Glusterfs</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">HostPath</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">iSCSI</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">PhotonPersistentDisk</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">Quobyte</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">NFS</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">RBD</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">VsphereVolume</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">- （当 pod 并列时有效）</td>
    </tr>
    <tr>
      <td style="text-align: left">PortworxVolume</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">✓</td>
    </tr>
    <tr>
      <td style="text-align: left">ScaleIO</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
    </tr>
    <tr>
      <td style="text-align: left">StorageOS</td>
      <td style="text-align: center">✓</td>
      <td style="text-align: center">-</td>
      <td style="text-align: center">-</td>
    </tr>
  </tbody>
</table>

<h3 id="类">类</h3>

<p>PV 可以具有一个类，通过将 <code class="highlighter-rouge">storageClassName</code> 属性设置为 <a href="/docs/concepts/storage/storage-classes/">StorageClass</a> 的名称来指定该类。一个特定类别的 PV 只能绑定到请求该类别的 PVC。没有 <code class="highlighter-rouge">storageClassName</code> 的 PV 就没有类，它只能绑定到不需要特定类的 PVC。</p>

<p>过去，使用的是 <code class="highlighter-rouge">volume.beta.kubernetes.io/storage-class</code> 注解而不是 <code class="highlighter-rouge">storageClassName</code> 属性。这个注解仍然有效，但是将来的 Kubernetes 版本中将会完全弃用它。</p>

<h3 id="回收策略">回收策略</h3>

<p>当前的回收策略包括：</p>

<ul>
  <li>Retain（保留）——手动回收</li>
  <li>Recycle（回收）——基本擦除（<code class="highlighter-rouge">rm -rf /thevolume/*</code>）</li>
  <li>Delete（删除）——关联的存储资产（例如 AWS EBS、GCE PD、Azure Disk 和 OpenStack Cinder 卷）将被删除</li>
</ul>

<p>当前，只有 NFS 和 HostPath 支持回收策略。AWS EBS、GCE PD、Azure Disk 和 Cinder 卷支持删除策略。</p>

<h3 id="挂载选项">挂载选项</h3>

<p>Kubernetes 管理员可以指定在节点上为挂载持久卷指定挂载选项。</p>

<p><strong>注意</strong>：不是所有的持久化卷类型都支持挂载选项。</p>

<p class="note">以下卷类型支持挂载选项：</p>

<ul>
  <li>GCEPersistentDisk</li>
  <li>AWSElasticBlockStore</li>
  <li>AzureFile</li>
  <li>AzureDisk</li>
  <li>NFS</li>
  <li>iSCSI</li>
  <li>RBD （Ceph Block Device）</li>
  <li>CephFS</li>
  <li>Cinder （OpenStack 卷存储）</li>
  <li>Glusterfs</li>
  <li>VsphereVolume</li>
  <li>Quobyte Volumes</li>
  <li>VMware Photon</li>
</ul>

<p>挂载选项没有校验，如果挂载选项无效则挂载失败。</p>

<p>过去，使用 <code class="highlighter-rouge">volume.beta.kubernetes.io/mount-options</code> 注解而不是 <code class="highlighter-rouge">mountOptions</code> 属性。这个注解仍然有效，但在将来的 Kubernetes 版本中它将会被完全弃用。</p>

<h3 id="状态">状态</h3>

<p>卷可以处于以下的某种状态：</p>

<ul>
  <li>Available（可用）——一块空闲资源还没有被任何声明绑定</li>
  <li>Bound（已绑定）——卷已经被声明绑定</li>
  <li>Released（已释放）——声明被删除，但是资源还未被集群重新声明</li>
  <li>Failed（失败）——该卷的自动回收失败</li>
</ul>

<p>命令行会显示绑定到 PV 的 PVC 的名称。</p>

<h2 id="persistentvolumeclaim">PersistentVolumeClaim</h2>

<p>每个 PVC 中都包含一个 spec 规格字段和一个 status 声明状态字段。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">myclaim</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">volumeMode</span><span class="pi">:</span> <span class="s">Filesystem</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">slow</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">release</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stable"</span>
    <span class="na">matchExpressions</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="pi">{</span><span class="nv">key</span><span class="pi">:</span> <span class="nv">environment</span><span class="pi">,</span> <span class="nv">operator</span><span class="pi">:</span> <span class="nv">In</span><span class="pi">,</span> <span class="nv">values</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">dev</span><span class="pi">]}</span>
</code></pre></div></div>

<h3 id="访问模式-1">访问模式</h3>

<p>在请求具有特定访问模式的存储时，声明使用与卷相同的约定。</p>

<h3 id="卷模式-1">卷模式</h3>

<p>声明使用与卷相同的约定，指示将卷作为文件系统或块设备使用。</p>

<h3 id="资源">资源</h3>

<p>像 pod 一样，声明可以请求特定数量的资源。在这种情况下，请求是用于存储的。相同的<a href="https://git.k8s.io/community/contributors/design-proposals/scheduling/resources.md">资源模型</a>适用于卷和声明。</p>

<h3 id="选择器">选择器</h3>

<p>声明可以指定一个<a href="/docs/concepts/overview/working-with-objects/labels/#label-selectors">标签选择器</a>来进一步过滤该组卷。只有标签与选择器匹配的卷可以绑定到声明。选择器由两个字段组成：</p>

<ul>
  <li>matchLabels：volume 必须有具有该值的标签</li>
  <li>matchExpressions：这是一个要求列表，通过指定关键字，值列表以及与关键字和值相关的运算符组成。有效的运算符包括 In、NotIn、Exists 和 DoesNotExist。</li>
</ul>

<p>所有来自 <code class="highlighter-rouge">matchLabels</code> 和 <code class="highlighter-rouge">matchExpressions</code> 的要求都被“与”在一起——它们必须全部满足才能匹配。</p>

<h3 id="类-1">类</h3>

<p>声明可以通过使用属性 <code class="highlighter-rouge">storageClassName</code> 指定 <a href="/docs/concepts/storage/storage-classes/">StorageClass</a> 的名称来请求特定的类。只有所请求的类与 PVC 具有相同 <code class="highlighter-rouge">storageClassName</code> 的 PV 才能绑定到 PVC。</p>

<p>PVC 不一定要请求类。其 <code class="highlighter-rouge">storageClassName</code> 设置为 <code class="highlighter-rouge">""</code> 的 PVC 始终被解释为没有请求类的 PV，因此只能绑定到没有类的 PV（没有注解或 <code class="highlighter-rouge">""</code>）。没有 <code class="highlighter-rouge">storageClassName</code> 的 PVC 根据是否打开<a href="/docs/admin/admission-controllers/#defaultstorageclass"><code class="highlighter-rouge">DefaultStorageClass</code> 准入控制插件</a>，集群对其进行不同处理。</p>

<ul>
  <li>如果打开了准入控制插件，管理员可以指定一个默认的 <code class="highlighter-rouge">StorageClass</code>。所有没有 <code class="highlighter-rouge">StorageClassName</code> 的 PVC 将被绑定到该默认的 PV。通过在 <code class="highlighter-rouge">StorageClass</code> 对象中将注解 <code class="highlighter-rouge">storageclassclass.ubernetes.io/is-default-class</code> 设置为 “true” 来指定默认的 <code class="highlighter-rouge">StorageClass</code>。如果管理员没有指定缺省值，那么集群会响应 PVC 创建，就好像关闭了准入控制插件一样。如果指定了多个默认值，则准入控制插件将禁止所有 PVC 创建。</li>
  <li>如果准入控制插件被关闭，则没有默认 <code class="highlighter-rouge">StorageClass</code> 的概念。所有没有 <code class="highlighter-rouge">storageClassName</code> 的 PVC 只能绑定到没有类的 PV。在这种情况下，没有 <code class="highlighter-rouge">storageClassName</code> 的 PVC 的处理方式与 <code class="highlighter-rouge">storageClassName</code> 设置为 <code class="highlighter-rouge">""</code> 的 PVC 的处理方式相同。</li>
</ul>

<p>根据安装方法的不同，默认的 <code class="highlighter-rouge">StorageClass</code> 可以在安装过程中通过插件管理器部署到 Kubernetes 集群。</p>

<p>当 PVC 指定了 <code class="highlighter-rouge">selector</code>，除了请求一个 <code class="highlighter-rouge">StorageClass</code> 之外，这些需求被“与”在一起：只有被请求的类的 PV 具有和被请求的标签才可以被绑定到 PVC。</p>

<p><strong>注意</strong>：目前，具有非空 <code class="highlighter-rouge">selector</code> 的 PVC 不能为其动态配置 PV。</p>

<p class="note">过去，使用注解 <code class="highlighter-rouge">volume.beta.kubernetes.io/storage-class</code> 而不是 <code class="highlighter-rouge">storageClassName</code> 属性。这个注解仍然有效，但是在未来的 Kubernetes 版本中不会支持。</p>

<h2 id="声明作为卷">声明作为卷</h2>

<p>通过将声明用作卷来访问存储。声明必须与使用声明的 pod 存在于相同的命名空间中。集群在 pod 的命名空间中查找声明，并使用它来获取支持声明的 <code class="highlighter-rouge">PersistentVolume</code>。该卷然后被挂载到主机的 pod 上。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mypod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">myfrontend</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">dockerfile/nginx</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/var/www/html"</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">mypd</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mypd</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">myclaim</span>
</code></pre></div></div>

<h3 id="命名空间注意点">命名空间注意点</h3>

<p><code class="highlighter-rouge">PersistentVolumes</code> 绑定是唯一的，并且由于 <code class="highlighter-rouge">PersistentVolumeClaims</code> 是命名空间对象，因此只能在一个命名空间内挂载具有“多个”模式（<code class="highlighter-rouge">ROX</code>、<code class="highlighter-rouge">RWX</code>）的声明。</p>

<h2 id="原始块卷支持">原始块卷支持</h2>

<p>原始块卷的静态配置在 v1.9 中作为 alpha 功能引入。由于这个改变，需要一些新的 API 字段来使用该功能。目前，Fibre Channl 是支持该功能的唯一插件。</p>

<h3 id="使用原始块卷作为持久化卷">使用原始块卷作为持久化卷</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: PersistentVolume
metadata:
  name: block-pv
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  volumeMode: Block
  persistentVolumeReclaimPolicy: Retain
  fc:
    targetWWNs: ["50060e801049cfd1"]
    lun: 0
    readOnly: false
</code></pre></div></div>

<h3 id="持久化卷声明请求原始块卷">持久化卷声明请求原始块卷</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: block-pvc
spec:
  accessModes:
    - ReadWriteOnce
  volumeMode: Block
  resources:
    requests:
      storage: 10Gi
</code></pre></div></div>

<h3 id="在-pod-规格配置中为容器添加原始块设备">在 Pod 规格配置中为容器添加原始块设备</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: Pod
metadata:
  name: pod-with-block-volume
spec:
  containers:
    - name: fc-container
      image: fedora:26
      command: ["/bin/sh", "-c"]
      args: [ "tail -f /dev/null" ]
      volumeDevices:
        - name: data
          devicePath: /dev/xvda
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: block-pvc
</code></pre></div></div>

<p><strong>注意</strong>：当为 Pod 增加原始块设备时，我们在容器中指定设备路径而不是挂载路径。</p>

<h3 class="note" id="绑定块卷">绑定块卷</h3>

<p>如果用户通过使用 <code class="highlighter-rouge">PersistentVolumeClaim</code> 规范中的 <code class="highlighter-rouge">volumeMode</code> 字段指示此请求来请求原始块卷，则绑定规则与以前不认为该模式为规范一部分的版本略有不同。</p>

<p>下面是用户和管理员指定请求原始块设备的可能组合的表格。该表指示卷是否将被绑定或未给定组合。静态设置的卷的卷绑定矩阵：</p>

<table>
  <thead>
    <tr>
      <th>PV volumeMode</th>
      <th style="text-align: center">PVC volumeMode</th>
      <th style="text-align: right">结果</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>unspecified</td>
      <td style="text-align: center">unspecified</td>
      <td style="text-align: right">绑定</td>
    </tr>
    <tr>
      <td>unspecified</td>
      <td style="text-align: center">Block</td>
      <td style="text-align: right">不绑定</td>
    </tr>
    <tr>
      <td>unspecified</td>
      <td style="text-align: center">Filesystem</td>
      <td style="text-align: right">绑定</td>
    </tr>
    <tr>
      <td>Block</td>
      <td style="text-align: center">unspecified</td>
      <td style="text-align: right">不绑定</td>
    </tr>
    <tr>
      <td>Block</td>
      <td style="text-align: center">Block</td>
      <td style="text-align: right">绑定</td>
    </tr>
    <tr>
      <td>Block</td>
      <td style="text-align: center">Filesystem</td>
      <td style="text-align: right">不绑定</td>
    </tr>
    <tr>
      <td>Filesystem</td>
      <td style="text-align: center">Filesystem</td>
      <td style="text-align: right">绑定</td>
    </tr>
    <tr>
      <td>Filesystem</td>
      <td style="text-align: center">Block</td>
      <td style="text-align: right">不绑定</td>
    </tr>
    <tr>
      <td>Filesystem</td>
      <td style="text-align: center">unspecified</td>
      <td style="text-align: right">绑定</td>
    </tr>
  </tbody>
</table>

<p><strong>注意</strong>：alpha 版本只支持静态配置卷。使用原始块设备时，管理员应该注意考虑这些值。</p>

<h2 class="note" id="编写可移植配置">编写可移植配置</h2>

<p>如果您正在编写在多种群集上运行并需要持久存储的配置模板或示例，我们建议您使用以下模式：</p>

<ul>
  <li>不要在您的在配置组合中包含 <code class="highlighter-rouge">PersistentVolumeClaim</code> 对象（与 Deployment、ConfigMap等一起）。</li>
  <li>不要在配置中包含 <code class="highlighter-rouge">PersistentVolume</code> 对象，因为用户实例化配置可能没有创建 <code class="highlighter-rouge">PersistentVolume</code> 的权限。</li>
  <li>给用户在实例化模板时提供存储类名称的选项。
    <ul>
      <li>如果用户提供存储类名称，则将该值放入 <code class="highlighter-rouge">persistentVolumeClaim.storageClassName</code> 字段中。如果集群具有由管理员启用的 StorageClass，这将导致 PVC 匹配正确的存储类别。</li>
      <li>如果用户未提供存储类名称，则将 <code class="highlighter-rouge">persistentVolumeClaim.storageClassName</code> 字段保留为 nil。
        <ul>
          <li>这将导致使用集群中默认的 StorageClass 为用户自动配置 PV。许多集群环境都有默认的 StorageClass，或者管理员可以创建自己的默认 StorageClass。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>在您的工具中，请注意一段时间之后仍未绑定的 PVC，并向用户展示它们，因为这表示集群可能没有动态存储支持（在这种情况下用户应创建匹配的 PV），或集群没有存储系统（在这种情况下用户不能部署需要 PVC 的配置）。</li>
</ul>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/concepts/storage/persistent-volumes.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/concepts/storage/persistent-volumes/",
                "title" : "持久化卷",
                "permalink" : "https://kubernetes.io/docs/concepts/storage/persistent-volumes/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/concepts/storage/persistent-volumes.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
