
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Concepts">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Deployment" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Deployment | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="Deployment" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/concepts/workloads/controllers/deployment/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/concepts/workloads/controllers/deployment/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/concepts/workloads/controllers/deployment/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"Deployment","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/concepts/workloads/controllers/deployment/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/concepts/workloads/controllers/deployment/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/concepts/workloads/controllers/deployment/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/concepts/workloads/controllers/deployment/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Concepts</h1>
  <h5>Detailed explanations of Kubernetes system concepts and abstractions.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" class="YAH">CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="概念" href="/docs/concepts/"></a>
    
  

  
    <div class="item" data-title="Overview">
      <div class="container">
        
  

    

    
      <a class="item" data-title="认识 Kubernetes?" href="/docs/concepts/overview/what-is-kubernetes/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 组件" href="/docs/concepts/overview/components/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes API" href="/docs/concepts/overview/kubernetes-api/"></a>
    
  

  
    <div class="item" data-title="Working with Kubernetes Objects">
      <div class="container">
        
  

    

    
      <a class="item" data-title="理解 Kubernetes 对象" href="/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>
    
  

  

    

    
      <a class="item" data-title="Names" href="/docs/concepts/overview/working-with-objects/names/"></a>
    
  

  

    

    
      <a class="item" data-title="Namespaces" href="/docs/concepts/overview/working-with-objects/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Labels 和 Selectors" href="/docs/concepts/overview/working-with-objects/labels/"></a>
    
  

  

    

    
      <a class="item" data-title="Annotations" href="/docs/concepts/overview/working-with-objects/annotations/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Object Management Using kubectl">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes 对象管理" href="/docs/concepts/overview/object-management-kubectl/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命令式命令管理 Kubernetes 对象" href="/docs/concepts/overview/object-management-kubectl/imperative-command/"></a>
    
  

  

    

    
      <a class="item" data-title="使用配置文件对 Kubernetes 对象的命令式管理" href="/docs/concepts/overview/object-management-kubectl/imperative-config/"></a>
    
  

  

    

    
      <a class="item" data-title="Declarative Management of Kubernetes Objects Using Configuration Files" href="/docs/concepts/overview/object-management-kubectl/declarative-config/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Architecture">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Nodes" href="/docs/concepts/architecture/nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="Master 节点通信" href="/docs/concepts/architecture/master-node-communication/"></a>
    
  

  

    

    
      <a class="item" data-title="云控制器管理器的基础概念" href="/docs/concepts/architecture/cloud-controller/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extending Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="扩展 Kubernetes 集群" href="/docs/concepts/overview/extending/"></a>
    
  

  
    <div class="item" data-title="Extending the Kubernetes API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用聚合层扩展Kubernetes API" href="/docs/concepts/api-extension/apiserver-aggregation/"></a>
    
  

  

    

    
      <a class="item" data-title="自定义资源" href="/docs/concepts/api-extension/custom-resources/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Compute, Storage, and Networking Extensions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="服务目录" href="/docs/concepts/service-catalog/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="镜像" href="/docs/concepts/containers/images/"></a>
    
  

  

    

    
      <a class="item" data-title="容器环境变量" href="/docs/concepts/containers/container-environment-variables/"></a>
    
  

  

    

    
      <a class="item" data-title="容器生命周期的钩子" href="/docs/concepts/containers/container-lifecycle-hooks/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Workloads">
      <div class="container">
        
  
    <div class="item" data-title="Pods">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Pod Overview" href="/docs/concepts/workloads/pods/pod-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Pods" href="/docs/concepts/workloads/pods/pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 生命周期" href="/docs/concepts/workloads/pods/pod-lifecycle/"></a>
    
  

  

    

    
      <a class="item" data-title="Init 容器" href="/docs/concepts/workloads/pods/init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod Preset" href="/docs/concepts/workloads/pods/podpreset/"></a>
    
  

  

    

    
      <a class="item" data-title="Disruption(中断)" href="/docs/concepts/workloads/pods/disruptions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Controllers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Replica Sets" href="/docs/concepts/workloads/controllers/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Replication Controller" href="/docs/concepts/workloads/controllers/replicationcontroller/"></a>
    
  

  

    

    
      <a class="item" data-title="Deployment" href="/docs/concepts/workloads/controllers/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="StatefulSet" href="/docs/concepts/workloads/controllers/statefulset/"></a>
    
  

  

    

    
      <a class="item" data-title="Daemon Sets" href="/docs/concepts/workloads/controllers/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="垃圾收集" href="/docs/concepts/workloads/controllers/garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Jobs - Run to Completion" href="/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>
    
  

  

    

    
      <a class="item" data-title="Cron Job" href="/docs/concepts/workloads/controllers/cron-jobs/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configuration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="配置最佳实践" href="/docs/concepts/configuration/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Compute Resources for Containers" href="/docs/concepts/configuration/manage-compute-resources-container/"></a>
    
  

  

    

    
      <a class="item" data-title="分配 Pod 到 Node 上" href="/docs/concepts/configuration/assign-pod-node/"></a>
    
  

  

    

    
      <a class="item" data-title="Taint 和 Toleration" href="/docs/concepts/configuration/taint-and-toleration/"></a>
    
  

  

    

    
      <a class="item" data-title="Secret" href="/docs/concepts/configuration/secret/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeconfig 文件组织集群访问" href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 优先级和抢占" href="/docs/concepts/configuration/pod-priority-preemption/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Services, Load Balancing, and Networking">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Service" href="/docs/concepts/services-networking/service/"></a>
    
  

  

    

    
      <a class="item" data-title="DNS Pod 与 Service" href="/docs/concepts/services-networking/dns-pod-service/"></a>
    
  

  

    

    
      <a class="item" data-title="应用连接到 Service" href="/docs/concepts/services-networking/connect-applications-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Ingress resource" href="/docs/concepts/services-networking/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Network Policies" href="/docs/concepts/services-networking/network-policies/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Storage">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Volumes" href="/docs/concepts/storage/volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="持久化卷" href="/docs/concepts/storage/persistent-volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage Classes" href="/docs/concepts/storage/storage-classes/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Volume Provisioning" href="/docs/concepts/storage/dynamic-provisioning/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Administration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="集群管理概述" href="/docs/concepts/cluster-administration/cluster-administration-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="证书" href="/docs/concepts/cluster-administration/certificates/"></a>
    
  

  

    

    
      <a class="item" data-title="云供应商" href="/docs/concepts/cluster-administration/cloud-providers/"></a>
    
  

  

    

    
      <a class="item" data-title="管理资源" href="/docs/concepts/cluster-administration/manage-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/concepts/cluster-administration/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="日志架构" href="/docs/concepts/cluster-administration/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 kubelet 垃圾收集" href="/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦（Federation）" href="/docs/concepts/cluster-administration/federation/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Kubernetes 中的代理" href="/docs/concepts/cluster-administration/proxies/"></a>
    
  

  

    

    
      <a class="item" data-title="Controller manager metrics" href="/docs/concepts/cluster-administration/controller-metrics/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  
    <div class="item" data-title="Policies">
      <div class="container">
        
  

    

    
      <a class="item" data-title="资源配额" href="/docs/concepts/policy/resource-quotas/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 安全策略" href="/docs/concepts/policy/pod-security-policy/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/concepts/workloads/controllers/deployment.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Deployment</h1>
        

        
<h2 id="什么是-deployment-">什么是 Deployment ？</h2>

<p><em>Deployment</em> 为 <a href="(/docs/concepts/workloads/pods/pod/)">Pod</a> 和 <a href="/docs/concepts/workloads/controllers/replicaset/">ReplicaSet</a>（下一代 Replication Controller）提供声明式更新。</p>

<p>您只需要在 Deployment 中描述您想要的目标状态是什么，Deployment controller 就会帮您将 Pod 和 ReplicaSet 的实际状态改变到您的目标状态。您可以定义一个全新的 Deployment 来创建 ReplicaSet 或者删除已有的 Deployment 并创建一个新的来替换。</p>

<p><strong>注意</strong>：您不该手动管理由 Deployment 创建的 ReplicaSet，否则您就篡越了 Deployment controller 的职责！下文罗列了 Deployment 对象中已经覆盖了所有的用例。如果未有覆盖您所有需要的用例，请直接在 Kubernetes 的代码库中提 issue。</p>

<p>典型的用例如下：</p>

<ul>
  <li><a href="#creating-a-deployment">使用 Deployment来创建 ReplicaSet</a>。ReplicaSet 在后台创建 pod。检查启动状态，看它是成功还是失败。</li>
  <li>然后，通过更新 Deployment 的 PodTemplateSpec 字段来 <a href="#updating-a-deployment">声明 Pod 的新状态</a>。这会创建一个新的 ReplicaSet，Deployment 会按照控制的速率将 pod 从旧的 ReplicaSet 移动到新的 ReplicaSet 中。</li>
  <li>如果当前状态不稳定，<a href="#rolling-back-a-deployment">回滚到之前的 Deployment revision</a>。每次回滚都会更新Deployment的revision。</li>
  <li><a href="#scaling-a-deployment">扩容 Deployment 以满足更高的负载</a>。</li>
  <li><a href="#pausing-and-resuming-a-deployment">暂停 Deployment</a> 来应用 PodTemplateSpec 的多个修复，然后恢复上线。</li>
  <li>根据 <a href="#deployment-status">Deployment 的状态</a> 判断 rollout 是否 hang 住了。</li>
  <li><a href="#clean-up-policy">清除没必要的旧的 ReplicaSet</a>。</li>
</ul>

<h2 id="创建-deployment">创建 Deployment</h2>

<p>下面是一个 Deployment 示例，它创建了一个 Replica Set 来启动3个 nginx pod。</p>

<p>下载示例文件并执行命令：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> docs/user-guide/nginx-deployment.yaml <span class="nt">--record</span>
deployment <span class="s2">"nginx-deployment"</span> created
</code></pre></div></div>

<p>将 kubectl 的 <code class="highlighter-rouge">—record</code> 的 flag 设置为 <code class="highlighter-rouge">true</code> 可以在 annotation 中记录当前命令创建或者升级了该资源。这在未来会很有用，例如，查看在每个 Deployment revision 中执行了哪些命令。</p>

<p>然后立即执行<code class="highlighter-rouge">get</code>í将获得如下结果：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         0         0            0           1s
</code></pre></div></div>

<p>输出结果表明我们希望的 replica 数是3（根据 deployment 中的<code class="highlighter-rouge">.spec.replicas</code>配置）当前 replica 数（ <code class="highlighter-rouge">.status.replicas</code>）是0, 最新的 replica 数（<code class="highlighter-rouge">.status.updatedReplicas</code>）是0，可用的 replica 数（<code class="highlighter-rouge">.status.availableReplicas</code>）是0。</p>

<p>过几秒后再执行<code class="highlighter-rouge">get</code>命令，将获得如下输出：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           18s
</code></pre></div></div>

<p>我们可以看到 Deployment 已经创建了3个 replicas，所有的 replicas 都已经是最新的了（包含最新的 pod template），可用的（根据 Deployment 中的<code class="highlighter-rouge">.spec.minReadySeconds</code>声明，处于已就绪状态的 pod 的最少个数）。执行<code class="highlighter-rouge">kubectl get rs</code>和<code class="highlighter-rouge">kubectl get pods</code>会显示Replica Set（RS）和Pod已创建。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-2035384211   3         3         0       18s
</code></pre></div></div>

<p>您可能会注意到 Replica Set 的名字总是<code class="highlighter-rouge">&lt;Deployment的名字&gt;-&lt;pod template的hash值&gt;</code>。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods <span class="nt">--show-labels</span>
NAME                                READY     STATUS    RESTARTS   AGE       LABELS
nginx-deployment-2035384211-7ci7o   1/1       Running   0          18s       <span class="nv">app</span><span class="o">=</span>nginx,pod-template-hash<span class="o">=</span>2035384211
nginx-deployment-2035384211-kzszj   1/1       Running   0          18s       <span class="nv">app</span><span class="o">=</span>nginx,pod-template-hash<span class="o">=</span>2035384211
nginx-deployment-2035384211-qqcnn   1/1       Running   0          18s       <span class="nv">app</span><span class="o">=</span>nginx,pod-template-hash<span class="o">=</span>2035384211
</code></pre></div></div>

<p>刚创建的 Replica Set 将保证总是有3个 nginx 的 pod 存在。</p>

<p><strong>注意：</strong>  您必须在 Deployment 中的 selector 指定正确 pod template label（在该示例中是 <code class="highlighter-rouge">app = nginx</code>），不要跟其他的 controller 搞混了（包括 Deployment、Replica Set、Replication Controller 等）。<strong>Kubernetes本身不会阻止您这么做</strong>，如果您真的这么做了，这些 controller 之间会相互打架，并可能导致不正确的行为。</p>

<h3 id="pod-template-hash-label">Pod-template-hash label</h3>

<p><strong>注意：</strong> 这个 label 不是用户指定的！</p>

<p>注意上面示例输出中的 pod label 里的 pod-template-hash label。当 Deployment 创建或者接管 ReplicaSet 时，Deployment controller 会自动为 Pod 添加 pod-template-hash label。这样做的目的是防止 Deployment 的子ReplicaSet 的 pod 名字重复。通过将 ReplicaSet 的 PodTemplate 进行哈希散列，使用生成的哈希值作为 label 的值，并添加到 ReplicaSet selector 里、 pod template label 和 ReplicaSet 管理中的 Pod 上。</p>

<h2 id="更新-deployment">更新 Deployment</h2>

<p><strong>注意：</strong> Deployment 的 rollout 当且仅当 Deployment 的 pod template（例如<code class="highlighter-rouge">.spec.template</code>）中的 label 更新或者镜像更改时被触发。其他更新，例如扩容 Deployment 不会触发 rollout。</p>

<p>假如我们现在想要让 nginx pod 使用<code class="highlighter-rouge">nginx:1.9.1</code>的镜像来代替原来的<code class="highlighter-rouge">nginx:1.7.9</code>的镜像。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">set </span>image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
deployment <span class="s2">"nginx-deployment"</span> image updated
</code></pre></div></div>

<p>我们可以使用<code class="highlighter-rouge">edit</code>命令来编辑 Deployment，修改 <code class="highlighter-rouge">.spec.template.spec.containers[0].image</code> ，将<code class="highlighter-rouge">nginx:1.7.9</code> 改写成 <code class="highlighter-rouge">nginx:1.9.1</code>。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl edit deployment/nginx-deployment
deployment <span class="s2">"nginx-deployment"</span> edited
</code></pre></div></div>

<p>查看 rollout 的状态，只要执行：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout status deployment/nginx-deployment
Waiting <span class="k">for </span>rollout to finish: 2 out of 3 new replicas have been updated...
deployment <span class="s2">"nginx-deployment"</span> successfully rolled out
</code></pre></div></div>

<p>Rollout 成功后，<code class="highlighter-rouge">get</code> Deployment：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployments
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           36s
</code></pre></div></div>

<p>UP-TO-DATE 的 replica 的数目已经达到了配置中要求的数目。</p>

<p>CURRENT 的 replica 数表示 Deployment 管理的 replica 数量，AVAILABLE 的 replica 数是当前可用的 replica 数量。</p>

<p>我们通过执行<code class="highlighter-rouge">kubectl get rs</code>可以看到 Deployment 更新了 Pod，通过创建一个新的 ReplicaSet 并扩容了3个 replica，同时将原来的 ReplicaSet 缩容到了0个 replica。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
nginx-deployment-1564180365   3         3         0       6s
nginx-deployment-2035384211   0         0         0       36s
</code></pre></div></div>

<p>执行 <code class="highlighter-rouge">get pods</code>只会看到当前的新的 pod:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods
NAME                                READY     STATUS    RESTARTS   AGE
nginx-deployment-1564180365-khku8   1/1       Running   0          14s
nginx-deployment-1564180365-nacti   1/1       Running   0          14s
nginx-deployment-1564180365-z9gth   1/1       Running   0          14s
</code></pre></div></div>

<p>下次更新这些 pod 的时候，只需要更新 Deployment 中的 pod 的 template 即可。</p>

<p>Deployment 可以保证在升级时只有一定数量的 Pod 是 down 的。默认的，它会确保至少有比期望的 Pod 数量少一个是 up 状态（最多一个不可用）。</p>

<p>Deployment 同时也可以确保只创建出超过期望数量的一定数量的 Pod。默认的，它会确保最多比期望的 Pod 数量多一个的 Pod 是 up 的（最多1个 surge ）。</p>

<p><strong>在未来的 Kubernetes 版本中，将从1-1变成25%-25%。</strong></p>

<p>例如，如果您自己看下上面的 Deployment，您会发现，开始创建一个新的 Pod，然后删除一些旧的 Pod 再创建一个新的。当新的Pod创建出来之前不会杀掉旧的 Pod。这样能够确保可用的 Pod 数量至少有2个，Pod 的总数最多4个。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl describe deployments
Name:           nginx-deployment
Namespace:      default
CreationTimestamp:  Tue, 15 Mar 2016 12:01:06 <span class="nt">-0700</span>
Labels:         <span class="nv">app</span><span class="o">=</span>nginx
Selector:       <span class="nv">app</span><span class="o">=</span>nginx
Replicas:       3 updated | 3 total | 3 available | 0 unavailable
StrategyType:       RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
OldReplicaSets:     &lt;none&gt;
NewReplicaSet:      nginx-deployment-1564180365 <span class="o">(</span>3/3 replicas created<span class="o">)</span>
Events:
  FirstSeen LastSeen    Count   From                     SubobjectPath   Type        Reason              Message
  <span class="nt">---------</span> <span class="nt">--------</span>    <span class="nt">-----</span>   <span class="nt">----</span>                     <span class="nt">-------------</span>   <span class="nt">--------</span>    <span class="nt">------</span>              <span class="nt">-------</span>
  36s       36s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-2035384211 to 3
  23s       23s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 1
  23s       23s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-2035384211 to 2
  23s       23s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 2
  21s       21s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-2035384211 to 0
  21s       21s         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                 Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 3
</code></pre></div></div>

<p>我们可以看到当我们刚开始创建这个 Deployment 的时候，创建了一个 ReplicaSet（nginx-deployment-2035384211），并直接扩容到了3个 replica。</p>

<p>当我们更新这个 Deployment 的时候，它会创建一个新的 ReplicaSet（nginx-deployment-1564180365），将它扩容到1个 replica，然后缩容原先的 ReplicaSet 到2个 replica，此时满足至少2个 Pod 是可用状态，同一时刻最多有4个 Pod 处于创建的状态。</p>

<p>接着继续使用相同的 rolling update 策略扩容新的 ReplicaSet 和缩容旧的 ReplicaSet。最终，将会在新的 ReplicaSet 中有3个可用的 replica，旧的 ReplicaSet 的 replica 数目变成0。</p>

<h3 id="rollover多个rollout并行">Rollover（多个rollout并行）</h3>

<p>每当 Deployment controller 观测到有新的 Deployment 被创建时，如果没有已存在的 ReplicaSet 来创建期望个数的 Pod 的话，就会创建出一个新的 ReplicaSet 来做这件事。已存在的 ReplicaSet 控制 label 与<code class="highlighter-rouge">.spec.selector</code>匹配但是 template 跟<code class="highlighter-rouge">.spec.template</code>不匹配的 Pod 缩容。最终，新的 ReplicaSet 将会扩容出<code class="highlighter-rouge">.spec.replicas</code>指定数目的 Pod，旧的 ReplicaSet 会缩容到0。</p>

<p>如果您更新了一个的已存在并正在进行中的 Deployment，每次更新 Deployment都会创建一个新的 ReplicaSet并扩容它，同时回滚之前扩容的 ReplicaSet ——将它添加到旧的 ReplicaSet 列表中，开始缩容。</p>

<p>例如，假如您创建了一个有5个<code class="highlighter-rouge">niginx:1.7.9</code> replica 的 Deployment，但是当还只有3个<code class="highlighter-rouge">nginx:1.7.9</code>的 replica 创建出来的时候您就开始更新含有5个<code class="highlighter-rouge">nginx:1.9.1</code> replica 的 Deployment。在这种情况下，Deployment 会立即杀掉已创建的3个<code class="highlighter-rouge">nginx:1.7.9</code>的 Pod，并开始创建<code class="highlighter-rouge">nginx:1.9.1</code>的 Pod。它不会等到所有的5个<code class="highlighter-rouge">nginx:1.7.9</code>的 Pod 都创建完成后才开始改变航道。</p>

<h3 id="检查-deployment-升级的历史记录">检查 Deployment 升级的历史记录</h3>

<p>首先，检查下 Deployment 的 revision：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout <span class="nb">history </span>deployment/nginx-deployment
deployments <span class="s2">"nginx-deployment"</span>:
REVISION    CHANGE-CAUSE
1           kubectl create <span class="nt">-f</span> docs/user-guide/nginx-deployment.yaml <span class="nt">--record</span>
2           kubectl <span class="nb">set </span>image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
3           kubectl <span class="nb">set </span>image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.91
</code></pre></div></div>

<p>因为我们创建 Deployment 的时候使用了<code class="highlighter-rouge">--record</code>参数可以记录命令，我们可以很方便的查看每次 revision 的变化。</p>

<p>查看单个revision 的详细信息：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout <span class="nb">history </span>deployment/nginx-deployment <span class="nt">--revision</span><span class="o">=</span>2
deployments <span class="s2">"nginx-deployment"</span> revision 2
  Labels:       <span class="nv">app</span><span class="o">=</span>nginx
          pod-template-hash<span class="o">=</span>1159050644
  Annotations:  kubernetes.io/change-cause<span class="o">=</span>kubectl <span class="nb">set </span>image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
  Containers:
   nginx:
    Image:      nginx:1.9.1
    Port:       80/TCP
     QoS Tier:
        cpu:      BestEffort
        memory:   BestEffort
    Environment Variables:      &lt;none&gt;
  No volumes.
</code></pre></div></div>

<h3 id="回退到历史版本">回退到历史版本</h3>

<p>现在，我们可以决定回退当前的 rollout 到之前的版本：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout undo deployment/nginx-deployment
deployment <span class="s2">"nginx-deployment"</span> rolled back
</code></pre></div></div>

<p>也可以使用 <code class="highlighter-rouge">--revision</code>参数指定某个历史版本：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout undo deployment/nginx-deployment <span class="nt">--to-revision</span><span class="o">=</span>2
deployment <span class="s2">"nginx-deployment"</span> rolled back
</code></pre></div></div>

<p>与 rollout 相关的命令详细文档见<a href="docs/user-guide/kubectl/v1.6/#rollout">kubectl rollout</a>。</p>

<p>该 Deployment 现在已经回退到了先前的稳定版本。如您所见，Deployment controller 产生了一个回退到 revison 2的<code class="highlighter-rouge">DeploymentRollback</code>的 event。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployment
NAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3         3         3            3           30m

<span class="nv">$ </span>kubectl describe deployment
Name:           nginx-deployment
Namespace:      default
CreationTimestamp:  Tue, 15 Mar 2016 14:48:04 <span class="nt">-0700</span>
Labels:         <span class="nv">app</span><span class="o">=</span>nginx
Selector:       <span class="nv">app</span><span class="o">=</span>nginx
Replicas:       3 updated | 3 total | 3 available | 0 unavailable
StrategyType:       RollingUpdate
MinReadySeconds:    0
RollingUpdateStrategy:  1 max unavailable, 1 max surge
OldReplicaSets:     &lt;none&gt;
NewReplicaSet:      nginx-deployment-1564180365 <span class="o">(</span>3/3 replicas created<span class="o">)</span>
Events:
  FirstSeen LastSeen    Count   From                    SubobjectPath   Type        Reason              Message
  <span class="nt">---------</span> <span class="nt">--------</span>    <span class="nt">-----</span>   <span class="nt">----</span>                    <span class="nt">-------------</span>   <span class="nt">--------</span>    <span class="nt">------</span>              <span class="nt">-------</span>
  30m       30m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-2035384211 to 3
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 1
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-2035384211 to 2
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 2
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-2035384211 to 0
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-3066724191 to 2
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-3066724191 to 1
  29m       29m         1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-1564180365 to 2
  2m        2m          1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled down replica <span class="nb">set </span>nginx-deployment-3066724191 to 0
  2m        2m          1       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      DeploymentRollback  Rolled back deployment <span class="s2">"nginx-deployment"</span> to revision 2
  29m       2m          2       <span class="o">{</span>deployment-controller <span class="o">}</span>                Normal      ScalingReplicaSet   Scaled up replica <span class="nb">set </span>nginx-deployment-1564180365 to 3
</code></pre></div></div>

<h2 id="deployment-扩容">Deployment 扩容</h2>

<p>您可以使用以下命令扩容 Deployment：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl scale deployment nginx-deployment <span class="nt">--replicas</span> 10
deployment <span class="s2">"nginx-deployment"</span> scaled
</code></pre></div></div>

<p>假设您的集群中启用了<a href="docs/tasks/run-application/horizontal-pod-autoscale-walkthrough">horizontal pod autoscaling</a>，您可以给 Deployment 设置一个 autoscaler，基于当前 Pod的 CPU 利用率选择最少和最多的 Pod 数。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl autoscale deployment nginx-deployment <span class="nt">--min</span><span class="o">=</span>10 <span class="nt">--max</span><span class="o">=</span>15 <span class="nt">--cpu-percent</span><span class="o">=</span>80
deployment <span class="s2">"nginx-deployment"</span> autoscaled
</code></pre></div></div>

<h3 id="比例扩容">比例扩容</h3>

<p>RollingUpdate Deployment 支持同时运行一个应用的多个版本。或者 autoscaler 扩容 RollingUpdate Deployment 的时候，正在中途的 rollout（进行中或者已经暂停的），为了降低风险，Deployment controller 将会平衡已存在的活动中的 ReplicaSet（有 Pod 的 ReplicaSet）和新加入的 replica。这被称为比例扩容。</p>

<p>例如，您正在运行中含有10个 replica 的 Deployment。maxSurge=3，maxUnavailable=2。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deploy
NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment     10        10        10           10          50s
</code></pre></div></div>

<p>您更新了一个镜像，而在集群内部无法解析。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">set </span>image deploy/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:sometag
deployment <span class="s2">"nginx-deployment"</span> image updated
</code></pre></div></div>

<p>镜像更新启动了一个包含 ReplicaSet nginx-deployment-1989198191 的新的 rollout，但是它被阻塞了，因为我们上面提到的 maxUnavailable。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get rs
NAME                          DESIRED   CURRENT   READY     AGE
nginx-deployment-1989198191   5         5         0         9s
nginx-deployment-618515232    8         8         8         1m
</code></pre></div></div>

<p>然后发起了一个新的 Deployment 扩容请求。autoscaler将 Deployment 的repllica数目增加到了15个。Deployment controller需要判断在哪里增加这5个新的 replica。如果我们没有谁用比例扩容，所有的5个 replica 都会加到一个新的ReplicaSet中。如果使用比例扩容，新添加的 replica 将传播到所有的 ReplicaSet 中。大的部分加入 replica 数最多的 ReplicaSet中，小的部分加入到replica数少的 ReplciaSet中。0个replica的 ReplicaSet 不会被扩容。</p>

<p>在我们上面的例子中，3个 replica 将添加到旧的 ReplicaSet 中，2个 replica 将添加到新的 ReplicaSet 中。rollout 进程最终会将所有的 replica 移动到新的 ReplicaSet 中，假设新的 replica 成为健康状态。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deploy
NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment     15        18        7            8           7m
<span class="nv">$ </span>kubectl get rs
NAME                          DESIRED   CURRENT   READY     AGE
nginx-deployment-1989198191   7         7         0         7m
nginx-deployment-618515232    11        11        11        7m
</code></pre></div></div>

<h2 id="暂停和恢复-deployment">暂停和恢复 Deployment</h2>

<p>您可以在发出一次或多次更新前暂停一个 Deployment，然后再恢复它。这样您就能多次暂停和恢复 Deployment，在此期间进行一些修复工作，而不会发出不必要的 rollout。</p>

<p>例如使用刚刚创建 Deployment：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deploy
NAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx     3         3         3            3           1m
<span class="o">[</span>mkargaki@dhcp129-211 kubernetes]<span class="nv">$ </span>kubectl get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   3         3         3         1m
</code></pre></div></div>

<p>使用以下命令暂停 Deployment：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout pause deployment/nginx-deployment
deployment <span class="s2">"nginx-deployment"</span> paused
</code></pre></div></div>

<p>然后更新 Deplyment 中的镜像：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">set </span>image deploy/nginx <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
deployment <span class="s2">"nginx-deployment"</span> image updated
</code></pre></div></div>

<p>注意新的 rollout 启动了：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout <span class="nb">history </span>deploy/nginx
deployments <span class="s2">"nginx"</span>
REVISION  CHANGE-CAUSE
1   &lt;none&gt;

<span class="nv">$ </span>kubectl get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   3         3         3         2m
</code></pre></div></div>

<p>您可以进行任意多次更新，例如更新使用的资源：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nb">set </span>resources deployment nginx <span class="nt">-c</span><span class="o">=</span>nginx <span class="nt">--limits</span><span class="o">=</span><span class="nv">cpu</span><span class="o">=</span>200m,memory<span class="o">=</span>512Mi
deployment <span class="s2">"nginx"</span> resource requirements updated
</code></pre></div></div>

<p>Deployment 暂停前的初始状态将继续它的功能，而不会对 Deployment 的更新产生任何影响，只要 Deployment 是暂停的。</p>

<p>最后，恢复这个 Deployment，观察完成更新的 ReplicaSet 已经创建出来了：</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout resume deploy nginx
deployment <span class="s2">"nginx"</span> resumed
<span class="nv">$ </span>KUBECTL get rs <span class="nt">-w</span>
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   2         2         2         2m
nginx-3926361531   2         2         0         6s
nginx-3926361531   2         2         1         18s
nginx-2142116321   1         2         2         2m
nginx-2142116321   1         2         2         2m
nginx-3926361531   3         2         1         18s
nginx-3926361531   3         2         1         18s
nginx-2142116321   1         1         1         2m
nginx-3926361531   3         3         1         18s
nginx-3926361531   3         3         2         19s
nginx-2142116321   0         1         1         2m
nginx-2142116321   0         1         1         2m
nginx-2142116321   0         0         0         2m
nginx-3926361531   3         3         3         20s
^C
<span class="nv">$ </span>KUBECTL get rs
NAME               DESIRED   CURRENT   READY     AGE
nginx-2142116321   0         0         0         2m
nginx-3926361531   3         3         3         28s
</code></pre></div></div>

<p><strong>注意：</strong> 在恢复 Deployment 之前您无法回退一个已经暂停的 Deployment。</p>

<h2 id="deployment-状态">Deployment 状态</h2>

<p>Deployment 在生命周期中有多种状态。在创建一个新的 ReplicaSet 的时候它可以是 <a href="docs/concepts/workloads/controllers/deployment.md#progressing-deployment">progressing</a> 状态， <a href="docs/concepts/workloads/controllers/deployment.md#complete-deployment">complete</a> 状态，或者 <a href="docs/concepts/workloads/controllers/deployment.md#failed-deployment">fail to progress </a>状态。</p>

<h3 id="进行中的-deployment">进行中的 Deployment</h3>

<p>Kubernetes 将执行过下列任务之一的 Deployment 标记为 <em>progressing</em> 状态：</p>

<ul>
  <li>Deployment 正在创建新的 ReplicaSet 过程中。</li>
  <li>Deployment 正在扩容一个已有的 ReplicaSet。</li>
  <li>Deployment 正在缩容一个已有的 ReplicaSet。</li>
  <li>有新的可用的 pod 出现。</li>
</ul>

<p>您可以使用<code class="highlighter-rouge">kubectl rollout status</code>命令监控 Deployment 的进度。</p>

<h3 id="完成的-deployment">完成的 Deployment</h3>

<p>Kubernetes 将包括以下特性的 Deployment 标记为 <em>complete</em> 状态：</p>

<ul>
  <li>Deployment 最小可用。最小可用意味着 Deployment 的可用 replica 个数等于或者超过 Deployment 策略中的期望个数。</li>
  <li>所有与该 Deployment 相关的 replica 都被更新到了您指定版本，也就说更新完成。</li>
  <li>该 Deployment 中没有旧的 Pod 存在。</li>
</ul>

<p>您可以用<code class="highlighter-rouge">kubectl rollout status</code>命令查看 Deployment 是否完成。如果 rollout 成功完成，<code class="highlighter-rouge">kubectl rollout status</code>将返回一个0值的 Exit Code。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl rollout status deploy/nginx
Waiting for rollout to finish: 2 of 3 updated replicas are available...
deployment "nginx" successfully rolled out
$ echo $?
0
</code></pre></div></div>

<h3 id="失败的-deployment">失败的 Deployment</h3>

<p>您的 Deployment 在尝试部署新的 ReplicaSet 的时候可能卡住，用于也不会完成。这可能是因为以下几个因素引起的：</p>

<ul>
  <li>无效的引用</li>
  <li>不可读的 probe failure</li>
  <li>镜像拉取错误</li>
  <li>权限不够</li>
  <li>范围限制</li>
  <li>程序运行时配置错误</li>
</ul>

<p>探测这种情况的一种方式是，在您的 Deployment spec 中指定<a href="docs/concepts/workloads/controllers/deployment.md#progress-deadline-seconds"><code class="highlighter-rouge">spec.progressDeadlineSeconds</code></a>。<code class="highlighter-rouge">spec.progressDeadlineSeconds</code> 表示 Deployment controller 等待多少秒才能确定（通过 Deployment status）Deployment 进程是卡住的。</p>

<p>下面的<code class="highlighter-rouge">kubectl</code>命令设置<code class="highlighter-rouge">progressDeadlineSeconds</code> 使 controller 在 Deployment 在进度卡住10分钟后报告：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl patch deployment/nginx-deployment -p '{"spec":{"progressDeadlineSeconds":600}}'
"nginx-deployment" patched
</code></pre></div></div>

<p>当超过截止时间后，Deployment controller 会在 Deployment 的 <code class="highlighter-rouge">status.conditions</code>中增加一条 DeploymentCondition，它包括如下属性：</p>

<ul>
  <li>Type=Progressing</li>
  <li>Status=False</li>
  <li>Reason=ProgressDeadlineExceeded</li>
</ul>

<p>浏览 <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#typical-status-properties">Kubernetes API conventions</a> 查看关于status conditions的更多信息。</p>

<p><strong>注意：</strong> kubernetes除了报告<code class="highlighter-rouge">Reason=ProgressDeadlineExceeded</code>状态信息外不会对卡住的 Deployment 做任何操作。更高层次的协调器可以利用它并采取相应行动，例如，回滚 Deployment 到之前的版本。</p>

<p><strong>注意：</strong> 如果您暂停了一个 Deployment，在暂停的这段时间内kubernetnes不会检查您指定的 deadline。您可以在 Deployment 的 rollout 途中安全的暂停它，然后再恢复它，这不会触发超过 deadline 的状态。</p>

<p>您可能在使用 Deployment 的时候遇到一些短暂的错误，这些可能是由于您设置了太短的 timeout，也有可能是因为各种其他错误导致的短暂错误。例如，假设您使用了无效的引用。当您 Describe Deployment 的时候可能会注意到如下信息：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl describe deployment nginx-deployment
&lt;...&gt;
Conditions:
  Type            Status  Reason
  ----            ------  ------
  Available       True    MinimumReplicasAvailable
  Progressing     True    ReplicaSetUpdated
  ReplicaFailure  True    FailedCreate
&lt;...&gt;
</code></pre></div></div>

<p>执行 <code class="highlighter-rouge">kubectl get deployment nginx-deployment -o yaml</code>，Deployement 的状态可能看起来像这个样子：</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">status</span><span class="pi">:</span>
  <span class="na">availableReplicas</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">conditions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">lastTransitionTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:39Z</span>
    <span class="na">lastUpdateTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:39Z</span>
    <span class="na">message</span><span class="pi">:</span> <span class="s">Replica set "nginx-deployment-4262182780" is progressing.</span>
    <span class="na">reason</span><span class="pi">:</span> <span class="s">ReplicaSetUpdated</span>
    <span class="na">status</span><span class="pi">:</span> <span class="s2">"</span><span class="s">True"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">Progressing</span>
  <span class="pi">-</span> <span class="na">lastTransitionTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:42Z</span>
    <span class="na">lastUpdateTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:42Z</span>
    <span class="na">message</span><span class="pi">:</span> <span class="s">Deployment has minimum availability.</span>
    <span class="na">reason</span><span class="pi">:</span> <span class="s">MinimumReplicasAvailable</span>
    <span class="na">status</span><span class="pi">:</span> <span class="s2">"</span><span class="s">True"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">Available</span>
  <span class="pi">-</span> <span class="na">lastTransitionTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:39Z</span>
    <span class="na">lastUpdateTime</span><span class="pi">:</span> <span class="s">2016-10-04T12:25:39Z</span>
    <span class="na">message</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Error</span><span class="nv"> </span><span class="s">creating:</span><span class="nv"> </span><span class="s">pods</span><span class="nv"> </span><span class="s">"nginx-deployment-4262182780-"</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">forbidden:</span><span class="nv"> </span><span class="s">exceeded</span><span class="nv"> </span><span class="s">quota:</span>
      <span class="s">object-counts,</span><span class="nv"> </span><span class="s">requested:</span><span class="nv"> </span><span class="s">pods=1,</span><span class="nv"> </span><span class="s">used:</span><span class="nv"> </span><span class="s">pods=3,</span><span class="nv"> </span><span class="s">limited:</span><span class="nv"> </span><span class="s">pods=2'</span>
    <span class="na">reason</span><span class="pi">:</span> <span class="s">FailedCreate</span>
    <span class="na">status</span><span class="pi">:</span> <span class="s2">"</span><span class="s">True"</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">ReplicaFailure</span>
  <span class="na">observedGeneration</span><span class="pi">:</span> <span class="s">3</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">unavailableReplicas</span><span class="pi">:</span> <span class="s">2</span>
</code></pre></div></div>

<p>最终，一旦超过 Deployment 进程的 deadline，kubernetes 会更新状态和导致 Progressing 状态的原因：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Conditions:
  Type            Status  Reason
  ----            ------  ------
  Available       True    MinimumReplicasAvailable
  Progressing     False   ProgressDeadlineExceeded
  ReplicaFailure  True    FailedCreate
</code></pre></div></div>

<p>您可以通过缩容 Deployment的方式解决配额不足的问题，或者增加您的 namespace 的配额。如果您满足了配额条件后，Deployment controller 就会完成您的 Deployment rollout，您将看到 Deployment 的状态更新为成功状态（<code class="highlighter-rouge">Status=True</code>并且<code class="highlighter-rouge">Reason=NewReplicaSetAvailable</code>）。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Conditions:
  Type          Status  Reason
  ----          ------  ------
  Available     True    MinimumReplicasAvailable
  Progressing   True    NewReplicaSetAvailable

</code></pre></div></div>

<p><code class="highlighter-rouge">Type=Available</code>、 <code class="highlighter-rouge">Status=True</code> 以为这您的Deployment有最小可用性。 最小可用性是在Deployment策略中指定的参数。<code class="highlighter-rouge">Type=Progressing</code> 、 <code class="highlighter-rouge">Status=True</code>意味着您的 Deployment 或者在部署过程中，或者已经成功部署，达到了期望的最少的可用 replica 数量（查看特定状态的Reason——在我们的例子中<code class="highlighter-rouge">Reason=NewReplicaSetAvailable</code> 意味着 Deployment 已经完成）。</p>

<p>您可以使用<code class="highlighter-rouge">kubectl rollout status</code>命令查看 Deployment 进程是否失败。当 Deployment 过程超过了 deadline，<code class="highlighter-rouge">kubectl rollout status</code>将返回非0的 exit code。</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout status deploy/nginx
Waiting <span class="k">for </span>rollout to finish: 2 out of 3 new replicas have been updated...
error: deployment <span class="s2">"nginx"</span> exceeded its progress deadline
<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$?</span>
1
</code></pre></div></div>

<h3 id="操作失败的-deployment">操作失败的 Deployment</h3>

<p>所有对完成的 Deployment 的操作都适用于失败的 Deployment。您可以对它扩/缩容，回退到历史版本，您甚至可以多次暂停它来应用 Deployment pod template。</p>

<h2 id="清理-policy">清理 Policy</h2>

<p>您可以设置 Deployment 中的 <code class="highlighter-rouge">.spec.revisionHistoryLimit</code> 项来指定保留多少旧的 ReplicaSet。 余下的将在后台被当作垃圾收集。默认的，所有的 revision 历史就都会被保留。在未来的版本中，将会更改为2。</p>

<p><strong>注意：</strong> 将该值设置为0，将导致所有的 Deployment 历史记录都会被清除，该 Deployment 就无法再回退了。</p>

<h2 id="用例">用例</h2>

<h3 id="金丝雀-deployment">金丝雀 Deployment</h3>

<p>如果您想要使用 Deployment 对部分用户或服务器发布 release，您可以创建多个 Deployment，每个 Deployment 对应一个 release，参照 <a href="docs/concepts/cluster-administration/manage-deployment/#canary-deployments">managing resources</a> 中对金丝雀模式的描述。</p>

<h2 id="编写-deployment-spec">编写 Deployment Spec</h2>

<p>在所有的 Kubernetes 配置中，Deployment 也需要<code class="highlighter-rouge">apiVersion</code>，<code class="highlighter-rouge">kind</code>和<code class="highlighter-rouge">metadata</code>这些配置项。配置文件的通用使用说明查看 <a href="docs/tutorials/stateless-application/run-stateless-application-deployment">部署应用</a>，配置容器，和 <a href="docs/tutorials/object-management-kubectl/object-management">使用kubeclt管理资源 </a>文档。</p>

<p>Deployment 也需要 <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/api-conventions.md#spec-and-status"><code class="highlighter-rouge">.spec</code> section</a>.</p>

<h3 id="pod-template">Pod Template</h3>

<p><code class="highlighter-rouge">.spec.template</code> 是 <code class="highlighter-rouge">.spec</code>中唯一要求的字段。</p>

<p><code class="highlighter-rouge">.spec.template</code> 是 <a href="docs/user-guide/replication-controller/#pod-template">pod template</a>. 它跟 <a href="docs/user-guide/pods">Pod</a>有一模一样的schema，除了它是嵌套的并且不需要<code class="highlighter-rouge">apiVersion</code> 和 <code class="highlighter-rouge">kind</code>字段。</p>

<p>另外为了划分 Pod 的范围，Deployment 中的 pod template 必须指定适当的 label（不要跟其他 controller 重复了，参考<a href="docs/concepts/workloads/controllers/deployment.md#selector">selector</a>）和适当的重启策略。</p>

<p><a href="docs/concepts/workloads/pods/pod-lifecycle"><code class="highlighter-rouge">.spec.template.spec.restartPolicy</code></a> 可以设置为 <code class="highlighter-rouge">Always</code> , 如果不指定的话这就是默认配置。</p>

<h3 id="replicas">Replicas</h3>

<p><code class="highlighter-rouge">.spec.replicas</code> 是可以选字段，指定期望的 pod 数量，默认是1。</p>

<h3 id="selector">Selector</h3>

<p><code class="highlighter-rouge">.spec.selector</code>是可选字段，用来指定 <a href="docs/concepts/overview/working-with-objects/labels">label selector</a> ，圈定 Deployment 管理的 pod 范围。</p>

<p>如果被指定， <code class="highlighter-rouge">.spec.selector</code> 必须匹配 <code class="highlighter-rouge">.spec.template.metadata.labels</code>，否则它将被API拒绝。如果 <code class="highlighter-rouge">.spec.selector</code> 没有被指定， <code class="highlighter-rouge">.spec.selector.matchLabels</code> 默认是 <code class="highlighter-rouge">.spec.template.metadata.labels</code>。</p>

<p>在 Pod 的 template 跟<code class="highlighter-rouge">.spec.template</code>不同或者数量超过了<code class="highlighter-rouge">.spec.replicas</code>规定的数量的情况下，Deployment 会杀掉 label 跟 selector 不同的 Pod。</p>

<p><strong>注意：</strong> 您不应该再创建其他 label 跟这个 selector 匹配的 pod，或者通过其他 Deployment，或者通过其他 Controller，例如 ReplicaSet 和 ReplicationController。否则该 Deployment 会被把它们当成都是自己创建的。Kubernetes不会阻止您这么做。</p>

<p>如果您有多个 controller 使用了重复的 selector，controller 们就会互相打架并导致不正确的行为。</p>

<h3 id="策略">策略</h3>

<p><code class="highlighter-rouge">.spec.strategy</code> 指定新的 Pod 替换旧的 Pod 的策略。 <code class="highlighter-rouge">.spec.strategy.type</code> 可以是”Recreate”或者是 “RollingUpdate”。”RollingUpdate”是默认值。</p>

<h4 id="recreate-deployment">Recreate Deployment</h4>

<p><code class="highlighter-rouge">.spec.strategy.type==Recreate</code>时，在创建出新的 Pod 之前会先杀掉所有已存在的 Pod。</p>

<h4 id="rolling-update-deployment">Rolling Update Deployment</h4>

<p><code class="highlighter-rouge">.spec.strategy.type==RollingUpdate</code>时，Deployment使用<a href="docs/tasks/run-application/rolling-update-replication-controller">rolling update</a> 的方式更新 Pod 。您可以指定<code class="highlighter-rouge">maxUnavailable</code> 和 <code class="highlighter-rouge">maxSurge</code> 来控制 rolling update 进程。</p>

<h5 id="max-unavailable">Max Unavailable</h5>

<p><code class="highlighter-rouge">.spec.strategy.rollingUpdate.maxUnavailable</code> 是可选配置项，用来指定在升级过程中不可用Pod的最大数量。该值可以是一个绝对值（例如5），也可以是期望 Pod 数量的百分比（例如10%）。通过计算百分比的绝对值向下取整。如果<code class="highlighter-rouge">.spec.strategy.rollingUpdate.maxSurge</code> 为0时，这个值不可以为0。默认值是1。</p>

<p>例如，该值设置成30%，启动 rolling update 后旧的 ReplicatSet 将会立即缩容到期望的Pod数量的70%。新的 Pod ready 后，随着新的 ReplicaSet 的扩容，旧的 ReplicaSet 会进一步缩容，确保在升级的所有时刻可以用的 Pod 数量至少是期望   Pod 数量的70%。</p>

<h5 id="max-surge">Max Surge</h5>

<p><code class="highlighter-rouge">.spec.strategy.rollingUpdate.maxSurge</code> 是可选配置项，用来指定可以超过期望的 Pod 数量的最大个数。该值可以是一个绝对值（例如5）或者是期望的Pod数量的百分比（例如10%）。当<code class="highlighter-rouge">MaxUnavailable</code>为0时该值不可以为0。通过百分比计算的绝对值向上取整。默认值是1。</p>

<p>例如，该值设置成30%，启动 rolling update 后新的 ReplicatSet 将会立即扩容，新老 Pod 的总数不能超过期望的 Pod 数量的130%。旧的 Pod 被杀掉后，新的 ReplicaSet 将继续扩容，旧的 ReplicaSet 会进一步缩容，确保在升级的所有时刻所有的 Pod 数量和不会超过期望 Pod 数量的130%。</p>

<h3 id="progress-deadline-seconds">Progress Deadline Seconds</h3>

<p><code class="highlighter-rouge">.spec.progressDeadlineSeconds</code> 是可选配置项，用来指定在系统报告 Deployment 的<a href="docs/concepts/workloads/controllers/deployment.md#failed-deployment">failed progressing</a> ——表现为 resource 的状态中<code class="highlighter-rouge">type=Progressing</code>、<code class="highlighter-rouge">Status=False</code>、 <code class="highlighter-rouge">Reason=ProgressDeadlineExceeded</code>前可以等待的 Deployment 进行的秒数。Deployment controller 会继续重试该 Deployment。未来，在实现了自动回滚后， deployment controller 在观察到这种状态时就会自动回滚。</p>

<p>如果设置该参数，该值必须大于 <code class="highlighter-rouge">.spec.minReadySeconds</code>。</p>

<h3 id="min-ready-seconds">Min Ready Seconds</h3>

<p><code class="highlighter-rouge">.spec.minReadySeconds</code>是一个可选配置项，用来指定没有任何容器 crash 的 Pod 并被认为是可用状态的最小秒数。默认是0（Pod 在 ready 后就会被认为是可用状态）。进一步了解什么什么后 Pod 会被认为是 ready 状态，参阅 <a href="docs/concepts/workloads/pods/pod-lifecycle/#container-probes">Container Probes</a>。</p>

<h3 id="rollback-to">Rollback To</h3>

<p><code class="highlighter-rouge">.spec.rollbackTo</code> 是一个可以选配置项，用来配置 Deployment 回退的配置。设置该参数将触发回退操作，每次回退完成后，该值就会被清除。</p>

<h4 id="revision">Revision</h4>

<p><code class="highlighter-rouge">.spec.rollbackTo.revision</code>是一个可选配置项，用来指定回退到的 revision。默认是0，意味着回退到最近一次的 revision。</p>

<h3 id="revision-history-limit">Revision History Limit</h3>

<p>Deployment revision history 存储在它控制的 ReplicaSets 中。</p>

<p><code class="highlighter-rouge">.spec.revisionHistoryLimit</code> 是一个可选配置项，用来指定可以保留的旧的 ReplicaSet 数量。该理想值取决于新 Deployment 的频率和稳定性。如果该值没有设置的话，默认所有旧的 Replicaset 或会被保留，将资源存储在 etcd 中，是用<code class="highlighter-rouge">kubectl get rs</code>查看输出。每个 Deployment 的该配置都保存在 ReplicaSet 中，然而，一旦您删除的旧的 RepelicaSet，您的 Deployment 就无法再回退到那个 revison 了。</p>

<p>如果您将该值设置为0，所有具有0个 replica 的 ReplicaSet 都会被删除。在这种情况下，新的 Deployment rollout 无法撤销，因为 revision history 都被清理掉了。</p>

<h3 id="paused">Paused</h3>

<p><code class="highlighter-rouge">.spec.paused</code>是可以可选配置项，boolean 值。用来指定暂停和恢复 Deployment。Paused 和没有 paused 的 Deployment 之间的唯一区别就是，所有对 paused deployment 中的 PodTemplateSpec 的修改都不会触发新的 rollout。Deployment 被创建之后默认是非 paused。</p>

<h2 id="deployment-的替代选择">Deployment 的替代选择</h2>

<h3 id="kubectl-rolling-update">kubectl rolling update</h3>

<p><a href="docs/user-guide/kubectl/v1.6/#rolling-update">Kubectl rolling update</a> 虽然使用类似的方式更新 Pod 和 ReplicationController。但是我们推荐使用 Deployment，因为它是声明式的，客户端侧，具有附加特性，例如即使滚动升级结束后也可以回滚到任何历史版本。</p>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/concepts/workloads/controllers/deployment.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/concepts/workloads/controllers/deployment/",
                "title" : "Deployment",
                "permalink" : "https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/concepts/workloads/controllers/deployment.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
