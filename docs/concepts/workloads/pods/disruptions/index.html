
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Concepts">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Disruption(中断)" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Disruption(中断) | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="Disruption(中断)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/concepts/workloads/pods/disruptions/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/concepts/workloads/pods/disruptions/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/concepts/workloads/pods/disruptions/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"Disruption(中断)","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/concepts/workloads/pods/disruptions/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/concepts/workloads/pods/disruptions/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/concepts/workloads/pods/disruptions/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/concepts/workloads/pods/disruptions/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Concepts</h1>
  <h5>Detailed explanations of Kubernetes system concepts and abstractions.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" class="YAH">CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="概念" href="/docs/concepts/"></a>
    
  

  
    <div class="item" data-title="Overview">
      <div class="container">
        
  

    

    
      <a class="item" data-title="认识 Kubernetes?" href="/docs/concepts/overview/what-is-kubernetes/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 组件" href="/docs/concepts/overview/components/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes API" href="/docs/concepts/overview/kubernetes-api/"></a>
    
  

  
    <div class="item" data-title="Working with Kubernetes Objects">
      <div class="container">
        
  

    

    
      <a class="item" data-title="理解 Kubernetes 对象" href="/docs/concepts/overview/working-with-objects/kubernetes-objects/"></a>
    
  

  

    

    
      <a class="item" data-title="Names" href="/docs/concepts/overview/working-with-objects/names/"></a>
    
  

  

    

    
      <a class="item" data-title="Namespaces" href="/docs/concepts/overview/working-with-objects/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="Labels 和 Selectors" href="/docs/concepts/overview/working-with-objects/labels/"></a>
    
  

  

    

    
      <a class="item" data-title="Annotations" href="/docs/concepts/overview/working-with-objects/annotations/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Object Management Using kubectl">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes 对象管理" href="/docs/concepts/overview/object-management-kubectl/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命令式命令管理 Kubernetes 对象" href="/docs/concepts/overview/object-management-kubectl/imperative-command/"></a>
    
  

  

    

    
      <a class="item" data-title="使用配置文件对 Kubernetes 对象的命令式管理" href="/docs/concepts/overview/object-management-kubectl/imperative-config/"></a>
    
  

  

    

    
      <a class="item" data-title="Declarative Management of Kubernetes Objects Using Configuration Files" href="/docs/concepts/overview/object-management-kubectl/declarative-config/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Architecture">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Nodes" href="/docs/concepts/architecture/nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="Master 节点通信" href="/docs/concepts/architecture/master-node-communication/"></a>
    
  

  

    

    
      <a class="item" data-title="云控制器管理器的基础概念" href="/docs/concepts/architecture/cloud-controller/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extending Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="扩展 Kubernetes 集群" href="/docs/concepts/overview/extending/"></a>
    
  

  
    <div class="item" data-title="Extending the Kubernetes API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用聚合层扩展Kubernetes API" href="/docs/concepts/api-extension/apiserver-aggregation/"></a>
    
  

  

    

    
      <a class="item" data-title="自定义资源" href="/docs/concepts/api-extension/custom-resources/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Compute, Storage, and Networking Extensions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="服务目录" href="/docs/concepts/service-catalog/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="镜像" href="/docs/concepts/containers/images/"></a>
    
  

  

    

    
      <a class="item" data-title="容器环境变量" href="/docs/concepts/containers/container-environment-variables/"></a>
    
  

  

    

    
      <a class="item" data-title="容器生命周期的钩子" href="/docs/concepts/containers/container-lifecycle-hooks/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Workloads">
      <div class="container">
        
  
    <div class="item" data-title="Pods">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Pod Overview" href="/docs/concepts/workloads/pods/pod-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Pods" href="/docs/concepts/workloads/pods/pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 生命周期" href="/docs/concepts/workloads/pods/pod-lifecycle/"></a>
    
  

  

    

    
      <a class="item" data-title="Init 容器" href="/docs/concepts/workloads/pods/init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod Preset" href="/docs/concepts/workloads/pods/podpreset/"></a>
    
  

  

    

    
      <a class="item" data-title="Disruption(中断)" href="/docs/concepts/workloads/pods/disruptions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Controllers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Replica Sets" href="/docs/concepts/workloads/controllers/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="Replication Controller" href="/docs/concepts/workloads/controllers/replicationcontroller/"></a>
    
  

  

    

    
      <a class="item" data-title="Deployment" href="/docs/concepts/workloads/controllers/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="StatefulSet" href="/docs/concepts/workloads/controllers/statefulset/"></a>
    
  

  

    

    
      <a class="item" data-title="Daemon Sets" href="/docs/concepts/workloads/controllers/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="垃圾收集" href="/docs/concepts/workloads/controllers/garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="Jobs - Run to Completion" href="/docs/concepts/workloads/controllers/jobs-run-to-completion/"></a>
    
  

  

    

    
      <a class="item" data-title="Cron Job" href="/docs/concepts/workloads/controllers/cron-jobs/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configuration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="配置最佳实践" href="/docs/concepts/configuration/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="Managing Compute Resources for Containers" href="/docs/concepts/configuration/manage-compute-resources-container/"></a>
    
  

  

    

    
      <a class="item" data-title="分配 Pod 到 Node 上" href="/docs/concepts/configuration/assign-pod-node/"></a>
    
  

  

    

    
      <a class="item" data-title="Taint 和 Toleration" href="/docs/concepts/configuration/taint-and-toleration/"></a>
    
  

  

    

    
      <a class="item" data-title="Secret" href="/docs/concepts/configuration/secret/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeconfig 文件组织集群访问" href="/docs/concepts/configuration/organize-cluster-access-kubeconfig/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 优先级和抢占" href="/docs/concepts/configuration/pod-priority-preemption/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Services, Load Balancing, and Networking">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Service" href="/docs/concepts/services-networking/service/"></a>
    
  

  

    

    
      <a class="item" data-title="DNS Pod 与 Service" href="/docs/concepts/services-networking/dns-pod-service/"></a>
    
  

  

    

    
      <a class="item" data-title="应用连接到 Service" href="/docs/concepts/services-networking/connect-applications-service/"></a>
    
  

  

    

    
      <a class="item" data-title="Ingress resource" href="/docs/concepts/services-networking/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="Network Policies" href="/docs/concepts/services-networking/network-policies/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 HostAliases 向 Pod /etc/hosts 文件添加条目" href="/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Storage">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Volumes" href="/docs/concepts/storage/volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="持久化卷" href="/docs/concepts/storage/persistent-volumes/"></a>
    
  

  

    

    
      <a class="item" data-title="Storage Classes" href="/docs/concepts/storage/storage-classes/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Volume Provisioning" href="/docs/concepts/storage/dynamic-provisioning/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Administration">
      <div class="container">
        
  

    

    
      <a class="item" data-title="集群管理概述" href="/docs/concepts/cluster-administration/cluster-administration-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="证书" href="/docs/concepts/cluster-administration/certificates/"></a>
    
  

  

    

    
      <a class="item" data-title="云供应商" href="/docs/concepts/cluster-administration/cloud-providers/"></a>
    
  

  

    

    
      <a class="item" data-title="管理资源" href="/docs/concepts/cluster-administration/manage-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/concepts/cluster-administration/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="网络插件" href="/docs/concepts/cluster-administration/network-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="日志架构" href="/docs/concepts/cluster-administration/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 kubelet 垃圾收集" href="/docs/concepts/cluster-administration/kubelet-garbage-collection/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦（Federation）" href="/docs/concepts/cluster-administration/federation/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Kubernetes 集群中使用 Sysctl" href="/docs/concepts/cluster-administration/sysctl-cluster/"></a>
    
  

  

    

    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Kubernetes 中的代理" href="/docs/concepts/cluster-administration/proxies/"></a>
    
  

  

    

    
      <a class="item" data-title="Controller manager metrics" href="/docs/concepts/cluster-administration/controller-metrics/"></a>
    
  

  

    

    
      <a class="item" data-title="设备插件" href="/docs/concepts/cluster-administration/device-plugins/"></a>
    
  

  
    <div class="item" data-title="Policies">
      <div class="container">
        
  

    

    
      <a class="item" data-title="资源配额" href="/docs/concepts/policy/resource-quotas/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod 安全策略" href="/docs/concepts/policy/pod-security-policy/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/concepts/workloads/pods/disruptions.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Disruption(中断)</h1>
        

        
<p>本指南适用于要构建高可用应用程序的所有者，因此他们需要了解 Pod 可能发生什么类型的中断。</p>

<p>也适用于要执行自动集群操作的集群管理员，如升级和集群自动扩容。</p>

<ul id="markdown-toc">
  <li><a href="#自愿中断和非自愿中断" id="markdown-toc-自愿中断和非自愿中断">自愿中断和非自愿中断</a></li>
  <li><a href="#处理中断" id="markdown-toc-处理中断">处理中断</a></li>
  <li><a href="#中断预算的工作原理" id="markdown-toc-中断预算的工作原理">中断预算的工作原理</a></li>
  <li><a href="#pdb-示例" id="markdown-toc-pdb-示例">PDB 示例</a></li>
  <li><a href="#分离集群所有者和应用程序所有者角色" id="markdown-toc-分离集群所有者和应用程序所有者角色">分离集群所有者和应用程序所有者角色</a></li>
  <li><a href="#如何在集群上执行中断操作" id="markdown-toc-如何在集群上执行中断操作">如何在集群上执行中断操作</a></li>
  <li><a href="#whats-next" id="markdown-toc-whats-next">What’s next</a></li>
</ul>

<h2 id="自愿中断和非自愿中断">自愿中断和非自愿中断</h2>

<p>Pod 不会消失，直到有人（人类或控制器）将其销毁，或者当出现不可避免的硬件或系统软件错误。</p>

<p>我们把这些不可避免的情况称为应用的非自愿性中断。例如：</p>

<ul>
  <li>后端节点物理机的硬件故障</li>
  <li>集群管理员错误地删除虚拟机（实例）</li>
  <li>云提供商或管理程序故障使虚拟机消失</li>
  <li>内核恐慌（kernel panic）</li>
  <li>节点由于集群网络分区而从集群中消失</li>
  <li>由于节点<a href="/docs/tasks/administer-cluster/out-of-resource.md">资源不足</a>而将容器逐出</li>
</ul>

<p>除资源不足的情况外，大多数用户应该都熟悉以下这些情况；它们不是特定于 Kubernetes 的。</p>

<p>我们称这些情况为”自愿中断“。包括由应用程序所有者发起的操作和由集群管理员发起的操作。典型的应用程序所有者操作包括：</p>

<ul>
  <li>删除管理该 pod 的 Deployment 或其他控制器</li>
  <li>更新了 Deployment 的 pod 模板导致 pod 重启</li>
  <li>直接删除 pod（意外删除）</li>
</ul>

<p>集群管理员操作包括：</p>
<ul>
  <li><a href="/docs//tasks/administer-cluster/safely-drain-node.md">排空（drain）节点</a>进行修复或升级。</li>
  <li>从集群中排空节点以缩小集群（了解<a href="/docs/tasks/administer-cluster/cluster-management/#cluster-autoscaler">集群自动调节</a>）。</li>
  <li>从节点中移除一个 pod，以允许其他 pod 使用该节点。</li>
</ul>

<p>这些操作可能由集群管理员直接执行，也可能由集群管理员或集群托管提供商自动执行。</p>

<p>询问您的集群管理员或咨询您的云提供商或发行文档，以确定是否为您的集群启用了任何自动中断源。如果没有启用，您可以跳过创建 Pod Disruption Budget（Pod 中断预算）。</p>

<h2 id="处理中断">处理中断</h2>

<p>以下是一些减轻非自愿性中断的方法：</p>

<ul>
  <li>确保您的 pod <a href="/docs/tasks/configure-pod-container/assign-cpu-ram-container">请求所需的资源</a>。</li>
  <li>如果您需要更高的可用性，请复制您的应用程序。 （了解有关运行复制的<a href="/docs/tasks/run-application/run-stateless-application-deployment.md">无状态</a>和<a href="/docs/tasks/run-application/run-replicated-stateful-application.md">有状态</a>应用程序的信息。）</li>
  <li>为了在运行复制应用程序时获得更高的可用性，请跨机架（使用<a href="/docs/user-guide/node-selection/#inter-pod-affinity-and-anti-affinity-beta-feature">反亲和性</a>）或跨区域（如果使用<a href="/docs/admin/multiple-zones">多区域集群</a>）分布应用程序。</li>
</ul>

<p>自愿中断的频率各不相同。在 Kubernetes 集群上，根本没有自愿的中断。但是，您的集群管理员或托管提供商可能会运行一些导致自愿中断的附加服务。例如，节点软件更新可能导致自愿更新。另外，集群（节点）自动缩放的某些实现可能会导致碎片整理和紧缩节点的自愿中断。您的集群管理员或主机提供商应该已经记录了期望的自愿中断级别（如果有的话）。</p>

<p>Kubernetes 提供的功能可以满足在频繁地自动中断的同时运行高可用的应用程序。我们称之为“中断预算”。</p>

<h2 id="中断预算的工作原理">中断预算的工作原理</h2>

<p>应用程序所有者可以为每个应用程序创建一个 <code class="highlighter-rouge">PodDisruptionBudget</code> 对象（PDB）。 PDB 将限制在同一时间自愿中断的复制应用程序中宕机的 Pod 的数量。例如，基于定额的应用程序希望确保运行的副本数量永远不会低于仲裁所需的数量。Web 前端可能希望确保提供负载的副本的数量永远不会低于总数的某个百分比。</p>

<p>集群管理器和托管提供商应使用遵循 <code class="highlighter-rouge">Pod Disruption Budgets</code> 的工具，方法是调用<a href="/docs/tasks/administer-cluster/safely-drain-node/#the-eviction-api">Eviction API</a>而不是直接删除 Pod。例如 <code class="highlighter-rouge">kubectl drain</code> 命令和 Kubernetes-on-GCE 集群升级脚本（<code class="highlighter-rouge">cluster/gce/upgrade.sh</code>）。</p>

<p>当集群管理员想要排空节点时，可以使用 <code class="highlighter-rouge">kubectl drain</code> 命令。该命令会试图驱逐机器上的所有 pod。驱逐请求可能会暂时被拒绝，并且该工具会定期重试所有失败的请求，直到所有的 pod 都被终止，或者直到达到配置的超时时间。</p>

<p>PDB 指定应用程序可以容忍的副本的数量，相对于应该有多少副本。例如，具有 <code class="highlighter-rouge">spec.replicas：5</code> 的 Deployment 在任何给定的时间都应该有 5 个 Pod。如果其 PDB 允许在某一时刻有 4 个副本，那么驱逐 API 将只允许仅有一个而不是两个 Pod 自愿中断。</p>

<p>使用标签选择器来指定应用程序的一组 pod，这与应用程序的控制器（Deployment、StatefulSet 等）使用的相同。</p>

<p>Pod 控制器的 <code class="highlighter-rouge">.spec.replicas</code> 计算“预期的” pod 数量。使用对象的 <code class="highlighter-rouge">.metadata.ownerReferences</code> 值从控制器获取。</p>

<p>PDB 不能阻止<a href="#voluntary-and-involuntary-disruptions">非自愿中断</a>的发生，但是它们确实会影响预算。</p>

<p>由于应用程序的滚动升级而被删除或不可用的 Pod 确实会计入中断预算，但控制器（如 Deployment 和 StatefulSet）在进行滚动升级时不受 PDB 的限制——在应用程序更新期间的故障处理是在控制器的规格（spec）中配置（了解<a href="/docs/concepts/cluster-administration/manage-deployment/#updating-your-application-without-a-service-outage">更新 Deployment</a>）。</p>

<p>使用驱逐 API 驱逐 pod 时，pod 会被优雅地终止（请参阅 <a href="/docs/resources-reference/v1.6/#podspec-v1-core">PodSpec</a> 中的 <code class="highlighter-rouge">terminationGracePeriodSeconds</code>）。</p>

<h2 id="pdb-示例">PDB 示例</h2>

<p>假设集群有3个节点，<code class="highlighter-rouge">node-1</code> 到 <code class="highlighter-rouge">node-3</code>。集群中运行了一些应用，其中一个应用有3个副本，分别是 <code class="highlighter-rouge">pod-a</code>、<code class="highlighter-rouge">pod-b</code> 和 <code class="highlighter-rouge">pod-c</code>。另外，还有一个与它相关的不具有 PDB 的 pod，我们称为之为 <code class="highlighter-rouge">pod-x</code>。最初，所有 Pod 的分布如下：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1</th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">pod-a  <em>available</em></td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
    </tr>
    <tr>
      <td style="text-align: center">pod-x  <em>available</em></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>所有的3个 pod 都是 Deployment 中的一部分，并且它们共同拥有一个 PDB，要求至少有3个 pod 中的2个始终处于可用状态。</p>

<p>例如，假设集群管理员想要重启系统，升级内核版本来修复内核中的错误。集群管理员首先使用 <code class="highlighter-rouge">kubectl drain</code> 命令尝试排除 <code class="highlighter-rouge">node-1</code>。该工具试图驱逐 <code class="highlighter-rouge">pod-a</code> 和 <code class="highlighter-rouge">pod-x</code>。这立即成功。两个 Pod 同时进入终止状态。这时的集群处于这种状态：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1 <em>draining</em></th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">pod-a  <em>terminating</em></td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
    </tr>
    <tr>
      <td style="text-align: center">pod-x  <em>terminating</em></td>
      <td style="text-align: center"> </td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>Deployment 注意到其中有一个 pod 处于正在终止，因此会创建了一个 <code class="highlighter-rouge">pod-d</code> 来替换。由于 <code class="highlighter-rouge">node-1</code> 被封锁（cordon），它落在另一个节点上。同时其它控制器也创建了 <code class="highlighter-rouge">pod-y</code> 作为 <code class="highlighter-rouge">pod-x</code> 的替代品。</p>

<p>（注意：对于 <code class="highlighter-rouge">StatefulSet</code>，<code class="highlighter-rouge">pod-a</code> 将被称为 <code class="highlighter-rouge">pod-1</code>，需要在替换之前完全终止，替代它的也称为 <code class="highlighter-rouge">pod-1</code>，但是具有不同的 UID，可以创建。否则，示例也适用于 StatefulSet。）</p>

<p>当前集群的状态如下：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1 <em>draining</em></th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">pod-a  <em>terminating</em></td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
    </tr>
    <tr>
      <td style="text-align: center">pod-x  <em>terminating</em></td>
      <td style="text-align: center">pod-d <em>starting</em></td>
      <td style="text-align: center">pod-y</td>
    </tr>
  </tbody>
</table>

<p>在某一时刻，pod 被终止，集群看起来像下面这样子：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1 <em>drained</em></th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-d <em>starting</em></td>
      <td style="text-align: center">pod-y</td>
    </tr>
  </tbody>
</table>

<p>此时，如果一个急躁的集群管理员试图排空（drain）<code class="highlighter-rouge">node-2</code> 或 <code class="highlighter-rouge">node-3</code>，drain 命令将被阻塞，因为对于 Deployment 只有2个可用的 pod，并且其 PDB 至少需要2个。经过一段时间，<code class="highlighter-rouge">pod-d</code> 变得可用。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1 <em>drained</em></th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-d <em>available</em></td>
      <td style="text-align: center">pod-y</td>
    </tr>
  </tbody>
</table>

<p>现在，集群管理员尝试排空 <code class="highlighter-rouge">node-2</code>。drain 命令将尝试按照某种顺序驱逐两个 pod，假设先是 <code class="highlighter-rouge">pod-b</code>，然后再 <code class="highlighter-rouge">pod-d</code>。它将成功驱逐 <code class="highlighter-rouge">pod-b</code>。但是，当它试图驱逐 <code class="highlighter-rouge">pod-d</code> 时，将被拒绝，因为这样对 Deployment 来说将只剩下一个可用的 pod。</p>

<p>Deployment 将创建一个名为 <code class="highlighter-rouge">pod-e</code> 的 <code class="highlighter-rouge">pod-b</code> 的替代品。但是，集群中没有足够的资源来安排 <code class="highlighter-rouge">pod-e</code>。那么，drain 命令就会被阻塞。集群最终可能是这种状态：</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">node-1 <em>drained</em></th>
      <th style="text-align: center">node-2</th>
      <th style="text-align: center">node-3</th>
      <th style="text-align: center"><em>no node</em></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-b <em>available</em></td>
      <td style="text-align: center">pod-c <em>available</em></td>
      <td style="text-align: center">pod-e <em>pending</em></td>
    </tr>
    <tr>
      <td style="text-align: center"> </td>
      <td style="text-align: center">pod-d <em>available</em></td>
      <td style="text-align: center">pod-y</td>
      <td style="text-align: center"> </td>
    </tr>
  </tbody>
</table>

<p>此时，集群管理员需要向集群中添加回一个节点以继续升级操作。</p>

<p>您可以看到 Kubernetes 如何改变中断发生的速率，根据：</p>

<ul>
  <li>应用程序需要多少副本</li>
  <li>正常关闭实例需要多长时间</li>
  <li>启动新实例需要多长时间</li>
  <li>控制器的类型</li>
  <li>集群的资源能力</li>
</ul>

<h2 id="分离集群所有者和应用程序所有者角色">分离集群所有者和应用程序所有者角色</h2>

<p>将集群管理者和应用程序所有者视为彼此知识有限的独立角色通常是很有用的。这种责任分离在这些情况下可能是有意义的：</p>

<ul>
  <li>当有许多应用程序团队共享一个 Kubernetes 集群，并且有自然的专业角色</li>
  <li>使用第三方工具或服务来自动化集群管理</li>
</ul>

<p>Pod Disruption Budget（Pod 中断预算） 通过在角色之间提供接口来支持这种角色分离。</p>

<p>如果您的组织中没有这样的职责分离，则可能不需要使用 Pod 中断预算。</p>

<h2 id="如何在集群上执行中断操作">如何在集群上执行中断操作</h2>

<p>如果您是集群管理员，要对集群的所有节点执行中断操作，例如节点或系统软件升级，则可以使用以下选择：</p>

<ul>
  <li>在升级期间接受停机时间。</li>
  <li>故障转移到另一个完整的副本集群。
    <ul>
      <li>没有停机时间，但是对于重复的节点和人工协调成本可能是昂贵的。</li>
    </ul>
  </li>
  <li>编写可容忍中断的应用程序和使用 PDB。
    <ul>
      <li>没有停机时间。</li>
      <li>最小的资源重复。</li>
      <li>允许更多的集群管理自动化。</li>
      <li>编写可容忍中断的应用程序是很棘手的，但对于可容忍自愿中断，和支持自动调整以容忍非自愿中断，两者在工作上有大量的重叠。</li>
    </ul>
  </li>
</ul>

<h2 id="whats-next">What’s next</h2>

<ul>
  <li>通过配置<a href="/docs/tasks/run-application//configure-pdb.md">Pod Disruption Budget（Pod 中断预算）</a>来执行保护应用程序的步骤。</li>
  <li>了解更多关于<a href="/docs/tasks/administer-cluster//safely-drain-node.md">排空节点</a>的信息。</li>
</ul>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/concepts/workloads/pods/disruptions.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/concepts/workloads/pods/disruptions/",
                "title" : "Disruption(中断)",
                "permalink" : "https://kubernetes.io/docs/concepts/workloads/pods/disruptions/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/concepts/workloads/pods/disruptions.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
