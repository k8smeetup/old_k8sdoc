
  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Reference">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="kubeadm join" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>kubeadm join | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="kubeadm join" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/reference/setup-tools/kubeadm/kubeadm-join/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/reference/setup-tools/kubeadm/kubeadm-join/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/reference/setup-tools/kubeadm/kubeadm-join/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"kubeadm join","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Reference</h1>
  <h5>Design docs, concept definitions, and references for APIs and CLIs.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="参考文档" href="/docs/reference/"></a>
    
  

  

    

    
      <a class="item" data-title="Standardized Glossary" href="/docs/reference/glossary/"></a>
    
  

  
    <div class="item" data-title="Using the API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes API 概述" href="/docs/reference/api-overview/"></a>
    
  

  

    

    
      <a class="item" data-title="客户端库" href="/docs/reference/client-libraries/"></a>
    
  

  
    <div class="item" data-title="Accessing the API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes API的访问控制" href="/docs/admin/accessing-the-api/"></a>
    
  

  

    

    
      <a class="item" data-title="身份认证" href="/docs/admin/authentication/"></a>
    
  

  

    

    
      <a class="item" data-title="使用启动引导令牌（Bootstrap Tokens）认证" href="/docs/admin/bootstrap-tokens/"></a>
    
  

  

    

    
      <a class="item" data-title="使用准入控制插件" href="/docs/admin/admission-controllers/"></a>
    
  

  

    

    
      <a class="item" data-title="Dynamic Admission Control" href="/docs/admin/extensible-admission-controllers/"></a>
    
  

  

    

    
      <a class="item" data-title="管理服务帐号（Service Accounts）" href="/docs/admin/service-accounts-admin/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Authorization">
      <div class="container">
        
  

    

    
      <a class="item" data-title="概述" href="/docs/admin/authorization/"></a>
    
  

  

    

    
      <a class="item" data-title="ABAC 模式" href="/docs/admin/authorization/abac/"></a>
    
  

  

    

    
      <a class="item" data-title="Using RBAC Authorization" href="/docs/admin/authorization/rbac/"></a>
    
  

  

    

    
      <a class="item" data-title="Using Node Authorization" href="/docs/admin/authorization/node/"></a>
    
  

  

    

    
      <a class="item" data-title="Webhook Mode" href="/docs/admin/authorization/webhook/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Kubernetes API 概念" href="/docs/reference/api-concepts/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 弃用策略" href="/docs/reference/deprecation-policy/"></a>
    
  

  

    

    
  


      </div>
    </div>
  

  
    <div class="item" data-title="API Reference">
      <div class="container">
        
  

    

    
      <a class="item" data-title="v1.9" href="/docs/reference/generated/kubernetes-api/v1.9/"></a>
    
  

  

    

    
      <a class="item" data-title="知名标签（Label）、注解（Annotation）和 Taints" href="/docs/reference/labels-annotations-taints/"></a>
    
  

  
    <div class="item" data-title="OpenAPI and Swagger">
      <div class="container">
        
  

    

    
      <a class="item" data-title="OpenAPI Spec" href="https://git.k8s.io/kubernetes/api/openapi-spec/"></a>
    
  

  

    

    
      <a class="item" data-title="Swagger Spec" href="https://git.k8s.io/kubernetes/api/swagger-spec/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Federation API">
      <div class="container">
        
  

    

    
      <a class="item" data-title="v1 Operations" href="/docs/reference/generated/federation/v1/operations/"></a>
    
  

  

    

    
      <a class="item" data-title="v1 Model Definitions" href="/docs/reference/generated/federation/v1/definitions/"></a>
    
  

  

    

    
      <a class="item" data-title="extensions/v1beta1 Operations" href="/docs/reference/generated/federation/extensions/v1beta1/operations/"></a>
    
  

  

    

    
      <a class="item" data-title="extensions/v1beta1 Model Definitions" href="/docs/reference/generated/federation/extensions/v1beta1/definitions/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="kubectl CLI">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Overview of kubectl" href="/docs/reference/kubectl/overview/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl" href="/docs/reference/generated/kubectl/kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl Commands" href="/docs/reference/generated/kubectl/kubectl-commands.html"></a>
    
  

  

    

    
      <a class="item" data-title="针对 Docker 用户的 kubectl（相关功能）" href="/docs/reference/kubectl/docker-cli-to-kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/reference/kubectl/conventions/"></a>
    
  

  

    

    
      <a class="item" data-title="JSONPath 支持" href="/docs/reference/kubectl/jsonpath/"></a>
    
  

  

    

    
      <a class="item" data-title="kubectl 备忘单" href="/docs/reference/kubectl/cheatsheet/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Setup Tools Reference">
      <div class="container">
        
  
    <div class="item" data-title="Kubeadm">
      <div class="container">
        
  

    

    
      <a class="item" data-title="kubeadm 概述" href="/docs/reference/setup-tools/kubeadm/kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm init" href="/docs/reference/setup-tools/kubeadm/kubeadm-init/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm join" href="/docs/reference/setup-tools/kubeadm/kubeadm-join/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm update" href="/docs/reference/setup-tools/kubeadm/kubeadm-upgrade/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm 配置" href="/docs/reference/setup-tools/kubeadm/kubeadm-config/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm 重置" href="/docs/reference/setup-tools/kubeadm/kubeadm-reset/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm token" href="/docs/reference/setup-tools/kubeadm/kubeadm-token/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm version" href="/docs/reference/setup-tools/kubeadm/kubeadm-version/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm alpha" href="/docs/reference/setup-tools/kubeadm/kubeadm-alpha/"></a>
    
  

  

    

    
      <a class="item" data-title="实现细节" href="/docs/reference/setup-tools/kubeadm/implementation-details/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubefed">
      <div class="container">
        
  

    

    
      <a class="item" data-title="kubefed" href="/docs/reference/generated/kubefed/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed options" href="/docs/reference/generated/kubefed_options/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed init" href="/docs/reference/generated/kubefed_init/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed join" href="/docs/reference/generated/kubefed_join/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed unjoin" href="/docs/reference/generated/kubefed_unjoin/"></a>
    
  

  

    

    
      <a class="item" data-title="kubefed version" href="/docs/reference/generated/kubefed_version/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  
    <div class="item" data-title="Command-line Tools Reference">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Feature Gates" href="/docs/reference/feature-gates/"></a>
    
  

  

    

    
      <a class="item" data-title="kubelet" href="/docs/reference/generated/kubelet/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubelet 认证/授权" href="/docs/admin/kubelet-authentication-authorization/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-apiserver" href="/docs/reference/generated/kube-apiserver/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-controller-manager" href="/docs/reference/generated/kube-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-proxy" href="/docs/reference/generated/kube-proxy/"></a>
    
  

  

    

    
      <a class="item" data-title="kube-scheduler" href="/docs/reference/generated/kube-scheduler/"></a>
    
  

  

    

    
      <a class="item" data-title="TLS 引导程序" href="/docs/admin/kubelet-tls-bootstrapping/"></a>
    
  

  

    

    
      <a class="item" data-title="cloud-controller-manager" href="/docs/reference/generated/cloud-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="federation-apiserver" href="/docs/reference/generated/federation-apiserver/"></a>
    
  

  

    

    
      <a class="item" data-title="federation-controller-manager" href="/docs/reference/generated/federation-controller-manager/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Kubernetes Issues and Security">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes Issue Tracker on GitHub" href="https://github.com/kubernetes/kubernetes/issues/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes安全和公告信息" href="/security/"></a>
    
  


      </div>
    </div>
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/reference/setup-tools/kubeadm/kubeadm-join.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>kubeadm join</h1>
        

        
<ul id="markdown-toc">
  <li><a href="#synopsis" id="markdown-toc-synopsis">Synopsis</a></li>
  <li><a href="#options" id="markdown-toc-options">Options</a></li>
  <li><a href="#join-命令的工作流程" id="markdown-toc-join-命令的工作流程">join 命令的工作流程</a></li>
  <li><a href="#发现可信的集群-ca" id="markdown-toc-发现可信的集群-ca">发现可信的集群 CA</a>    <ul>
      <li><a href="#包含-ca-的基于-token-的发现" id="markdown-toc-包含-ca-的基于-token-的发现">包含 CA 的基于 Token 的发现</a></li>
      <li><a href="#不包含-ca-的基于-token-的发现" id="markdown-toc-不包含-ca-的基于-token-的发现">不包含 CA 的基于 Token 的发现</a></li>
      <li><a href="#基于文件或-https-的发现" id="markdown-toc-基于文件或-https-的发现">基于文件或 HTTPS 的发现</a></li>
    </ul>
  </li>
  <li><a href="#securing-more" id="markdown-toc-securing-more">确保您的安装更加安全</a>    <ul>
      <li><a href="#关闭-node-客户端证书的自动批准" id="markdown-toc-关闭-node-客户端证书的自动批准">关闭 node 客户端证书的自动批准</a></li>
      <li><a href="#关闭-cluster-info-configmap-的公共访问权限" id="markdown-toc-关闭-cluster-info-configmap-的公共访问权限">关闭 cluster-info ConfigMap 的公共访问权限</a></li>
    </ul>
  </li>
  <li><a href="#config-file" id="markdown-toc-config-file">通过配置文件来使用 kubeadm join</a></li>
  <li><a href="#whats-next" id="markdown-toc-whats-next">What’s next</a></li>
</ul>

<p>Run this on any machine you wish to join an existing cluster</p>

<h3 id="synopsis">Synopsis</h3>

<p>When joining a kubeadm initialized cluster, we need to establish
bidirectional trust. This is split into discovery (having the Node
trust the Kubernetes Master) and TLS bootstrap (having the Kubernetes
Master trust the Node).</p>

<p>There are 2 main schemes for discovery. The first is to use a shared
token along with the IP address of the API server. The second is to
provide a file - a subset of the standard kubeconfig file. This file
can be a local file or downloaded via an HTTPS URL. The forms are
kubeadm join –discovery-token abcdef.1234567890abcdef 1.2.3.4:6443,
kubeadm join –discovery-file path/to/file.conf, or kubeadm join
–discovery-file https://url/file.conf. Only one form can be used. If
the discovery information is loaded from a URL, HTTPS must be used.
Also, in that case the host installed CA bundle is used to verify
the connection.</p>

<p>If you use a shared token for discovery, you should also pass the
–discovery-token-ca-cert-hash flag to validate the public key of the
root certificate authority (CA) presented by the Kubernetes Master. The
value of this flag is specified as “  <hash-type>:<hex-encoded-value>", where the supported hash type is "sha256". The hash is calculated over the bytes of the Subject Public Key Info (SPKI) object (as in RFC7469). This value is available in the output of "kubeadm init" or can be calcuated using standard tools. The --discovery-token-ca-cert-hash flag may be repeated multiple times to allow more than one public key.</hex-encoded-value></hash-type>
</p>

<p>If you cannot know the CA public key hash ahead of time, you can pass
the –discovery-token-unsafe-skip-ca-verification flag to disable this
verification. This weakens the kubeadm security model since other nodes
can potentially impersonate the Kubernetes Master.</p>

<p>The TLS bootstrap mechanism is also driven via a shared token. This is
used to temporarily authenticate with the Kubernetes Master to submit a
certificate signing request (CSR) for a locally created key pair. By
default, kubeadm will set up the Kubernetes Master to automatically
approve these signing requests. This token is passed in with the
–tls-bootstrap-token abcdef.1234567890abcdef flag.</p>

<p>Often times the same token is used for both parts. In this case, the
–token flag can be used instead of specifying each token individually.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm join [flags]
</code></pre></div></div>

<h3 id="options">Options</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      --config string                                 Path to kubeadm config file.
      --cri-socket string                             Specify the CRI socket to connect to. (default "/var/run/dockershim.sock")
      --discovery-file string                         A file or url from which to load cluster information.
      --discovery-token string                        A token used to validate cluster information fetched from the master.
      --discovery-token-ca-cert-hash stringSlice      For token-based discovery, validate that the root CA public key matches this hash (format: "&lt;type&gt;:&lt;value&gt;").
      --discovery-token-unsafe-skip-ca-verification   For token-based discovery, allow joining without --discovery-token-ca-cert-hash pinning.
      --feature-gates string                          A set of key=value pairs that describe feature gates for various features. Options are:
CoreDNS=true|false (ALPHA - default=false)
DynamicKubeletConfig=true|false (ALPHA - default=false)
HighAvailability=true|false (ALPHA - default=false)
SelfHosting=true|false (BETA - default=false)
StoreCertsInSecrets=true|false (ALPHA - default=false)
SupportIPVSProxyMode=true|false (ALPHA - default=false)
      --ignore-checks-errors stringSlice              A list of checks whose errors will be shown as warnings. Example: 'IsPrivilegedUser,Swap'. Value 'all' ignores errors from all checks.
      --node-name string                              Specify the node name.
      --tls-bootstrap-token string                    A token used for TLS bootstrapping.
      --token string                                  Use this token for both discovery-token and tls-bootstrap-token.
</code></pre></div></div>

<h3 id="join-命令的工作流程">join 命令的工作流程</h3>

<p><code class="highlighter-rouge">kubeadm join</code> 命令会初始化一个 Kubernetes 工作 node，并将其加入到集群中。
此动作包括以下步骤：</p>

<ol>
  <li>
    <p>kubeadm 从 API server 下载必要的集群信息。 默认情况下，它使用 bootstrap token
和 CA 秘钥哈希来验证这些数据的真实性。 根 CA 证书也可以直接通过文件或 URL 被发现。</p>
  </li>
  <li>
    <p>如果 kubeadm 在启用 <code class="highlighter-rouge">--feature-gates=DynamicKubeletConfig</code> 的情况下被调用，
它首先会从 master 取回 kubelet 初始配置，并将其写入磁盘。 当 kubelet 启动时，
kubeadm 会更新 node 的 <code class="highlighter-rouge">Node.spec.configSource</code> 属性。
查看 <a href="/docs/tasks/administer-cluster/kubelet-config-file.md">通过配置文件设置 Kubelet 参数</a>
和 <a href="/docs/tasks/administer-cluster/reconfigure-kubelet.md">在动态集群中重新配置 Node 的 Kubelet</a>
来了解更多关于动态 Kubelet 配置的信息。</p>
  </li>
  <li>
    <p>一旦集群信息是已知的，kubelet 就可以启动 TLS 的初始化进程。</p>

    <p>TLS 初始化使用共享 token 临时地与 Kubernetes API server 进行认证，来提交证书签名请求（CSR）。
默认情况下，控制平面会自动签署该 CSR 请求。</p>
  </li>
  <li>
    <p>最后，kubeadm 配置本地 kubelet，令其使用明确分配给该 node 的认证凭据与 API server 通信。</p>
  </li>
</ol>

<h3 id="发现可信的集群-ca">发现可信的集群 CA</h3>

<p>kubeadm discovery 命令有数个选项，每个选项有其安全方面的权衡。
针对您的环境的正确方法取决于您的 node 的供应方式，以及您对网络和 node 生命周期安全性的期望。</p>

<h4 id="包含-ca-的基于-token-的发现">包含 CA 的基于 Token 的发现</h4>

<p>这是 Kubernetes 1.8 及更高版本中的默认模式。 在该模式中，kubeadm 下载集群配置（包括根 CA 证书），
并使用 token 来验证集群配置，同时也验证根 CA 公钥与提供的哈希是否匹配，以及 API server
在根 CA 下是否合法。</p>

<p>CA 秘钥哈希格式为 <code class="highlighter-rouge">sha256:&lt;hex_encoded_hash&gt;</code>。 默认情况下，哈希值由 <code class="highlighter-rouge">kubeadm init</code>
结尾输出的 <code class="highlighter-rouge">kubeadm join</code> 命令所返回，或者位于 <code class="highlighter-rouge">kubeadm token create --print-join-command</code>
的输出中。 它是一种标准格式（参考 <a href="https://tools.ietf.org/html/rfc7469#section-2.4">RFC7469</a>），
且能够通过第三方工具或配置系统进行计算。 例如，使用 OpenSSL CLI：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl x509 <span class="nt">-pubkey</span> <span class="nt">-in</span> /etc/kubernetes/pki/ca.crt | openssl rsa <span class="nt">-pubin</span> <span class="nt">-outform</span> der 2&gt;/dev/null | openssl dgst <span class="nt">-sha256</span> <span class="nt">-hex</span> | sed <span class="s1">'s/^.* //'</span>
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">kubeadm join</code> 命令示例：</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm join <span class="nt">--discovery-token</span> abcdef.1234567890abcdef <span class="nt">--discovery-token-ca-cert-hash</span> sha256:1234..cdef 1.2.3.4:6443
</code></pre></div></div>

<p><strong>优势：</strong></p>

<ul>
  <li>
    <p>即使在其他 node 或网络受到破坏时，也能够引导 node 安全地发现用于 master 的信任根（root of trust）。</p>
  </li>
  <li>
    <p>由于将全部所需信息纳入到唯一的、 方便复制和粘贴的 <code class="highlighter-rouge">kubeadm join</code> 命令中，
所以便于手动执行。</p>
  </li>
</ul>

<p><strong>缺点：</strong></p>

<ul>
  <li>CA 哈希在 master 供应之前无法感知，这让使用 kubeadm 构建自动化供应工具变得更加困难。
尽管您可以通过事先生成 CA 来解决这一限制。</li>
</ul>

<h4 id="不包含-ca-的基于-token-的发现">不包含 CA 的基于 Token 的发现</h4>

<p><em>这是 Kubernetes 1.7 或更早版本中的默认模式</em>，但是伴随着一些重要的注意事项。
该模式仅依赖对称 token 来签署（HMAC-SHA256）发现信息，这些信息用于建立 master 的信任根。
可以在 Kubernetes 1.8 或更高的版本中使用 <code class="highlighter-rouge">--discovery-token-unsafe-skip-ca-verification</code>
参数（来启用该模式），但如果可能的话，您应该考虑使用其他模式。</p>

<p><strong><code class="highlighter-rouge">kubeadm join</code> 命令示例：</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubeadm join --token abcdef.1234567890abcdef --discovery-token-unsafe-skip-ca-verification 1.2.3.4:6443`
</code></pre></div></div>

<p><strong>优势：</strong></p>

<ul>
  <li>
    <p>仍然能够保护免受许多网络级别的攻击。</p>
  </li>
  <li>
    <p>token 可以提前生成，并在 master 和工作 node 间共享，然后可以无耦合地并行初始化。
这使得该模式能够在许多供应场景中使用。</p>
  </li>
</ul>

<p><strong>缺点：</strong></p>

<ul>
  <li>如果攻击者能够通过某些漏洞窃取 bootstrap token，他们就能够使用该 token
（随着网络级访问）来模拟 master 到其他初始化 node 的行为。 在您的环境中，
这种折衷（即牺牲这种安全性）可能合适，也可能不合适。</li>
</ul>

<h4 id="基于文件或-https-的发现">基于文件或 HTTPS 的发现</h4>
<p>该模式提供了一种 “域外（out-of-band）” 方式来建立 master 和 初始化 node 间的信任根。
如果您正使用 kubeadm 构建自动供应，请考虑使用此模式。</p>

<p><strong><code class="highlighter-rouge">kubeadm join</code> 命令示例：</strong></p>

<ul>
  <li>
    <p><code class="highlighter-rouge">kubeadm join --discovery-file path/to/file.conf</code> (本地文件)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">kubeadm join --discovery-file https://url/file.conf</code> (远程 HTTPS URL)</p>
  </li>
</ul>

<p><strong>优势：</strong></p>

<ul>
  <li>即使在其他 node 或网络受到破坏时，也能够引导 node 安全地发现用于 master 的信任根。</li>
</ul>

<p><strong>缺点：</strong></p>

<ul>
  <li>要求您有某种方式将发现信息从 master 传递到初始化 node。 例如，这可以通过您的云服务提供商或供应工具来实现。
 该文件中的信息不是机密性的，但是需要 HTTPS 或等效的机制来保证信息的完整性。</li>
</ul>

<h3 id="securing-more">确保您的安装更加安全</h3>

<p>kubeadm 的默认行为可能不适合每一个人。 本节记录了如何在牺牲某些可用性的情况下，使 kubeadm 安装更加安全。</p>

<h4 id="关闭-node-客户端证书的自动批准">关闭 node 客户端证书的自动批准</h4>

<p>默认情况下，（Kubernetes）会启用一个 CSR 自动审批器（auto-approver），当使用 Bootstrap Token 进行认证时，
该审批器基本上会批准任何针对 kubelet 的客户端证书请求。 如果您不希望集群自动批准 kubelet 客户端证书，
您可以通过执行以下命令来关闭它：</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl delete clusterrole kubeadm:node-autoapprove-bootstrap
</code></pre></div></div>

<p>在这之后，<code class="highlighter-rouge">kubeadm join</code> 会阻塞，直到管理员手动批准 CSR。</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl get csr
<span class="go">NAME                                                   AGE       REQUESTOR                 CONDITION
node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ   18s       system:bootstrap:878f07   Pending

</span><span class="gp">$</span> kubectl certificate approve node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ
<span class="go">certificatesigningrequest "node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ" approved

</span><span class="gp">$</span> kubectl get csr
<span class="go">NAME                                                   AGE       REQUESTOR                 CONDITION
node-csr-c69HXe7aYcqkS1bKmH4faEnHAWxn6i2bHZ2mD04jZyQ   1m        system:bootstrap:878f07   Approved,Issued
</span></code></pre></div></div>

<p>只有在 <code class="highlighter-rouge">kubectl certificate approve</code> 已经运行后，<code class="highlighter-rouge">kubeadm join</code> 才可以进行。</p>

<h4 id="关闭-cluster-info-configmap-的公共访问权限">关闭 cluster-info ConfigMap 的公共访问权限</h4>

<p>为了使用 token 作为唯一的验证信息来实现加入（集群）的流程，默认情况下，用户需要公开暴露一个 ConfigMap，
ConfigMap 中包含了一些 master 身份校验所需的数据。 尽管这个 ConfigMap 中没有个人数据，不管怎样，
一些用户仍然可能希望关闭它（公共访问权限）。 这样做会使用户无法使用 <code class="highlighter-rouge">kubeadm join</code> 流程中的
<code class="highlighter-rouge">--discovery-token</code> 参数。 下面是关闭公共访问权限的步骤：</p>

<ul>
  <li>从 API Server 获取 <code class="highlighter-rouge">cluster-info</code> 文件：</li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl <span class="nt">-n</span> kube-public get cm cluster-info <span class="nt">-o</span> yaml | <span class="nb">grep</span> <span class="s2">"kubeconfig:"</span> <span class="nt">-A11</span> | <span class="nb">grep</span> <span class="s2">"apiVersion"</span> <span class="nt">-A10</span> | sed <span class="s2">"s/    //"</span> | tee cluster-info.yaml
<span class="go">apiVersion: v1
clusters:
- cluster:
</span><span class="gp">    certificate-authority-data: &lt;ca-cert&gt;</span>
<span class="gp">    server: https://&lt;ip&gt;</span>:&lt;port&gt;
<span class="go">  name: ""
contexts: []
current-context: ""
kind: Config
preferences: {}
users: []
</span></code></pre></div></div>

<ul>
  <li>
    <p>使用 <code class="highlighter-rouge">cluster-info.yaml</code> 文件作为 <code class="highlighter-rouge">kubeadm join --discovery-file</code> 的一个参数。</p>
  </li>
  <li>
    <p>关闭 <code class="highlighter-rouge">cluster-info</code> ConfigMap 的公共访问权限：</p>
  </li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> kubectl <span class="nt">-n</span> kube-public delete rolebinding kubeadm:bootstrap-signer-clusterinfo
</code></pre></div></div>

<p>这些命令应该在 <code class="highlighter-rouge">kubeadm init</code> 之后、 <code class="highlighter-rouge">kubeadm join</code> 之前运行。</p>

<h3 id="config-file">通过配置文件来使用 kubeadm join</h3>

<p class="caution"><strong>注意：</strong> 配置文件（方式）仍被认为是 alpha 特性，在将来的版本中可能发生变化。</p>

<p>也可以使用配置文件代替命令行参数来配置 <code class="highlighter-rouge">kubeadm join</code>，并且某些更高级的特性只能够在配置文件的形式下使用。
该配置文件通过 <code class="highlighter-rouge">--config</code> 参数传入。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubeadm.k8s.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NodeConfiguration</span>
<span class="na">caCertPath</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
<span class="na">discoveryFile</span><span class="pi">:</span> <span class="s">&lt;path|string&gt;</span>
<span class="na">discoveryToken</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">discoveryTokenAPIServers</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">&lt;address|string&gt;</span>
<span class="pi">-</span> <span class="s">&lt;address|string&gt;</span>
<span class="na">nodeName</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">tlsBootstrapToken</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">token</span><span class="pi">:</span> <span class="s">&lt;string&gt;</span>
<span class="na">discoveryTokenCACertHashes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">&lt;SHA-256 hash|string&gt;</span>
<span class="pi">-</span> <span class="s">&lt;SHA-256 hash|string&gt;</span>
<span class="na">discoveryTokenUnsafeSkipCAVerification</span><span class="pi">:</span> <span class="s">&lt;bool&gt;</span>
</code></pre></div></div>

<h2 id="whats-next">What’s next</h2>

<ul>
  <li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-init/">kubeadm init</a> 来初始化一个 Kubernetes master 节点</li>
  <li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-token/">kubeadm token</a> 来管理用于 <code class="highlighter-rouge">kubeadm join</code> 的 token</li>
  <li><a href="/docs/reference/setup-tools/kubeadm/kubeadm-reset/">kubeadm reset</a> 来恢复任何通过 <code class="highlighter-rouge">kubeadm init</code> 或 <code class="highlighter-rouge">kubeadm join</code> 对主机所做的修改</li>
</ul>



        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/reference/setup-tools/kubeadm/kubeadm-join.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/reference/setup-tools/kubeadm/kubeadm-join/",
                "title" : "kubeadm join",
                "permalink" : "https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/reference/setup-tools/kubeadm/kubeadm-join.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
