
  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Setup">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="Offline" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Offline | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="Offline" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/getting-started-guides/coreos/bare_metal_offline/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/getting-started-guides/coreos/bare_metal_offline/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/getting-started-guides/coreos/bare_metal_offline/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"Offline","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Setup</h1>
  <h5>Instructions for setting up a Kubernetes cluster.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" class="YAH">SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" >TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="安装" href="/docs/setup/"></a>
    
  

  

    

    
      <a class="item" data-title="选择正确的解决方案" href="/docs/setup/pick-right-solution/"></a>
    
  

  
    <div class="item" data-title="Downloading Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="v1.9 Release Notes" href="/docs/imported/release/notes/"></a>
    
  

  

    

    
      <a class="item" data-title="从源代码构建" href="/docs/setup/building-from-source/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Independent Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="通过 Minikube 在本地运行 Kubernetes" href="/docs/getting-started-guides/minikube/"></a>
    
  

  
    <div class="item" data-title="Bootstrapping Clusters with kubeadm">
      <div class="container">
        
  

    

    
      <a class="item" data-title="" href="/docs/setup/independent/install-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="Using kubeadm to Create a Cluster" href="/docs/setup/independent/create-cluster-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm 故障排查" href="/docs/setup/independent/troubleshooting-kubeadm/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubeadm 创建高可用集群" href="/docs/setup/independent/high-availability/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="从零开始搭建自定义集群" href="/docs/getting-started-guides/scratch/"></a>
    
  

  

    

    
      <a class="item" data-title="废弃的选项" href="/docs/getting-started-guides/alternatives/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Hosted Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Running Kubernetes on Google Kubernetes Engine" href="https://cloud.google.com/kubernetes-engine/docs/before-you-begin/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on Azure Container Service" href="https://docs.microsoft.com/en-us/azure/container-service/container-service-kubernetes-walkthrough"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud Container Service" href="https://console.bluemix.net/docs/containers/container_index.html"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Turn-key Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="在阿里云上运行 Kubernetes" href="/docs/getting-started-guides/alibaba-cloud/"></a>
    
  

  

    

    
      <a class="item" data-title="在 AWS EC2 上运行 Kubernetes" href="/docs/getting-started-guides/aws/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Azure 上运行 Kubernetes" href="/docs/getting-started-guides/azure/"></a>
    
  

  

    

    
      <a class="item" data-title="在 CenturyLink Cloud 上运行 Kubernetes" href="/docs/getting-started-guides/clc/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Google 计算引擎上运行 Kubernetes" href="/docs/getting-started-guides/gce/"></a>
    
  

  

    

    
      <a class="item" data-title="Running Kubernetes on IBM Cloud" href="https://github.com/patrocinio/kubernetes-softlayer"></a>
    
  

  

    

    
      <a class="item" data-title="通过 Stackpoint.io 在多个云平台上运行 Kubernetes" href="/docs/getting-started-guides/stackpoint/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Custom Solutions">
      <div class="container">
        
  
    <div class="item" data-title="Custom Cloud Solutions">
      <div class="container">
        
  

    

    
      <a class="item" data-title="AWS 或 GCE 上的 CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/getting-started-guides/kops/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubespray 在基础设施或云平台上安装 Kubernetes" href="/docs/getting-started-guides/kubespray/"></a>
    
  

  

    

    
  


      </div>
    </div>
  

  
    <div class="item" data-title="On-Premises VMs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="AWS 或 GCE 上的 CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    
  

  

    

    
      <a class="item" data-title="VMware vSphere" href="https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/"></a>
    
  

  

    

    
      <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    
  

  

    

    
      <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    
  

  
    <div class="item" data-title="Bare Metal">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora (单节点)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    
  

  

    

    
      <a class="item" data-title="Fedora（多节点）" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="AWS 或 GCE 上的 CoreOS" href="/docs/getting-started-guides/coreos/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  
    <div class="item" data-title="Ubuntu">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Kubernetes on Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    
  

  

    

    
      <a class="item" data-title="Validation - End-to-end Testing" href="/docs/getting-started-guides/ubuntu/validation/"></a>
    
  

  

    

    
      <a class="item" data-title="备份" href="/docs/getting-started-guides/ubuntu/backups/"></a>
    
  

  

    

    
      <a class="item" data-title="Upgrades" href="/docs/getting-started-guides/ubuntu/upgrades/"></a>
    
  

  

    

    
      <a class="item" data-title="伸缩" href="/docs/getting-started-guides/ubuntu/scaling/"></a>
    
  

  

    

    
      <a class="item" data-title="Setting up Kubernetes with Juju" href="/docs/getting-started-guides/ubuntu/installation/"></a>
    
  

  

    

    
      <a class="item" data-title="监控" href="/docs/getting-started-guides/ubuntu/monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="Networking" href="/docs/getting-started-guides/ubuntu/networking/"></a>
    
  

  

    

    
      <a class="item" data-title="安全考虑" href="/docs/getting-started-guides/ubuntu/security/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/getting-started-guides/ubuntu/storage/"></a>
    
  

  

    

    
      <a class="item" data-title="故障排除" href="/docs/getting-started-guides/ubuntu/troubleshooting/"></a>
    
  

  

    

    
      <a class="item" data-title="Decommissioning" href="/docs/getting-started-guides/ubuntu/decommissioning/"></a>
    
  

  

    

    
      <a class="item" data-title="操作注意事项" href="/docs/getting-started-guides/ubuntu/operational-considerations/"></a>
    
  

  

    

    
      <a class="item" data-title="词汇和术语" href="/docs/getting-started-guides/ubuntu/glossary/"></a>
    
  

  

    

    
      <a class="item" data-title="通过 LXD 实现 Kubernetes 本地开发" href="/docs/getting-started-guides/ubuntu/local/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/getting-started-guides/ubuntu/logging/"></a>
    
  

  

    

    
      <a class="item" data-title="Rancher 与 Ubuntu Kubernetes 集成" href="/docs/getting-started-guides/ubuntu/rancher/"></a>
    
  


      </div>
    </div>
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Windows Server 容器" href="/docs/getting-started-guides/windows/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="节点设置校验" href="/docs/admin/node-conformance/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="User Journeys">
      <div class="container">
        
  
    <div class="item" data-title="Application Developer">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Foundational" href="/docs/user-journeys/users/application-developer/foundational/"></a>
    
  

  

    

    
      <a class="item" data-title="媒介" href="/docs/user-journeys/users/application-developer/intermediate/"></a>
    
  

  

    

    
      <a class="item" data-title="高级主题" href="/docs/user-journeys/users/application-developer/advanced/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Cluster Operator">
      <div class="container">
        
  

    

    
      <a class="item" data-title="基础" href="/docs/user-journeys/users/cluster-operator/foundational/"></a>
    
  

  

    

    
      <a class="item" data-title="媒介" href="/docs/user-journeys/users/cluster-operator/intermediate/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Docs Contributor" href="/docs/home/?path=contributors&persona=docs-contributor&level=foundational"></a>
    
  

  

    

    
      <a class="item" data-title="Code Contributor" href="/docs/home/?path=contributors&persona=code-contributor&level=foundational"></a>
    
  

  

    

    
      <a class="item" data-title="Community Contributor" href="/docs/home/?path=contributors&persona=community-contributor&level=foundational"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Installing Addons" href="/docs/concepts/cluster-administration/addons/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    
  

  

    

    
      <a class="item" data-title="Building Large Clusters" href="/docs/admin/cluster-large/"></a>
    
  

  

    

    
      <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    
  

  

    

    
      <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/building/"></a>
    
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/getting-started-guides/coreos/bare_metal_offline.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>Offline</h1>
        

        <p>Deploy a CoreOS running Kubernetes environment. This particular guide is made to help those in an OFFLINE system, whether for testing a POC before the real deal, or you are restricted to be totally offline for your applications.</p>

<ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#high-level-design" id="markdown-toc-high-level-design">High Level Design</a></li>
  <li><a href="#this-guides-variables" id="markdown-toc-this-guides-variables">This Guides variables</a></li>
  <li><a href="#setup-pxelinux-centos" id="markdown-toc-setup-pxelinux-centos">Setup PXELINUX CentOS</a></li>
  <li><a href="#adding-coreos-to-pxe" id="markdown-toc-adding-coreos-to-pxe">Adding CoreOS to PXE</a></li>
  <li><a href="#dhcp-configuration" id="markdown-toc-dhcp-configuration">DHCP configuration</a></li>
  <li><a href="#kubernetes" id="markdown-toc-kubernetes">Kubernetes</a></li>
  <li><a href="#cloud-configs" id="markdown-toc-cloud-configs">Cloud Configs</a>    <ul>
      <li><a href="#masteryml" id="markdown-toc-masteryml">master.yml</a></li>
      <li><a href="#nodeyml" id="markdown-toc-nodeyml">node.yml</a></li>
    </ul>
  </li>
  <li><a href="#new-pxelinuxcfg-file" id="markdown-toc-new-pxelinuxcfg-file">New pxelinux.cfg file</a></li>
  <li><a href="#specify-the-pxelinux-targets" id="markdown-toc-specify-the-pxelinux-targets">Specify the pxelinux targets</a></li>
  <li><a href="#creating-test-pod" id="markdown-toc-creating-test-pod">Creating test pod</a></li>
  <li><a href="#helping-commands-for-debugging" id="markdown-toc-helping-commands-for-debugging">Helping commands for debugging</a></li>
  <li><a href="#support-level" id="markdown-toc-support-level">Support Level</a></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>Installed <em>CentOS 6</em> for PXE server</li>
  <li>At least two bare metal nodes to work with</li>
</ol>

<h2 id="high-level-design">High Level Design</h2>

<ol>
  <li>Manage the tftp directory
    <ul>
      <li>/tftpboot/(coreos)(centos)(RHEL)</li>
      <li>/tftpboot/pxelinux.0/(MAC) -&gt; linked to Linux image config file</li>
    </ul>
  </li>
  <li>Update per install the link for pxelinux</li>
  <li>Update the DHCP config to reflect the host needing deployment</li>
  <li>Setup nodes to deploy CoreOS creating an etcd cluster.</li>
  <li>Have no access to the public <a href="https://discovery.etcd.io/">etcd discovery tool</a>.</li>
  <li>Installing the CoreOS slaves to become Kubernetes nodes.</li>
</ol>

<h2 id="this-guides-variables">This Guides variables</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Node Description</th>
      <th style="text-align: center">MAC</th>
      <th style="text-align: center">IP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">CoreOS/etcd/Kubernetes Master</td>
      <td style="text-align: center">d0:00:67:13:0d:00</td>
      <td style="text-align: center">10.20.30.40</td>
    </tr>
    <tr>
      <td style="text-align: left">CoreOS Slave 1</td>
      <td style="text-align: center">d0:00:67:13:0d:01</td>
      <td style="text-align: center">10.20.30.41</td>
    </tr>
    <tr>
      <td style="text-align: left">CoreOS Slave 2</td>
      <td style="text-align: center">d0:00:67:13:0d:02</td>
      <td style="text-align: center">10.20.30.42</td>
    </tr>
  </tbody>
</table>

<h2 id="setup-pxelinux-centos">Setup PXELINUX CentOS</h2>

<p>To setup CentOS PXELINUX environment there is a complete <a href="http://docs.fedoraproject.org/en-US/Fedora/7/html/Installation_Guide/ap-pxe-server.html">guide here</a>. This section is the abbreviated version.</p>

<ol>
  <li>
    <p>Install packages needed on CentOS</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo yum install tftp-server dhcp syslinux
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="highlighter-rouge">vi /etc/xinetd.d/tftp</code> to enable tftp service and change disable to ‘no’</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> -disable = no
</code></pre></div>    </div>
  </li>
  <li>
    <p>Copy over the syslinux images we will need.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> su -
 mkdir -p /tftpboot
 cd /tftpboot
 cp /usr/share/syslinux/pxelinux.0 /tftpboot
 cp /usr/share/syslinux/menu.c32 /tftpboot
 cp /usr/share/syslinux/memdisk /tftpboot
 cp /usr/share/syslinux/mboot.c32 /tftpboot
 cp /usr/share/syslinux/chain.c32 /tftpboot

 /sbin/service dhcpd start
 /sbin/service xinetd start
 /sbin/chkconfig tftp on
</code></pre></div>    </div>
  </li>
  <li>
    <p>Setup default boot menu</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mkdir /tftpboot/pxelinux.cfg
 touch /tftpboot/pxelinux.cfg/default
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit the menu <code class="highlighter-rouge">vi /tftpboot/pxelinux.cfg/default</code></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> default menu.c32
 prompt 0
 timeout 15
 ONTIMEOUT local
 display boot.msg

 MENU TITLE Main Menu

 LABEL local
         MENU LABEL Boot local hard drive
         LOCALBOOT 0
</code></pre></div>    </div>
  </li>
</ol>

<p>Now you should have a working PXELINUX setup to image CoreOS nodes. You can verify the services by using VirtualBox locally or with bare metal servers.</p>

<h2 id="adding-coreos-to-pxe">Adding CoreOS to PXE</h2>

<p>This section describes how to setup the CoreOS images to live alongside a pre-existing PXELINUX environment.</p>
<ol>
  <li>Find or create the TFTP root directory that everything will be based on.
    <ul>
      <li>For this document we will assume <code class="highlighter-rouge">/tftpboot/</code> is our root directory.</li>
    </ul>
  </li>
  <li>Once we know and have our tftp root directory we will create a new directory structure for our CoreOS images.</li>
  <li>
    <p>Download the CoreOS PXE files provided by the CoreOS team.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> MY_TFTPROOT_DIR=/tftpboot
 mkdir -p $MY_TFTPROOT_DIR/images/coreos/
 cd $MY_TFTPROOT_DIR/images/coreos/
 wget http://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe.vmlinuz
 wget http://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe.vmlinuz.sig
 wget http://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe_image.cpio.gz
 wget http://stable.release.core-os.net/amd64-usr/current/coreos_production_pxe_image.cpio.gz.sig
 gpg --verify coreos_production_pxe.vmlinuz.sig
 gpg --verify coreos_production_pxe_image.cpio.gz.sig
</code></pre></div>    </div>
  </li>
  <li>
    <p>Edit the menu <code class="highlighter-rouge">vi /tftpboot/pxelinux.cfg/default</code> again</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> default menu.c32
 prompt 0
 timeout 300
 ONTIMEOUT local
 display boot.msg

 MENU TITLE Main Menu

 LABEL local
         MENU LABEL Boot local hard drive
         LOCALBOOT 0

 MENU BEGIN CoreOS Menu

     LABEL coreos-master
         MENU LABEL CoreOS Master
         KERNEL images/coreos/coreos_production_pxe.vmlinuz
         APPEND initrd=images/coreos/coreos_production_pxe_image.cpio.gz cloud-config-url=http://&lt;xxx.xxx.xxx.xxx&gt;/pxe-cloud-config-single-master.yml

     LABEL coreos-slave
         MENU LABEL CoreOS Slave
         KERNEL images/coreos/coreos_production_pxe.vmlinuz
         APPEND initrd=images/coreos/coreos_production_pxe_image.cpio.gz cloud-config-url=http://&lt;xxx.xxx.xxx.xxx&gt;/pxe-cloud-config-slave.yml
 MENU END
</code></pre></div>    </div>
  </li>
</ol>

<p>This configuration file will now boot from local drive but have the option to PXE image CoreOS.</p>

<h2 id="dhcp-configuration">DHCP configuration</h2>

<p>This section covers configuring the DHCP server to hand out our new images. In this case we are assuming that there are other servers that will boot alongside other images.</p>
<ol>
  <li>
    <p>Add the <code class="highlighter-rouge">filename</code> to the <em>host</em> or <em>subnet</em> sections.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> filename "/tftpboot/pxelinux.0";
</code></pre></div>    </div>
  </li>
  <li>
    <p>At this point we want to make pxelinux configuration files that will be the templates for the different CoreOS deployments.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> subnet 10.20.30.0 netmask 255.255.255.0 {
         next-server 10.20.30.242;
         option broadcast-address 10.20.30.255;
         filename "&lt;other default image&gt;";

         ...
         # http://www.syslinux.org/wiki/index.php/PXELINUX
         host core_os_master {
                 hardware ethernet d0:00:67:13:0d:00;
                 option routers 10.20.30.1;
                 fixed-address 10.20.30.40;
                 option domain-name-servers 10.20.30.242;
                 filename "/pxelinux.0";
         }
         host core_os_slave {
                 hardware ethernet d0:00:67:13:0d:01;
                 option routers 10.20.30.1;
                 fixed-address 10.20.30.41;
                 option domain-name-servers 10.20.30.242;
                 filename "/pxelinux.0";
         }
         host core_os_slave2 {
                 hardware ethernet d0:00:67:13:0d:02;
                 option routers 10.20.30.1;
                 fixed-address 10.20.30.42;
                 option domain-name-servers 10.20.30.242;
                 filename "/pxelinux.0";
         }
         ...
 }
</code></pre></div>    </div>
  </li>
</ol>

<p>We will be specifying the node configuration later in the guide.</p>

<h2 id="kubernetes">Kubernetes</h2>

<p>To deploy our configuration we need to create an <code class="highlighter-rouge">etcd</code> master. To do so we want to pxe CoreOS with a specific cloud-config.yml. There are two options we have here.</p>
<ol>
  <li>Is to template the cloud config file and programmatically create new static configs for different cluster setups.</li>
  <li>Have a service discovery protocol running in our stack to do auto discovery.</li>
</ol>

<p>This demo we just make a static single <code class="highlighter-rouge">etcd</code> server to host our Kubernetes and <code class="highlighter-rouge">etcd</code> master servers.</p>

<p>Since we are OFFLINE here most of the helping processes in CoreOS and Kubernetes are then limited. To do our setup we will then have to download and serve up our binaries for Kubernetes in our local environment.</p>

<p>An easy solution is to host a small web server on the DHCP/TFTP host for all our binaries to make them available to the local CoreOS PXE machines.</p>

<p>To get this up and running we are going to setup a simple <code class="highlighter-rouge">apache</code> server to serve our binaries needed to bootstrap Kubernetes.</p>

<p>This is on the PXE server from the previous section:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rm /etc/httpd/conf.d/welcome.conf
<span class="nb">cd</span> /var/www/html/
wget <span class="nt">-O</span> kube-register  https://github.com/kelseyhightower/kube-register/releases/download/v0.0.2/kube-register-0.0.2-linux-amd64
wget <span class="nt">-O</span> setup-network-environment https://github.com/kelseyhightower/setup-network-environment/releases/download/v1.0.0/setup-network-environment
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kubernetes
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kube-apiserver
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kube-controller-manager
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kube-scheduler
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kubectl
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kubecfg
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kubelet
wget https://storage.googleapis.com/kubernetes-release/release/v0.15.0/bin/linux/amd64/kube-proxy
wget <span class="nt">-O</span> flanneld https://storage.googleapis.com/k8s/flanneld
</code></pre></div></div>

<p>This sets up our binaries we need to run Kubernetes. This would need to be enhanced to download from the Internet for updates in the future.</p>

<p>Now for the good stuff!</p>

<h2 id="cloud-configs">Cloud Configs</h2>

<p>The following config files are tailored for the OFFLINE version of a Kubernetes deployment.</p>

<p>These are based on the work found here: <a href="/docs/getting-started-guides/coreos/cloud-configs/master.yaml">master.yml</a>, <a href="/docs/getting-started-guides/coreos/cloud-configs/node.yaml">node.yml</a></p>

<p>To make the setup work, you need to replace a few placeholders:</p>

<ul>
  <li>Replace <code class="highlighter-rouge">&lt;PXE_SERVER_IP&gt;</code> with your PXE server ip address (e.g. 10.20.30.242)</li>
  <li>Replace <code class="highlighter-rouge">&lt;MASTER_SERVER_IP&gt;</code> with the Kubernetes master ip address (e.g. 10.20.30.40)</li>
  <li>If you run a private docker registry, replace <code class="highlighter-rouge">rdocker.example.com</code> with your docker registry dns name.</li>
  <li>If you use a proxy, replace <code class="highlighter-rouge">rproxy.example.com</code> with your proxy server (and port)</li>
  <li>Add your own SSH public key(s) to the cloud config at the end</li>
</ul>

<h3 id="masteryml">master.yml</h3>

<p>On the PXE server make and fill in the variables <code class="highlighter-rouge">vi /var/www/html/coreos/pxe-cloud-config-master.yml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cloud-config</span>
<span class="nn">---</span>
<span class="na">write_files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/opt/bin/waiter.sh</span>
    <span class="na">owner</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#! /usr/bin/bash</span>
      <span class="no">until curl http://127.0.0.1:4001/v2/machines; do sleep 2; done</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/opt/bin/kubernetes-download.sh</span>
    <span class="na">owner</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">permissions</span><span class="pi">:</span> <span class="s">0755</span>
    <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#! /usr/bin/bash</span>
      <span class="no">/usr/bin/wget -N -P "/opt/bin" "http://&lt;PXE_SERVER_IP&gt;/kubectl"</span>
      <span class="no">/usr/bin/wget -N -P "/opt/bin" "http://&lt;PXE_SERVER_IP&gt;/kubernetes"</span>
      <span class="no">/usr/bin/wget -N -P "/opt/bin" "http://&lt;PXE_SERVER_IP&gt;/kubecfg"</span>
      <span class="no">chmod +x /opt/bin/*</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/profile.d/opt-path.sh</span>
    <span class="na">owner</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">permissions</span><span class="pi">:</span> <span class="s">0755</span>
    <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">#! /usr/bin/bash</span>
      <span class="no">PATH=$PATH/opt/bin</span>
<span class="na">coreos</span><span class="pi">:</span>
  <span class="na">units</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">10-eno1.network</span>
      <span class="na">runtime</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Match]</span>
        <span class="no">Name=eno1</span>
        <span class="no">[Network]</span>
        <span class="no">DHCP=yes</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">20-nodhcp.network</span>
      <span class="na">runtime</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Match]</span>
        <span class="no">Name=en*</span>
        <span class="no">[Network]</span>
        <span class="no">DHCP=none</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">get-kube-tools.service</span>
      <span class="na">runtime</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStart=/opt/bin/kubernetes-download.sh</span>
        <span class="no">RemainAfterExit=yes</span>
        <span class="no">Type=oneshot</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">setup-network-environment.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Setup Network Environment</span>
        <span class="no">Documentation=https://github.com/kelseyhightower/setup-network-environment</span>
        <span class="no">Requires=network-online.target</span>
        <span class="no">After=network-online.target</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/setup-network-environment</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/setup-network-environment</span>
        <span class="no">ExecStart=/opt/bin/setup-network-environment</span>
        <span class="no">RemainAfterExit=yes</span>
        <span class="no">Type=oneshot</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">etcd.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=etcd</span>
        <span class="no">Requires=setup-network-environment.service</span>
        <span class="no">After=setup-network-environment.service</span>
        <span class="no">[Service]</span>
        <span class="no">EnvironmentFile=/etc/network-environment</span>
        <span class="no">User=etcd</span>
        <span class="no">PermissionsStartOnly=true</span>
        <span class="no">ExecStart=/usr/bin/etcd \</span>
        <span class="no">--name ${DEFAULT_IPV4} \</span>
        <span class="no">--addr ${DEFAULT_IPV4}:4001 \</span>
        <span class="no">--bind-addr 0.0.0.0 \</span>
        <span class="no">--cluster-active-size 1 \</span>
        <span class="no">--data-dir /var/lib/etcd \</span>
        <span class="no">--http-read-timeout 86400 \</span>
        <span class="no">--peer-addr ${DEFAULT_IPV4}:7001 \</span>
        <span class="no">--snapshot true</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10s</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">fleet.socket</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Socket]</span>
        <span class="no">ListenStream=/var/run/fleet.sock</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">fleet.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=fleet daemon</span>
        <span class="no">Wants=etcd.service</span>
        <span class="no">After=etcd.service</span>
        <span class="no">Wants=fleet.socket</span>
        <span class="no">After=fleet.socket</span>
        <span class="no">[Service]</span>
        <span class="no">Environment="FLEET_ETCD_SERVERS=http://127.0.0.1:4001"</span>
        <span class="no">Environment="FLEET_METADATA=role=master"</span>
        <span class="no">ExecStart=/usr/bin/fleetd</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10s</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">etcd-waiter.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=etcd waiter</span>
        <span class="no">Wants=network-online.target</span>
        <span class="no">Wants=etcd.service</span>
        <span class="no">After=etcd.service</span>
        <span class="no">After=network-online.target</span>
        <span class="no">Before=flannel.service</span>
        <span class="no">Before=setup-network-environment.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/waiter.sh</span>
        <span class="no">ExecStart=/usr/bin/bash /opt/bin/waiter.sh</span>
        <span class="no">RemainAfterExit=true</span>
        <span class="no">Type=oneshot</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">flannel.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Wants=etcd-waiter.service</span>
        <span class="no">After=etcd-waiter.service</span>
        <span class="no">Requires=etcd.service</span>
        <span class="no">After=etcd.service</span>
        <span class="no">After=network-online.target</span>
        <span class="no">Wants=network-online.target</span>
        <span class="no">Description=flannel is an etcd backed overlay network for containers</span>
        <span class="no">[Service]</span>
        <span class="no">Type=notify</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/flanneld</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/flanneld</span>
        <span class="no">ExecStartPre=-/usr/bin/etcdctl mk /coreos.com/network/config '{"Network":"10.100.0.0/16", "Backend": {"Type": "vxlan"}}'</span>
        <span class="no">ExecStart=/opt/bin/flanneld</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-apiserver.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes API Server</span>
        <span class="no">Documentation=https://github.com/kubernetes/kubernetes</span>
        <span class="no">Requires=etcd.service</span>
        <span class="no">After=etcd.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kube-apiserver</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-apiserver</span>
        <span class="no">ExecStart=/opt/bin/kube-apiserver \</span>
        <span class="no">--address=0.0.0.0 \</span>
        <span class="no">--port=8080 \</span>
        <span class="no">--service-cluster-ip-range=10.100.0.0/16 \</span>
        <span class="no">--etcd-servers=http://127.0.0.1:4001 \</span>
        <span class="no">--logtostderr=true</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-controller-manager.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes Controller Manager</span>
        <span class="no">Documentation=https://github.com/kubernetes/kubernetes</span>
        <span class="no">Requires=kube-apiserver.service</span>
        <span class="no">After=kube-apiserver.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kube-controller-manager</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-controller-manager</span>
        <span class="no">ExecStart=/opt/bin/kube-controller-manager \</span>
        <span class="no">--master=127.0.0.1:8080 \</span>
        <span class="no">--logtostderr=true</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-scheduler.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes Scheduler</span>
        <span class="no">Documentation=https://github.com/kubernetes/kubernetes</span>
        <span class="no">Requires=kube-apiserver.service</span>
        <span class="no">After=kube-apiserver.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kube-scheduler</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-scheduler</span>
        <span class="no">ExecStart=/opt/bin/kube-scheduler --master=127.0.0.1:8080</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-register.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes Registration Service</span>
        <span class="no">Documentation=https://github.com/kelseyhightower/kube-register</span>
        <span class="no">Requires=kube-apiserver.service</span>
        <span class="no">After=kube-apiserver.service</span>
        <span class="no">Requires=fleet.service</span>
        <span class="no">After=fleet.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kube-register</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-register</span>
        <span class="no">ExecStart=/opt/bin/kube-register \</span>
        <span class="no">--metadata=role=node \</span>
        <span class="no">--fleet-endpoint=unix:///var/run/fleet.sock \</span>
        <span class="no">--healthz-port=10248 \</span>
        <span class="no">--api-endpoint=http://127.0.0.1:8080</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
  <span class="na">update</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">stable</span>
    <span class="na">reboot-strategy</span><span class="pi">:</span> <span class="s">off</span>
<span class="na">ssh_authorized_keys</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ssh-rsa AAAAB3NzaC1yc2EAAAAD...</span>
</code></pre></div></div>

<h3 id="nodeyml">node.yml</h3>

<p>On the PXE server make and fill in the variables <code class="highlighter-rouge">vi /var/www/html/coreos/pxe-cloud-config-slave.yml</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#cloud-config</span>
<span class="nn">---</span>
<span class="na">write_files</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/etc/default/docker</span>
    <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">DOCKER_EXTRA_OPTS='--insecure-registry="rdocker.example.com:5000"'</span>
<span class="na">coreos</span><span class="pi">:</span>
  <span class="na">units</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">10-eno1.network</span>
      <span class="na">runtime</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Match]</span>
        <span class="no">Name=eno1</span>
        <span class="no">[Network]</span>
        <span class="no">DHCP=yes</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">20-nodhcp.network</span>
      <span class="na">runtime</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Match]</span>
        <span class="no">Name=en*</span>
        <span class="no">[Network]</span>
        <span class="no">DHCP=none</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">etcd.service</span>
      <span class="na">mask</span><span class="pi">:</span> <span class="no">true</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">docker.service</span>
      <span class="na">drop-ins</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">50-insecure-registry.conf</span>
          <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="no">[Service]</span>
            <span class="no">Environment="HTTP_PROXY=http://rproxy.example.com:3128/" "NO_PROXY=localhost,127.0.0.0/8,rdocker.example.com"</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">fleet.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=fleet daemon</span>
        <span class="no">Wants=fleet.socket</span>
        <span class="no">After=fleet.socket</span>
        <span class="no">[Service]</span>
        <span class="no">Environment="FLEET_ETCD_SERVERS=http://&lt;MASTER_SERVER_IP&gt;:4001"</span>
        <span class="no">Environment="FLEET_METADATA=role=node"</span>
        <span class="no">ExecStart=/usr/bin/fleetd</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10s</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">flannel.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">After=network-online.target</span>
        <span class="no">Wants=network-online.target</span>
        <span class="no">Description=flannel is an etcd backed overlay network for containers</span>
        <span class="no">[Service]</span>
        <span class="no">Type=notify</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/flanneld</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/flanneld</span>
        <span class="no">ExecStart=/opt/bin/flanneld -etcd-endpoints http://&lt;MASTER_SERVER_IP&gt;:4001</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">docker.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">After=flannel.service</span>
        <span class="no">Wants=flannel.service</span>
        <span class="no">Description=Docker Application Container Engine</span>
        <span class="no">Documentation=http://docs.docker.io</span>
        <span class="no">[Service]</span>
        <span class="no">EnvironmentFile=-/etc/default/docker</span>
        <span class="no">EnvironmentFile=/run/flannel/subnet.env</span>
        <span class="no">ExecStartPre=/bin/mount --make-rprivate /</span>
        <span class="no">ExecStart=/usr/bin/docker -d --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU} -s=overlay -H fd:// ${DOCKER_EXTRA_OPTS}</span>
        <span class="no">[Install]</span>
        <span class="no">WantedBy=multi-user.target</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">setup-network-environment.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Setup Network Environment</span>
        <span class="no">Documentation=https://github.com/kelseyhightower/setup-network-environment</span>
        <span class="no">Requires=network-online.target</span>
        <span class="no">After=network-online.target</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=-/usr/bin/mkdir -p /opt/bin</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/setup-network-environment</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/setup-network-environment</span>
        <span class="no">ExecStart=/opt/bin/setup-network-environment</span>
        <span class="no">RemainAfterExit=yes</span>
        <span class="no">Type=oneshot</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-proxy.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes Proxy</span>
        <span class="no">Documentation=https://github.com/kubernetes/kubernetes</span>
        <span class="no">Requires=setup-network-environment.service</span>
        <span class="no">After=setup-network-environment.service</span>
        <span class="no">[Service]</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kube-proxy</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kube-proxy</span>
        <span class="no">ExecStart=/opt/bin/kube-proxy \</span>
        <span class="no">--etcd-servers=http://&lt;MASTER_SERVER_IP&gt;:4001 \</span>
        <span class="no">--logtostderr=true</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kube-kubelet.service</span>
      <span class="na">command</span><span class="pi">:</span> <span class="s">start</span>
      <span class="na">content</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">[Unit]</span>
        <span class="no">Description=Kubernetes Kubelet</span>
        <span class="no">Documentation=https://github.com/kubernetes/kubernetes</span>
        <span class="no">Requires=setup-network-environment.service</span>
        <span class="no">After=setup-network-environment.service</span>
        <span class="no">[Service]</span>
        <span class="no">EnvironmentFile=/etc/network-environment</span>
        <span class="no">ExecStartPre=/usr/bin/wget -N -P /opt/bin http://&lt;PXE_SERVER_IP&gt;/kubelet</span>
        <span class="no">ExecStartPre=/usr/bin/chmod +x /opt/bin/kubelet</span>
        <span class="no">ExecStart=/opt/bin/kubelet \</span>
        <span class="no">--address=0.0.0.0 \</span>
        <span class="no">--port=10250 \</span>
        <span class="no">--hostname-override=${DEFAULT_IPV4} \</span>
        <span class="no">--api-servers=&lt;MASTER_SERVER_IP&gt;:8080 \</span>
        <span class="no">--healthz-bind-address=0.0.0.0 \</span>
        <span class="no">--healthz-port=10248 \</span>
        <span class="no">--logtostderr=true</span>
        <span class="no">Restart=always</span>
        <span class="no">RestartSec=10</span>
  <span class="na">update</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">stable</span>
    <span class="na">reboot-strategy</span><span class="pi">:</span> <span class="s">off</span>
<span class="na">ssh_authorized_keys</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ssh-rsa AAAAB3NzaC1yc2EAAAAD...</span>
</code></pre></div></div>

<h2 id="new-pxelinuxcfg-file">New pxelinux.cfg file</h2>

<p>Create a pxelinux target file for a <em>slave</em> node: <code class="highlighter-rouge">vi /tftpboot/pxelinux.cfg/coreos-node-slave</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">default</span> <span class="n">coreos</span>
<span class="n">prompt</span> <span class="m">1</span>
<span class="n">timeout</span> <span class="m">15</span>

<span class="n">display</span> <span class="n">boot</span>.<span class="n">msg</span>

<span class="n">label</span> <span class="n">coreos</span>
    <span class="n">menu</span> <span class="n">default</span>
    <span class="n">kernel</span> <span class="n">images</span>/<span class="n">coreos</span>/<span class="n">coreos_production_pxe</span>.<span class="n">vmlinuz</span>
    <span class="n">append</span> <span class="n">initrd</span>=<span class="n">images</span>/<span class="n">coreos</span>/<span class="n">coreos_production_pxe_image</span>.<span class="n">cpio</span>.<span class="n">gz</span> <span class="n">cloud</span>-<span class="n">config</span>-<span class="n">url</span>=<span class="n">http</span>://&lt;<span class="n">pxe</span>-<span class="n">host</span>-<span class="n">ip</span>&gt;/<span class="n">coreos</span>/<span class="n">pxe</span>-<span class="n">cloud</span>-<span class="n">config</span>-<span class="n">slave</span>.<span class="n">yml</span> <span class="n">console</span>=<span class="n">tty0</span> <span class="n">console</span>=<span class="n">ttyS0</span> <span class="n">coreos</span>.<span class="n">autologin</span>=<span class="n">tty1</span> <span class="n">coreos</span>.<span class="n">autologin</span>=<span class="n">ttyS0</span>
</code></pre></div></div>

<p>And one for the <em>master</em> node: <code class="highlighter-rouge">vi /tftpboot/pxelinux.cfg/coreos-node-master</code></p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">default</span> <span class="n">coreos</span>
<span class="n">prompt</span> <span class="m">1</span>
<span class="n">timeout</span> <span class="m">15</span>

<span class="n">display</span> <span class="n">boot</span>.<span class="n">msg</span>

<span class="n">label</span> <span class="n">coreos</span>
    <span class="n">menu</span> <span class="n">default</span>
    <span class="n">kernel</span> <span class="n">images</span>/<span class="n">coreos</span>/<span class="n">coreos_production_pxe</span>.<span class="n">vmlinuz</span>
    <span class="n">append</span> <span class="n">initrd</span>=<span class="n">images</span>/<span class="n">coreos</span>/<span class="n">coreos_production_pxe_image</span>.<span class="n">cpio</span>.<span class="n">gz</span> <span class="n">cloud</span>-<span class="n">config</span>-<span class="n">url</span>=<span class="n">http</span>://&lt;<span class="n">pxe</span>-<span class="n">host</span>-<span class="n">ip</span>&gt;/<span class="n">coreos</span>/<span class="n">pxe</span>-<span class="n">cloud</span>-<span class="n">config</span>-<span class="n">master</span>.<span class="n">yml</span> <span class="n">console</span>=<span class="n">tty0</span> <span class="n">console</span>=<span class="n">ttyS0</span> <span class="n">coreos</span>.<span class="n">autologin</span>=<span class="n">tty1</span> <span class="n">coreos</span>.<span class="n">autologin</span>=<span class="n">ttyS0</span>
</code></pre></div></div>

<h2 id="specify-the-pxelinux-targets">Specify the pxelinux targets</h2>

<p>Now that we have our new targets setup for master and slave we want to configure the specific hosts to those targets. We will do this by using the pxelinux mechanism of setting a specific MAC addresses to a specific pxelinux.cfg file.</p>

<p>Refer to the MAC address table in the beginning of this guide. Documentation for more details can be found <a href="http://www.syslinux.org/wiki/index.php/PXELINUX">here</a>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /tftpboot/pxelinux.cfg
ln <span class="nt">-s</span> coreos-node-master 01-d0-00-67-13-0d-00
ln <span class="nt">-s</span> coreos-node-slave 01-d0-00-67-13-0d-01
ln <span class="nt">-s</span> coreos-node-slave 01-d0-00-67-13-0d-02
</code></pre></div></div>

<p>Reboot these servers to get the images PXEd and ready for running containers!</p>

<h2 id="creating-test-pod">Creating test pod</h2>

<p>Now that the CoreOS with Kubernetes installed is up and running lets spin up some Kubernetes pods to demonstrate the system.</p>

<p>See <a href="/docs/user-guide/simple-nginx/">a simple nginx example</a> to try out your new cluster.</p>

<p>For more complete applications, please look in the <a href="https://github.com/kubernetes/examples/tree/master/">examples directory</a>.</p>

<h2 id="helping-commands-for-debugging">Helping commands for debugging</h2>

<p>List all keys in etcd:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>etcdctl <span class="nb">ls</span> <span class="nt">--recursive</span>
</code></pre></div></div>

<p>List fleet machines</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fleetctl list-machines
</code></pre></div></div>

<p>Check system status of services on master:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status kube-apiserver
systemctl status kube-controller-manager
systemctl status kube-scheduler
systemctl status kube-register
</code></pre></div></div>

<p>Check system status of services on a node:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status kube-kubelet
systemctl status docker.service
</code></pre></div></div>

<p>List Kubernetes</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods
kubectl get nodes
</code></pre></div></div>

<p>Kill all pods:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for </span>i <span class="k">in</span> <span class="sb">`</span>kubectl get pods | awk <span class="s1">'{print $1}'</span><span class="sb">`</span><span class="p">;</span> <span class="k">do </span>kubectl delete pod <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<h2 id="support-level">Support Level</h2>

<table>
  <thead>
    <tr>
      <th>IaaS Provider</th>
      <th>Config. Mgmt</th>
      <th>OS</th>
      <th>Networking</th>
      <th>Docs</th>
      <th>Conforms</th>
      <th>Support Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Bare-metal (Offline)</td>
      <td>CoreOS</td>
      <td>CoreOS</td>
      <td>flannel</td>
      <td><a href="/docs/getting-started-guides/coreos/bare_metal_offline/">docs</a></td>
      <td> </td>
      <td>Community (<a href="https://github.com/jeffbean">@jeffbean</a>)</td>
    </tr>
  </tbody>
</table>

<p>For support level information on all solutions, see the <a href="/docs/getting-started-guides/#table-of-solutions/">Table of solutions</a> chart.</p>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/getting-started-guides/coreos/bare_metal_offline.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/getting-started-guides/coreos/bare_metal_offline/",
                "title" : "Offline",
                "permalink" : "https://kubernetes.io/docs/getting-started-guides/coreos/bare_metal_offline/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/getting-started-guides/coreos/bare_metal_offline.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
