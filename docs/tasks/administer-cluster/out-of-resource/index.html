
  
    
    

  

  
    
    

  

  
    
    

  

  
    

<!Doctype html>
<html id="docs" class="Tasks">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/images/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono">
    <link rel="stylesheet" type="text/css" href="/css/styles.css"><!-- default styles.css on -->
    <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <link rel="stylesheet" type="text/css" href="/css/callouts.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-jekyll/tags.css">
    
    
    <!-- no custom css detected -->

    
    <meta name="description" content="配置资源不足处理方式" />
    

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/custom-jekyll/tags.js"></script>
    <!-- no custom js detected -->
    <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>配置资源不足处理方式 | Kubernetes</title>
<meta name="generator" content="Jekyll v3.6.0" />
<meta property="og:title" content="配置资源不足处理方式" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Production-Grade Container Orchestration" />
<meta property="og:description" content="Production-Grade Container Orchestration" />
<link rel="canonical" href="http://0.0.0.0:4000/docs/tasks/administer-cluster/out-of-resource/" />
<meta property="og:url" content="http://0.0.0.0:4000/docs/tasks/administer-cluster/out-of-resource/" />
<meta property="og:site_name" content="Kubernetes" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kubernetesio" />
<script type="application/ld+json">
{"description":"Production-Grade Container Orchestration","@type":"WebPage","url":"http://0.0.0.0:4000/docs/tasks/administer-cluster/out-of-resource/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/favicon.png"}},"headline":"配置资源不足处理方式","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>

<div id="cellophane" onclick="kub.toggleMenu()"></div>

<header>
    <a href="/" class="logo"></a>

    <div class="nav-buttons" data-auto-burger="primary">
        <ul class="global-nav">
            <li><a href="/docs/home/">Documentation</a></li>
            <li><a href="http://blog.kubernetes.io/">Blog</a></li>
            <li><a href="/partners/">Partners</a></li>
            <li><a href="/community/">Community</a></li>
            <li><a href="/case-studies/">Case Studies</a></li>
            <li>
                <a href="#">
                    v1.9 <span class="ui-icon ui-icon-carat-1-s"></span>
                </a>
                <ul>
                
                    
                    <li><a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">v1.9</a></li>
                    
                
                    
                    <li><a href="https://v1-8.docs.kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">v1.8</a></li>
                    
                
                    
                    <li><a href="https://v1-7.docs.kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">v1.7</a></li>
                    
                
                    
                    <li><a href="https://v1-6.docs.kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">v1.6</a></li>
                    
                
                    
                    <li><a href="https://v1-5.docs.kubernetes.io/docs/tasks/administer-cluster/out-of-resource/">v1.5</a></li>
                    
                
                </ul>
            </li>
        </ul>
        <!-- <a href="/docs/home" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a> -->
        <a href="/docs/tutorials/kubernetes-basics/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
        <button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
    </div>

    <nav id="mainNav">
        <main data-auto-burger="primary">
        <div class="nav-box">
            <h3><a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a></h3>
            <p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
        </div>
        <div class="nav-box">
            <h3><a href="/docs/home/">Documentation</a></h3>
            <p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
        </div>
        <div class="nav-box">
            <h3><a href="/community/">Community</a></h3>
            <p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
        </div>
        <div class="nav-box">
            <h3><a href="http://blog.kubernetes.io">Blog</a></h3>
            <p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
        </div>
        </main>
        <main data-auto-burger="primary">
        <div class="left">
            <h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
            <a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
        </div>

        <div class="right">
            <h5 class="github-invite">Explore the community</h5>
            <div class="social">
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
        </div>
        <div class="clear" style="clear: both"></div>
        </main>
    </nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Tasks</h1>
  <h5>Step-by-step instructions for performing operations with Kubernetes.</h5>
  <div id="vendorStrip" class="light-text">
    <ul>
      <li><a href="/docs/home/" >HOME</a></li>
      <li><a href="/docs/setup/" >SETUP</a></li>
      <li><a href="/docs/concepts/" >CONCEPTS</a></li>
      <li><a href="/docs/tasks/" class="YAH">TASKS</a></li>
      <li><a href="/docs/tutorials/" >TUTORIALS</a></li>
      <li><a href="/docs/reference/" >REFERENCE</a></li>
    </ul>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)" autofocus="autofocus">
    </div>
  </div>
</section>




<section id="encyclopedia">
  <div id="docsToc">
        <div class="pi-accordion">
          
  

    

    
      <a class="item" data-title="任务" href="/docs/tasks/"></a>
    
  

  
    <div class="item" data-title="Install Tools">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Install and Set Up kubectl" href="/docs/tasks/tools/install-kubectl/"></a>
    
  

  

    

    
      <a class="item" data-title="安装 Minikube" href="/docs/tasks/tools/install-minikube/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/setup/independent/install-kubeadm/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Configure Pods and Containers">
      <div class="container">
        
  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/assign-memory-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/assign-cpu-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="给 Pod 配置服务质量等级" href="/docs/tasks/configure-pod-container/quality-service-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="Assign CPU and RAM Resources to a Container" href="/docs/tasks/configure-pod-container/assign-cpu-ram-container/"></a>
    
  

  

    

    
      <a class="item" data-title="将扩展资源分配给容器" href="/docs/tasks/configure-pod-container/extended-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-persistent-volume-storage/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-projected-volume-storage/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="Configure a Security Context for a Pod or Container" href="/docs/tasks/configure-pod-container/security-context/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="配置Pod的Service Account" href="/docs/tasks/configure-pod-container/configure-service-account/"></a>
    
  

  

    

    
      <a class="item" data-title="从私有仓库拉取镜像" href="/docs/tasks/configure-pod-container/pull-image-private-registry/"></a>
    
  

  

    

    
      <a class="item" data-title="配置Liveness和Readiness探针" href="/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/assign-pods-nodes/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/configure-pod-container/configure-pod-initialization/"></a>
    
  

  

    

    
      <a class="item" data-title="给容器生命周期设置操作事件" href="/docs/tasks/configure-pod-container/attach-handler-lifecycle-event/"></a>
    
  

  

    

    
      <a class="item" data-title="在 Pod 里使用 ConfigMap 数据" href="/docs/tasks/configure-pod-container/configure-pod-configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="Translate a Docker Compose File to Kubernetes Resources" href="/docs/tools/kompose/user-guide/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Inject Data Into Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Define a Command and Arguments for a Container" href="/docs/tasks/inject-data-application/define-command-argument-container/"></a>
    
  

  

    

    
      <a class="item" data-title="为容器定义环境变量" href="/docs/tasks/inject-data-application/define-environment-variable-container/"></a>
    
  

  

    

    
      <a class="item" data-title="通过环境变量向容器暴露 Pod 信息" href="/docs/tasks/inject-data-application/environment-variable-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="通过文件暴露 Pod 信息给容器" href="/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Secrets 安全地分发凭证" href="/docs/tasks/inject-data-application/distribute-credentials-secure/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 PodPreset 将信息注入 Pods" href="/docs/tasks/inject-data-application/podpreset/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Applications">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用 Deployment 运行无状态应用" href="/docs/tasks/run-application/run-stateless-application-deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Single-Instance Stateful Application" href="/docs/tasks/run-application/run-single-instance-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="Run a Replicated Stateful Application" href="/docs/tasks/run-application/run-replicated-stateful-application/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 kubectl patch 更新 API 对象" href="/docs/tasks/run-application/update-api-object-kubectl-patch/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/run-application/upgrade-pet-set-to-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="Scale a StatefulSet" href="/docs/tasks/run-application/scale-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="删除StatefulSet" href="/docs/tasks/run-application/delete-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="强制删除StatefulSet中的Pod" href="/docs/tasks/run-application/force-delete-stateful-set-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Replication Controller 进行滚动升级" href="/docs/tasks/run-application/rolling-update-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/tasks/run-application/horizontal-pod-autoscale/"></a>
    
  

  

    

    
      <a class="item" data-title="Pod水平自动伸缩（Horizontal Pod Autoscaling）演练" href="/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="指定应用程序的中断预算（Disruption Budget）" href="/docs/tasks/run-application/configure-pdb/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Run Jobs">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用扩展并行处理" href="/docs/tasks/job/parallel-processing-expansion/"></a>
    
  

  

    

    
      <a class="item" data-title="使用工作队列进行粗粒度并行处理" href="/docs/tasks/job/coarse-parallel-processing-work-queue/"></a>
    
  

  

    

    
      <a class="item" data-title="使用工作队列进行精细的并行处理" href="/docs/tasks/job/fine-parallel-processing-work-queue/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Access Applications in a Cluster">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Web UI (Dashboard)" href="/docs/tasks/access-application-cluster/web-ui-dashboard/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群" href="/docs/tasks/access-application-cluster/access-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="配置对多集群的访问" href="/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"></a>
    
  

  

    

    
      <a class="item" data-title="通过端口转发访问集群中的应用程序" href="/docs/tasks/access-application-cluster/port-forward-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="为集群中的应用提供负载均衡访问" href="/docs/tasks/access-application-cluster/load-balance-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 service 访问群集中的应用程序" href="/docs/tasks/access-application-cluster/service-access-application-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Service 把前端连接到后端" href="/docs/tasks/access-application-cluster/connecting-frontend-backend/"></a>
    
  

  

    

    
      <a class="item" data-title="创建一个外部负载均衡器" href="/docs/tasks/access-application-cluster/create-external-load-balancer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置云平台防火墙" href="/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/"></a>
    
  

  

    

    
      <a class="item" data-title="在运行集群中查看所有 Container Image" href="/docs/tasks/access-application-cluster/list-all-running-container-images/"></a>
    
  

  

    

    
      <a class="item" data-title="同 Pod 内的容器使用共享卷通信" href="/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"></a>
    
  

  

    

    
      <a class="item" data-title="Configuring DNS for a Cluster" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/cluster-dns"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Monitor, Log, and Debug">
      <div class="container">
        
  

    

    
      <a class="item" data-title="核心指标管道" href="/docs/tasks/debug-application-cluster/core-metrics-pipeline/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/debug-application-cluster/resource-usage-monitoring/"></a>
    
  

  

    

    
      <a class="item" data-title="获取一个运行容器的 Shell" href="/docs/tasks/debug-application-cluster/get-shell-running-container/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/debug-application-cluster/monitor-node-health/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/debug-application-cluster/logging-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="Stackdriver 中的事件" href="/docs/tasks/debug-application-cluster/events-stackdriver/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/debug-application-cluster/logging-elasticsearch-kibana/"></a>
    
  

  

    

    
      <a class="item" data-title="确定 Pod 失败的原因" href="/docs/tasks/debug-application-cluster/determine-reason-pod-failure/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 Init 容器" href="/docs/tasks/debug-application-cluster/debug-init-containers/"></a>
    
  

  

    

    
      <a class="item" data-title="Debug Pods and Replication Controllers" href="/docs/tasks/debug-application-cluster/debug-pod-replication-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 Service" href="/docs/tasks/debug-application-cluster/debug-service/"></a>
    
  

  

    

    
      <a class="item" data-title="集群故障排除" href="/docs/tasks/debug-application-cluster/debug-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="排查应用故障" href="/docs/tasks/debug-application-cluster/debug-application/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 StatefulSet" href="/docs/tasks/debug-application-cluster/debug-stateful-set/"></a>
    
  

  

    

    
      <a class="item" data-title="应用程序自检和调试" href="/docs/tasks/debug-application-cluster/debug-application-introspection/"></a>
    
  

  

    

    
      <a class="item" data-title="审计" href="/docs/tasks/debug-application-cluster/audit/"></a>
    
  

  

    

    
      <a class="item" data-title="本地开发和调试 service" href="/docs/tasks/debug-application-cluster/local-debugging/"></a>
    
  

  

    

    
      <a class="item" data-title="Use Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.5/examples/explorer"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Extend Kubernetes">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用 HTTP 代理访问 Kubernetes API" href="/docs/tasks/access-kubernetes-api/http-proxy-access-api/"></a>
    
  

  

    

    
      <a class="item" data-title="使用CRD(CustomResourceDefinitions)扩展Kubernetes API" href="/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 ThirdPartyResources 扩展 Kubernetes API" href="/docs/tasks/access-kubernetes-api/extend-api-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="Migrate a ThirdPartyResource to CustomResourceDefinition" href="/docs/tasks/access-kubernetes-api/migrate-third-party-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="配置汇聚层（aggregation layer）" href="/docs/tasks/access-kubernetes-api/configure-aggregation-layer/"></a>
    
  

  

    

    
      <a class="item" data-title="配置扩展 API 服务器" href="/docs/tasks/access-kubernetes-api/setup-extension-api-server/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Helm 安装服务目录（Service Catalog）" href="/docs/tasks/service-catalog/install-service-catalog-using-helm/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 SC 安装服务目录（Service Catalog）" href="/docs/tasks/service-catalog/install-service-catalog-using-sc/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="TLS">
      <div class="container">
        
  

    

    
      <a class="item" data-title="管理集群中的TLS认证" href="/docs/tasks/tls/managing-tls-in-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="证书轮换" href="/docs/tasks/tls/certificate-rotation/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Administer a Cluster">
      <div class="container">
        
  
    <div class="item" data-title="Manage Memory, CPU, and API Resources">
      <div class="container">
        
  

    

    
      <a class="item" data-title="为命名空间配置默认的内存请求与限额" href="/docs/tasks/administer-cluster/memory-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="在命名空间中配置默认的CPU请求与限额" href="/docs/tasks/administer-cluster/cpu-default-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 设置最小和最大内存限制" href="/docs/tasks/administer-cluster/memory-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Namespace 配置最小和最大 CPU 限制" href="/docs/tasks/administer-cluster/cpu-constraint-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="应用资源配额和限额" href="/docs/tasks/administer-cluster/apply-resource-quota-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置CPU和内存配额（Quota）" href="/docs/tasks/administer-cluster/quota-memory-cpu-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="为名字空间配置Pod配额" href="/docs/tasks/administer-cluster/quota-pod-namespace/"></a>
    
  

  

    

    
      <a class="item" data-title="配置API对象（API Object）的配额（Quota）" href="/docs/tasks/administer-cluster/quota-api-object/"></a>
    
  

  

    

    
      <a class="item" data-title="为节点发布扩展资源" href="/docs/tasks/administer-cluster/extended-resource-node/"></a>
    
  

  

    

    
      <a class="item" data-title="控制节点上的CPU管理策略" href="/docs/tasks/administer-cluster/cpu-management-policies/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="通过 Kubernetes API 访问集群" href="/docs/tasks/administer-cluster/access-cluster-api/"></a>
    
  

  

    

    
      <a class="item" data-title="访问集群上运行的服务" href="/docs/tasks/administer-cluster/access-cluster-services/"></a>
    
  

  

    

    
      <a class="item" data-title="集群安全" href="/docs/tasks/administer-cluster/securing-a-cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="通过 Rest 加密 Secret 数据" href="/docs/tasks/administer-cluster/encrypt-data/"></a>
    
  

  

    

    
      <a class="item" data-title="为 Kubernetes 运行 etcd 集群" href="/docs/tasks/administer-cluster/configure-upgrade-etcd/"></a>
    
  

  

    

    
      <a class="item" data-title="静态 Pod" href="/docs/tasks/administer-cluster/static-pod/"></a>
    
  

  

    

    
      <a class="item" data-title="集群管理" href="/docs/tasks/administer-cluster/cluster-management/"></a>
    
  

  

    

    
      <a class="item" data-title="1.6 版本集群管理指南" href="/docs/tasks/administer-cluster/upgrade-1-6/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.6 升级到 1.7" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-7/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm 集群从 1.7 升级到 1.8" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-8/"></a>
    
  

  

    

    
      <a class="item" data-title="kubeadm 集群在 1.8 和 1.9 版本之间进行升级和降级" href="/docs/tasks/administer-cluster/kubeadm-upgrade-1-9/"></a>
    
  

  

    

    
      <a class="item" data-title="将 kubeadm HA 集群从 1.9.x 升级到 1.9.y" href="/docs/tasks/administer-cluster/kubeadm-upgrade-ha/"></a>
    
  

  

    

    
      <a class="item" data-title="使用命名空间共享一个集群" href="/docs/tasks/administer-cluster/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="演示命名空间" href="/docs/tasks/administer-cluster/namespaces-walkthrough/"></a>
    
  

  

    

    
      <a class="item" data-title="集群 DNS Service Autoscale" href="/docs/tasks/administer-cluster/dns-horizontal-autoscaling/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/administer-cluster/coredns/"></a>
    
  

  

    

    
      <a class="item" data-title="遵循应用中断预算安全移除节点" href="/docs/tasks/administer-cluster/safely-drain-node/"></a>
    
  

  

    

    
      <a class="item" data-title="设置 Pod CPU 和内存限制" href="/docs/tasks/administer-cluster/cpu-memory-limit/"></a>
    
  

  

    

    
      <a class="item" data-title="配置资源不足处理方式" href="/docs/tasks/administer-cluster/out-of-resource/"></a>
    
  

  

    

    
      <a class="item" data-title="为系统守护进程预留计算资源" href="/docs/tasks/administer-cluster/reserve-compute-resources/"></a>
    
  

  

    

    
      <a class="item" data-title="关键插件 Pod 的调度保证" href="/docs/tasks/administer-cluster/guaranteed-scheduling-critical-addon-pods/"></a>
    
  

  

    

    
      <a class="item" data-title="声明网络策略" href="/docs/tasks/administer-cluster/declare-network-policy/"></a>
    
  

  
    <div class="item" data-title="Install Network Policy Provider">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用 Calico 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/calico-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Cilium 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/cilium-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kube-router 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/kube-router-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Romana 来提供 NetworkPolicy" href="/docs/tasks/administer-cluster/romana-network-policy/"></a>
    
  

  

    

    
      <a class="item" data-title="为了 NetworkPolicy 使用 Weave 网络" href="/docs/tasks/administer-cluster/weave-network-policy/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="重新配置活动集群中节点的 Kubelet" href="/docs/tasks/administer-cluster/reconfigure-kubelet/"></a>
    
  

  

    

    
      <a class="item" data-title="通过配置文件设置 Kubelet 参数" href="/docs/tasks/administer-cluster/kubelet-config-file/"></a>
    
  

  

    

    
      <a class="item" data-title="更改 PersistentVolume 的回收策略" href="/docs/tasks/administer-cluster/change-pv-reclaim-policy/"></a>
    
  

  

    

    
  

  

    

    
      <a class="item" data-title="限制存储使用量" href="/docs/tasks/administer-cluster/limit-storage-consumption/"></a>
    
  

  

    

    
      <a class="item" data-title="改变默认 StorageClass" href="/docs/tasks/administer-cluster/change-default-storage-class/"></a>
    
  

  

    

    
      <a class="item" data-title="Kubernetes 云管理控制器" href="/docs/tasks/administer-cluster/running-cloud-controller/"></a>
    
  

  

    

    
      <a class="item" data-title="开发云管理控制器（Cloud Controller Manager）" href="/docs/tasks/administer-cluster/developing-cloud-controller-manager/"></a>
    
  

  

    

    
      <a class="item" data-title="建立高可用 Kubernetes Master" href="/docs/tasks/administer-cluster/highly-available-master/"></a>
    
  

  

    

    
      <a class="item" data-title="配置多个调度器" href="/docs/tasks/administer-cluster/configure-multiple-schedulers/"></a>
    
  

  

    

    
      <a class="item" data-title="IP 伪装代理用户指南" href="/docs/tasks/administer-cluster/ip-masq-agent/"></a>
    
  

  

    

    
      <a class="item" data-title="配置 DNS 服务" href="/docs/tasks/administer-cluster/dns-custom-nameservers/"></a>
    
  

  

    

    
      <a class="item" data-title="调试 DNS 解析" href="/docs/tasks/administer-cluster/dns-debugging-resolution/"></a>
    
  

  

    

    
      <a class="item" data-title="" href="/docs/tasks/administer-cluster/pvc-protection/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Federation - Run an App on Multiple Clusters">
      <div class="container">
        
  

    

    
      <a class="item" data-title="使用联邦服务进行跨集群服务发现" href="/docs/tasks/federation/federation-service-discovery/"></a>
    
  

  

    

    
      <a class="item" data-title="使用 Kubefed 创建集群联邦" href="/docs/tasks/federation/set-up-cluster-federation-kubefed/"></a>
    
  

  

    

    
      <a class="item" data-title="设置 CoreDNS 作为集群联邦的 DNS 提供商" href="/docs/tasks/federation/set-up-coredns-provider-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="在联邦中设置放置策略" href="/docs/tasks/federation/set-up-placement-policies-federation/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦集群" href="/docs/tasks/administer-federation/cluster/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 ConfigMap" href="/docs/tasks/administer-federation/configmap/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 DaemonSet" href="/docs/tasks/administer-federation/daemonset/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 Deployment" href="/docs/tasks/administer-federation/deployment/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 Event" href="/docs/tasks/administer-federation/events/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦横向 Pod 伸缩器（Horizontal Pod Autoscalers, HPA）" href="/docs/tasks/administer-federation/hpa/"></a>
    
  

  

    

    
      <a class="item" data-title="Federated Ingress" href="/docs/tasks/administer-federation/ingress/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 Job" href="/docs/tasks/administer-federation/job/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦命名空间" href="/docs/tasks/administer-federation/namespaces/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 ReplicaSet" href="/docs/tasks/administer-federation/replicaset/"></a>
    
  

  

    

    
      <a class="item" data-title="联邦 Secret" href="/docs/tasks/administer-federation/secret/"></a>
    
  


      </div>
    </div>
  

  
    <div class="item" data-title="Manage Cluster Daemons">
      <div class="container">
        
  

    

    
      <a class="item" data-title="Perform a Rolling Update on a DaemonSet" href="/docs/tasks/manage-daemon/update-daemon-set/"></a>
    
  

  

    

    
      <a class="item" data-title="对 DaemonSet 执行回滚" href="/docs/tasks/manage-daemon/rollback-daemon-set/"></a>
    
  


      </div>
    </div>
  

  

    

    
      <a class="item" data-title="Manage GPUs" href="/docs/tasks/manage-gpus/scheduling-gpus/"></a>
    
  

  

    

    
      <a class="item" data-title="Manage HugePages" href="/docs/tasks/manage-hugepages/scheduling-hugepages/"></a>
    
  

  

    

    
      <a class="item" data-title="Extend kubectl with plugins" href="/docs/tasks/extend-kubectl/kubectl-plugins/"></a>
    
  

  

    

    
      <a class="item" data-title="Troubleshooting" href="/docs/tasks/debug-application-cluster/troubleshooting/"></a>
    
  


        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
  </div> <!-- /docsToc -->

  <div id="docsContent">
        <p><a href="/editdocs#docs/tasks/administer-cluster/out-of-resource.md" id="editPageButton">Edit This Page</a></p>

        
          <h1>配置资源不足处理方式</h1>
        

        <ul id="markdown-toc">
  <li><a href="#移除策略" id="markdown-toc-移除策略">移除策略</a>    <ul>
      <li><a href="#移除信号" id="markdown-toc-移除信号">移除信号</a></li>
      <li><a href="#移除门限" id="markdown-toc-移除门限">移除门限</a>        <ul>
          <li><a href="#软移除门限" id="markdown-toc-软移除门限">软移除门限</a></li>
          <li><a href="#硬移除门限" id="markdown-toc-硬移除门限">硬移除门限</a></li>
        </ul>
      </li>
      <li><a href="#移除监控时间间隔" id="markdown-toc-移除监控时间间隔">移除监控时间间隔</a></li>
      <li><a href="#节点状态" id="markdown-toc-节点状态">节点状态</a></li>
      <li><a href="#节点状态振荡" id="markdown-toc-节点状态振荡">节点状态振荡</a></li>
      <li><a href="#回收节点层级资源" id="markdown-toc-回收节点层级资源">回收节点层级资源</a>        <ul>
          <li><a href="#使用-imagefs" id="markdown-toc-使用-imagefs">使用 Imagefs</a></li>
          <li><a href="#未使用-imagefs" id="markdown-toc-未使用-imagefs">未使用 Imagefs</a></li>
        </ul>
      </li>
      <li><a href="#移除最终用户的-pod" id="markdown-toc-移除最终用户的-pod">移除最终用户的 pod</a>        <ul>
          <li><a href="#使用-imagefs-1" id="markdown-toc-使用-imagefs-1">使用 Imagefs</a></li>
          <li><a href="#未使用-imagefs-1" id="markdown-toc-未使用-imagefs-1">未使用 Imagefs</a></li>
        </ul>
      </li>
      <li><a href="#最小移除回收" id="markdown-toc-最小移除回收">最小移除回收</a></li>
      <li><a href="#调度器" id="markdown-toc-调度器">调度器</a></li>
    </ul>
  </li>
  <li><a href="#节点-oom-行为" id="markdown-toc-节点-oom-行为">节点 OOM 行为</a></li>
  <li><a href="#最佳实践" id="markdown-toc-最佳实践">最佳实践</a>    <ul>
      <li><a href="#可调度资源和移除策略" id="markdown-toc-可调度资源和移除策略">可调度资源和移除策略</a></li>
      <li><a href="#daemonset" id="markdown-toc-daemonset">DaemonSet</a></li>
    </ul>
  </li>
  <li><a href="#弃用现有特性标签以回收磁盘" id="markdown-toc-弃用现有特性标签以回收磁盘">弃用现有特性标签以回收磁盘</a></li>
  <li><a href="#已知问题" id="markdown-toc-已知问题">已知问题</a>    <ul>
      <li><a href="#kubelet-可能无法立即发现内存压力" id="markdown-toc-kubelet-可能无法立即发现内存压力">kubelet 可能无法立即发现内存压力</a></li>
      <li><a href="#kubelet-可能会移除超过需求数量的-pod" id="markdown-toc-kubelet-可能会移除超过需求数量的-pod">kubelet 可能会移除超过需求数量的 pod</a></li>
      <li><a href="#kubelet-响应-inode-耗尽时如何对待移除-pod-排名" id="markdown-toc-kubelet-响应-inode-耗尽时如何对待移除-pod-排名">Kubelet 响应 inode 耗尽时如何对待移除 pod 排名</a></li>
    </ul>
  </li>
</ul>

<p>当可用计算资源较少时，<code class="highlighter-rouge">kubelet</code> 需要保证节点稳定性。</p>

<p>这在处理如内存和硬盘之类的不可压缩资源时尤为重要。</p>

<p>如果任意一种资源耗尽，节点将会变得不稳定。</p>

<h2 id="移除策略">移除策略</h2>

<p><code class="highlighter-rouge">kubelet</code> 能够主动监测和防止计算资源的全面短缺。在那种情况下，<code class="highlighter-rouge">kubelet</code> 可以主动的结束一个或多个 pod 以回收短缺的资源。当 <code class="highlighter-rouge">kubelet</code> 结束一个 pod 时，它将终止 pod 中的所有容器，而 pod 的 <code class="highlighter-rouge">PodPhase</code> 将变为 <code class="highlighter-rouge">Failed</code>。</p>

<h3 id="移除信号">移除信号</h3>

<p><code class="highlighter-rouge">kubelet</code> 支持按照以下表格中描述的信号触发移除决定。每个信号的值在 description 列描述，基于 <code class="highlighter-rouge">kubelet</code> 摘要 API。</p>

<table>
  <thead>
    <tr>
      <th>Eviction Signal</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">memory.available</code></td>
      <td><code class="highlighter-rouge">memory.available</code> := <code class="highlighter-rouge">node.status.capacity[memory]</code> - <code class="highlighter-rouge">node.stats.memory.workingSet</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodefs.available</code></td>
      <td><code class="highlighter-rouge">nodefs.available</code> := <code class="highlighter-rouge">node.stats.fs.available</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">nodefs.inodesFree</code></td>
      <td><code class="highlighter-rouge">nodefs.inodesFree</code> := <code class="highlighter-rouge">node.stats.fs.inodesFree</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">imagefs.available</code></td>
      <td><code class="highlighter-rouge">imagefs.available</code> := <code class="highlighter-rouge">node.stats.runtime.imagefs.available</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">imagefs.inodesFree</code></td>
      <td><code class="highlighter-rouge">imagefs.inodesFree</code> := <code class="highlighter-rouge">node.stats.runtime.imagefs.inodesFree</code></td>
    </tr>
  </tbody>
</table>

<p>上面的每个信号都支持字面值或百分比的值。基于百分比的值的计算与每个信号对应的总容量相关。</p>

<p><code class="highlighter-rouge">memory.available</code> 的值从 cgroupfs 获取，而不是通过类似 <code class="highlighter-rouge">free -m</code> 的工具。这很重要，因为 <code class="highlighter-rouge">free -m</code> 不能在容器中工作，并且如果用户使用了  <a href="/docs/tasks/administer-cluster/reserve-compute-resources/#node-allocatable">可分配节点</a> 特性，资源不足的判定将同时在本地 cgroup 层次结构的终端用户 pod 部分和根节点做出。这个 <a href="/docs/concepts/cluster-administration/out-of-resource/memory-available.sh">脚本</a> 复现了与 <code class="highlighter-rouge">kubelet</code> 计算 <code class="highlighter-rouge">memory.available</code> 相同的步骤。<code class="highlighter-rouge">kubelet</code> 将  inactive_file（意即活动 LRU 列表上基于文件后端的内存字节数）从计算中排除，因为它假设内存在出现压力时将被回收。</p>

<p><code class="highlighter-rouge">kubelet</code> 只支持两种文件系统分区。</p>

<ol>
  <li><code class="highlighter-rouge">nodefs</code> 文件系统，kubelet 将其用于卷和守护程序日志等。</li>
  <li><code class="highlighter-rouge">imagefs</code> 文件系统，容器运行时用于保存镜像和容器可写层。</li>
</ol>

<p><code class="highlighter-rouge">imagefs</code> 可选。<code class="highlighter-rouge">kubelet</code> 使用 cAdvisor 自动发现这些文件系统。<code class="highlighter-rouge">kubelet</code> 不关心其它文件系统。当前不支持配置任何其它类型。例如，在专用 <code class="highlighter-rouge">文件系统</code> 中存储卷和日志是<em>不可以的</em>。</p>

<p>在将来的发布中，<code class="highlighter-rouge">kubelet</code> 将废除当前存在的  <a href="/docs/concepts/cluster-administration/kubelet-garbage-collection/">垃圾回收</a> 机制，这种机制目前支持将移除操作作为对磁盘压力的响应。</p>

<h3 id="移除门限">移除门限</h3>

<p><code class="highlighter-rouge">kubelet</code> 支持指定移除门限，用于触发 <code class="highlighter-rouge">kubelet</code> 回收资源。</p>

<p>每个门限的形式如下：</p>

<p><code class="highlighter-rouge">&lt;eviction-signal&gt;&lt;operator&gt;&lt;quantity&gt;</code></p>

<ul>
  <li>合法的 <code class="highlighter-rouge">eviction-signal</code> 标志如上所示。</li>
  <li>合法的 <code class="highlighter-rouge">operator</code> 标志为 <code class="highlighter-rouge">&lt;</code>，</li>
  <li>合法的 <code class="highlighter-rouge">quantity</code> 标志必须匹配 Kubernetes 使用的数量表示。</li>
  <li>以 <code class="highlighter-rouge">%</code> 标志结尾的移除门限表示百分比。</li>
</ul>

<p>举例说明，如果一个节点有 <code class="highlighter-rouge">10Gi</code> 内存，希望在可用内存下降到 <code class="highlighter-rouge">1Gi</code> 以下时引起移除操作，则移除门限可以使用下面任意一种方式指定（但不是两者同时）。</p>

<ul>
  <li><code class="highlighter-rouge">memory.available&lt;10%</code></li>
  <li><code class="highlighter-rouge">memory.available&lt;1Gi</code></li>
</ul>

<h4 id="软移除门限">软移除门限</h4>

<p>软移除门限使用一对由移除门限和管理员必须指定的宽限期组成的配置对。在超过宽限期前，<code class="highlighter-rouge">kubelet</code> 不会采取任何动作回收和移除信号关联的资源。如果没有提供宽限期，<code class="highlighter-rouge">kubelet</code> 启动时将报错。</p>

<p>此外，如果达到了软移除门限，操作员可以指定从节点移除 pod 时，在宽限期内允许结束的 pod 的最大数量。如果指定了 <code class="highlighter-rouge">pod.Spec.TerminationGracePeriodSeconds</code> 值，<code class="highlighter-rouge">kubelet</code> 将使用它和宽限期二者中较小的一个。如果没有指定，<code class="highlighter-rouge">kubelet</code> 将立即终止 pod，而不会优雅结束它们。</p>

<p>软移除门限的配置支持下列标记：</p>

<ul>
  <li><code class="highlighter-rouge">eviction-soft</code> 描述了移除门限的集合（例如 <code class="highlighter-rouge">memory.available&lt;1.5Gi</code>），如果在宽限期之外满足条件将触发 pod 移除。</li>
  <li><code class="highlighter-rouge">eviction-soft-grace-period</code> 描述了移除宽限期的集合（例如 <code class="highlighter-rouge">memory.available=1m30s</code>），对应于在移除 pod 前软移除门限应该被控制的时长。</li>
  <li><code class="highlighter-rouge">eviction-max-pod-grace-period</code> 描述了当满足软移除门限并终止 pod 时允许的最大宽限期值（秒数）。</li>
</ul>

<h4 id="硬移除门限">硬移除门限</h4>

<p>硬移除门限没有宽限期，一旦察觉，<code class="highlighter-rouge">kubelet</code> 将立即采取行动回收关联的短缺资源。如果满足硬移除门限，<code class="highlighter-rouge">kubelet</code> 将立即结束 pod 而不是优雅终止。</p>

<p>硬移除门限的配置支持下列标记：</p>

<ul>
  <li><code class="highlighter-rouge">eviction-hard</code> 描述了移除门限的集合（例如 <code class="highlighter-rouge">memory.available&lt;1Gi</code>），如果满足条件将触发 pod 移除。</li>
</ul>

<p><code class="highlighter-rouge">kubelet</code> 有如下所示的默认硬移除门限：</p>

<ul>
  <li><code class="highlighter-rouge">--eviction-hard=memory.available&lt;100Mi</code></li>
</ul>

<h3 id="移除监控时间间隔">移除监控时间间隔</h3>

<p><code class="highlighter-rouge">kubelet</code> 根据其配置的整理时间间隔计算移除门限。</p>

<ul>
  <li><code class="highlighter-rouge">housekeeping-interval</code> 是容器管理时间间隔。</li>
</ul>

<h3 id="节点状态">节点状态</h3>

<p><code class="highlighter-rouge">kubelet</code> 会将一个或多个移除信号映射到对应的节点状态。</p>

<p>如果满足硬移除门限，或者满足独立于其关联宽限期的软移除门限时，<code class="highlighter-rouge">kubelet</code> 将报告节点处于压力下的状态。</p>

<p>下列节点状态根据相应的移除信号定义。</p>

<table>
  <thead>
    <tr>
      <th>Node Condition</th>
      <th>Eviction Signal</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">MemoryPressure</code></td>
      <td><code class="highlighter-rouge">memory.available</code></td>
      <td>Available memory on the node has satisfied an eviction threshold</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DiskPressure</code></td>
      <td><code class="highlighter-rouge">nodefs.available</code>, <code class="highlighter-rouge">nodefs.inodesFree</code>, <code class="highlighter-rouge">imagefs.available</code>, or <code class="highlighter-rouge">imagefs.inodesFree</code></td>
      <td>Available disk space and inodes on either the node’s root filesytem or image filesystem has satisfied an eviction threshold</td>
    </tr>
  </tbody>
</table>

<p><code class="highlighter-rouge">kubelet</code> 将以 <code class="highlighter-rouge">--node-status-update-frequency</code> 指定的频率连续报告节点状态更新，其默认值为 <code class="highlighter-rouge">10s</code>。</p>

<h3 id="节点状态振荡">节点状态振荡</h3>

<p>如果节点在软移除门限的上下振荡，但没有超过关联的宽限期时，将引起对应节点的状态持续在 true 和 false 间跳变，并导致不好的调度结果。</p>

<p>为了防止这种振荡，可以定义下面的标志，用于控制 <code class="highlighter-rouge">kubelet</code> 从压力状态中退出之前必须等待的时间。</p>

<ul>
  <li><code class="highlighter-rouge">eviction-pressure-transition-period</code> 是 <code class="highlighter-rouge">kubelet</code> 从压力状态中退出之前必须等待的时长。</li>
</ul>

<p><code class="highlighter-rouge">kubelet</code> 将确保在设定的时间段内没有发现和指定压力条件相对应的移除门限被满足时，才会将状态变回 <code class="highlighter-rouge">false</code>。</p>

<h3 id="回收节点层级资源">回收节点层级资源</h3>

<p>如果满足移除门限并超过了宽限期，<code class="highlighter-rouge">kubelet</code> 将启动回收压力资源的过程，直到它发现低于设定门限的信号为止。</p>

<p><code class="highlighter-rouge">kubelet</code> 将尝试在移除终端用户 pod 前回收节点层级资源。发现磁盘压力时，如果节点针对容器运行时配置有独占的 <code class="highlighter-rouge">imagefs</code>，<code class="highlighter-rouge">kubelet</code> 回收节点层级资源的方式将会不同。</p>

<h4 id="使用-imagefs">使用 Imagefs</h4>

<p>如果 <code class="highlighter-rouge">nodefs</code> 满足移除门限，<code class="highlighter-rouge">kubelet</code> 将以下面的顺序释放磁盘空间：</p>

<ol>
  <li>删除停止运行的 pod/container</li>
</ol>

<p>如果 <code class="highlighter-rouge">imagefs</code> 满足移除门限，<code class="highlighter-rouge">kubelet</code> 将以下面的顺序释放磁盘空间：</p>

<ol>
  <li>删除全部没有使用的镜像</li>
</ol>

<h4 id="未使用-imagefs">未使用 Imagefs</h4>

<p>如果 <code class="highlighter-rouge">nodefs</code> 满足移除门限，<code class="highlighter-rouge">kubelet</code> 将以下面的顺序释放磁盘空间：</p>

<ol>
  <li>删除停止运行的 pod/container</li>
  <li>删除全部没有使用的镜像</li>
</ol>

<h3 id="移除最终用户的-pod">移除最终用户的 pod</h3>

<p>如果 <code class="highlighter-rouge">kubelet</code> 在节点上无法回收足够的资源，它将开始移除 pod。</p>

<p><code class="highlighter-rouge">kubelet</code> 按如下项目对要移除的 pod 排名：</p>

<ul>
  <li>按其 service 质量。</li>
  <li>按和 pod 调度请求关联的短缺计算资源消耗情况。</li>
</ul>

<p>因此，pod 的移除按以下顺序发生：</p>

<ul>
  <li>消耗最多短缺资源的 <code class="highlighter-rouge">BestEffort</code> pod 首先被终止。</li>
  <li>消耗最多与其请求资源关联的短缺资源的 <code class="highlighter-rouge">Burstable</code> pod 将被优先终止。如果没有 pod 超出它们的请求量，移除策略将以短缺资源最大的消耗者作为目标。</li>
</ul>

<p><code class="highlighter-rouge">Guaranteed</code> 的 pod 保证绝对不会因为其它 pod 的资源消耗而被移除。如果系统守护进程（也就是 <code class="highlighter-rouge">kubelet</code>、<code class="highlighter-rouge">docker</code>、<code class="highlighter-rouge">journald</code> 等）使用的资源比 <code class="highlighter-rouge">system-reserved</code> 或者 <code class="highlighter-rouge">kube-reserved</code> 分配的更多，且节点上只有 <code class="highlighter-rouge">Guaranteed</code> 类型 pod 运行时，节点必须选择结束 <code class="highlighter-rouge">Guaranteed</code> pod 以保证稳定性并限制未知消耗对其它 <code class="highlighter-rouge">Guaranteed</code> pod 的冲击。</p>

<p>本地磁盘是一种 <code class="highlighter-rouge">BestEffort</code> 资源。如果有需要，在遭遇  <code class="highlighter-rouge">DiskPressure</code> 时，<code class="highlighter-rouge">kubelet</code> 将每次一个的移除 pod。<code class="highlighter-rouge">kubelet</code> 将按照 service 质量对 pod 排名。当 <code class="highlighter-rouge">kubelet</code> 响应 <code class="highlighter-rouge">inode</code> 短缺时，它将首先移除具有最低 service 质量的 pod 来回收 <code class="highlighter-rouge">inodes</code>。当 <code class="highlighter-rouge">kubelet</code> 响应可用磁盘短缺时，它将对某种服务质量内消耗最多磁盘的 pod 排名并结束它们。</p>

<h4 id="使用-imagefs-1">使用 Imagefs</h4>

<p>如果 <code class="highlighter-rouge">nodefs</code> 触发移除，<code class="highlighter-rouge">kubelet</code> 将按 <code class="highlighter-rouge">nodefs</code> 用量 - 本地卷 + pod 的所有容器日志的总和对其排序。</p>

<p>如果是 <code class="highlighter-rouge">imagefs</code> 触发移除，<code class="highlighter-rouge">kubelet</code> 将按 pod 所有可写层的用量对其进行排序。</p>

<h4 id="未使用-imagefs-1">未使用 Imagefs</h4>

<p>如果 <code class="highlighter-rouge">nodefs</code> 触发移除，<code class="highlighter-rouge">kubelet</code> 将按 <code class="highlighter-rouge">nodefs</code> 用量 - 本地卷 + pod 的所有容器日志的总和对其排序。</p>

<h3 id="最小移除回收">最小移除回收</h3>

<p>在某些场景，移除 pod 会导致回收少量资源。这将导致 <code class="highlighter-rouge">kubelet</code> 反复碰到移除门限。除此之外，对如 <code class="highlighter-rouge">disk</code> 这类资源的移除时比较耗时的。</p>

<p>为了减少这类问题，<code class="highlighter-rouge">kubelet</code> 可以为每个资源配置一个 <code class="highlighter-rouge">minimum-reclaim</code>。当 <code class="highlighter-rouge">kubelet</code> 发现资源压力时，<code class="highlighter-rouge">kubelet</code> 将尝试至少回收移除门限之下 <code class="highlighter-rouge">minimum-reclaim</code> 数量的资源。</p>

<p>例如使用下面的配置：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--eviction-hard=memory.available&lt;500Mi,nodefs.available&lt;1Gi,imagefs.available&lt;100Gi
--eviction-minimum-reclaim="memory.available=0Mi,nodefs.available=500Mi,imagefs.available=2Gi"`
</code></pre></div></div>

<p>如果 <code class="highlighter-rouge">memory.available</code> 移除门限被触发，<code class="highlighter-rouge">kubelet</code> 将保证 <code class="highlighter-rouge">memory.available</code> 至少为 <code class="highlighter-rouge">500Mi</code>。对于  <code class="highlighter-rouge">nodefs.available</code>，<code class="highlighter-rouge">kubelet</code> 将保证 <code class="highlighter-rouge">nodefs.available</code> 至少为 <code class="highlighter-rouge">1.5Gi</code>。对于 <code class="highlighter-rouge">imagefs.available</code>，<code class="highlighter-rouge">kubelet</code> 将保证 <code class="highlighter-rouge">imagefs.available</code> 至少为 <code class="highlighter-rouge">102Gi</code>，直到不再有相关资源报告压力为止。</p>

<p>所有资源的默认 <code class="highlighter-rouge">eviction-minimum-reclaim</code> 值为 <code class="highlighter-rouge">0</code>。</p>

<h3 id="调度器">调度器</h3>

<p>当资源处于压力之下时，节点将报告状态。调度器将那种状态视为一种信号，阻止更多 pod 调度到这个节点上。</p>

<table>
  <thead>
    <tr>
      <th>Node Condition</th>
      <th>Scheduler Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">MemoryPressure</code></td>
      <td>No new <code class="highlighter-rouge">BestEffort</code> pods are scheduled to the node.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">DiskPressure</code></td>
      <td>No new pods are scheduled to the node.</td>
    </tr>
  </tbody>
</table>

<h2 id="节点-oom-行为">节点 OOM 行为</h2>

<p>如果节点在 <code class="highlighter-rouge">kubelet</code> 回收内存之前经历了系统 OOM(out of memory，内存不足) 事件，它将基于  <a href="https://lwn.net/Articles/391222/">oom_killer</a> 做出响应。</p>

<p><code class="highlighter-rouge">kubelet</code> 基于 pod 的 service 质量为每个容器设置一个 <code class="highlighter-rouge">oom_score_adj</code> 值。</p>

<table>
  <thead>
    <tr>
      <th>Quality of Service</th>
      <th>oom_score_adj</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Guaranteed</code></td>
      <td>-998</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">BestEffort</code></td>
      <td>1000</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Burstable</code></td>
      <td>min(max(2, 1000 - (1000 * memoryRequestBytes) / machineMemoryCapacityBytes), 999)</td>
    </tr>
  </tbody>
</table>

<p>如果 <code class="highlighter-rouge">kubelet</code> 在节点经历系统 OOM 之前无法回收内存，<code class="highlighter-rouge">oom_killer</code> 将基于它在节点上使用的内存百分比算出一个 <code class="highlighter-rouge">oom_score</code>，并加上 <code class="highlighter-rouge">oom_score_adj</code> 得到容器的有效 <code class="highlighter-rouge">oom_score</code>，然后结束得分最高的容器。</p>

<p>预期的行为应该是拥有最低 service 质量并消耗和调度请求相关内存量最多的容器第一个被结束，以回收内存。</p>

<p>和 pod 移除不同，如果一个 pod 的容器是被 OOM 结束的，基于其 <code class="highlighter-rouge">RestartPolicy</code>，它可能会被 <code class="highlighter-rouge">kubelet</code> 重新启动。</p>

<h2 id="最佳实践">最佳实践</h2>

<h3 id="可调度资源和移除策略">可调度资源和移除策略</h3>

<p>想象一下下面的场景：</p>

<ul>
  <li>节点内存容量：<code class="highlighter-rouge">10Gi</code></li>
  <li>操作员希望为系统守护进程保留 10% 内存容量（内核、<code class="highlighter-rouge">kubelet</code> 等）。</li>
  <li>操作员希望在内存用量达到 95% 时移除 pod，以减少对系统的冲击并防止系统 OOM 的发生。</li>
</ul>

<p>为了促成这个场景，<code class="highlighter-rouge">kubelet</code> 将像下面这样启动：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--eviction-hard=memory.available&lt;500Mi
--system-reserved=memory=1.5Gi
</code></pre></div></div>

<p>这个配置的暗示是理解“系统保留”应该包含被移除门限覆盖的内存数量。</p>

<p>要达到这个容量，要么某些 pod 使用了超过它们请求的资源，要么系统使用的内存超过 <code class="highlighter-rouge">500Mi</code>。</p>

<p>这个配置将保证在 pod 使用量都不超过它们配置的请求值时，如果可能立即引起内存压力并触发移除时，调度器不会将 pod 放到这个节点上。</p>

<h3 id="daemonset">DaemonSet</h3>

<p>我们永远都不希望 <code class="highlighter-rouge">kubelet</code> 移除一个从 <code class="highlighter-rouge">DaemonSet</code> 派生的 pod，因为这个 pod 将立即被重建并调度回相同的节点。</p>

<p>目前，<code class="highlighter-rouge">kubelet</code> 没有办法区分一个 pod 是由 <code class="highlighter-rouge">DaemonSet</code> 还是其他对象创建。如果/当这个信息可用时，<code class="highlighter-rouge">kubelet</code> 可能会预先将这些 pod 从提供给移除策略的候选集合中过滤掉。</p>

<p>总之，强烈推荐 <code class="highlighter-rouge">DaemonSet</code> 不要创建 <code class="highlighter-rouge">BestEffort</code> 的 pod，防止其被识别为移除的候选 pod。相反，理想情况下 <code class="highlighter-rouge">DaemonSet</code> 应该启动 <code class="highlighter-rouge">Guaranteed</code> 的 pod。</p>

<h2 id="弃用现有特性标签以回收磁盘">弃用现有特性标签以回收磁盘</h2>

<p><code class="highlighter-rouge">kubelet</code> 已经按需求清空了磁盘空间以保证节点稳定性。</p>

<p>当磁盘移除成熟时，下面的 <code class="highlighter-rouge">kubelet</code> 标志将被标记为废弃的，以简化支持移除的配置。</p>

<table>
  <thead>
    <tr>
      <th>Existing Flag</th>
      <th>New Flag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">--image-gc-high-threshold</code></td>
      <td><code class="highlighter-rouge">--eviction-hard</code> or <code class="highlighter-rouge">eviction-soft</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--image-gc-low-threshold</code></td>
      <td><code class="highlighter-rouge">--eviction-minimum-reclaim</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--maximum-dead-containers</code></td>
      <td>deprecated</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--maximum-dead-containers-per-container</code></td>
      <td>deprecated</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--minimum-container-ttl-duration</code></td>
      <td>deprecated</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--low-diskspace-threshold-mb</code></td>
      <td><code class="highlighter-rouge">--eviction-hard</code> or <code class="highlighter-rouge">eviction-soft</code></td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--outofdisk-transition-frequency</code></td>
      <td><code class="highlighter-rouge">--eviction-pressure-transition-period</code></td>
    </tr>
  </tbody>
</table>

<h2 id="已知问题">已知问题</h2>

<h3 id="kubelet-可能无法立即发现内存压力">kubelet 可能无法立即发现内存压力</h3>

<p><code class="highlighter-rouge">kubelet</code> 当前通过以固定的时间间隔轮询  <code class="highlighter-rouge">cAdvisor</code> 来收集内存使用数据。如果内存使用在那个时间窗口内迅速增长，<code class="highlighter-rouge">kubelet</code> 可能不能足够快的发现  <code class="highlighter-rouge">MemoryPressure</code>， <code class="highlighter-rouge">OOMKiller</code> 将不会被调用。我们准备在将来的发行版本中通过集成 <code class="highlighter-rouge">memcg</code> 通知 API 来减小这种延迟。当超过门限时，内核将立即告诉我们。</p>

<p>如果您想处理可察觉的超量使用而不要求极端精准，可以设置移除门限为大约 75% 容量作为这个问题的变通手段。这将增强这个特性的能力，防止系统 OOM，并提升负载卸载能力，以再次平衡集群状态。</p>

<h3 id="kubelet-可能会移除超过需求数量的-pod">kubelet 可能会移除超过需求数量的 pod</h3>

<p>由于状态采集的时间差，移除操作可能移除比所需的更多的 pod。将来可通过添加从根容器获取所需状态的能力 <a href="https://github.com/google/cadvisor/issues/1247">(https://github.com/google/cadvisor/issues/1247)</a> 来减缓这种状况。</p>

<h3 id="kubelet-响应-inode-耗尽时如何对待移除-pod-排名">Kubelet 响应 inode 耗尽时如何对待移除 pod 排名</h3>

<p>目前，要知道某个特定的容器消耗了多少 inode 是一件不可能的事情。如果 <code class="highlighter-rouge">kubelet</code> 发现 inode 耗尽，它将按照 pod 的 service 质量排名删除它们。下面这个在 cadvisor 项目中开放的问题是关于如何追踪每个容器的 inode 使用量 <a href="https://github.com/google/cadvisor/issues/1422">(https://github.com/google/cadvisor/issues/1422)</a>，以允许我们按 pod 的 inode 使用量对其排名。例如，这可以让我们识别一个创建了大量 0 比特文件的容器并删除它。</p>


        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/tasks/administer-cluster/out-of-resource.md?pixel" alt="Analytics" /></a></p>
        
        
        <script type="text/javascript">
            PDRTJS_settings_8345992 = {
                "id" : "8345992",
                "unique_id" : "/docs/tasks/administer-cluster/out-of-resource/",
                "title" : "配置资源不足处理方式",
                "permalink" : "https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/"
            };
            (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
        <a href="" onclick="window.open('https://github.com/kubernetes/website/issues/new?title=Issue%20with%20' +
        'k8s.io'+window.location.pathname)" class="button issue">Create an Issue</a>
        
        
          <a href="/editdocs#docs/tasks/administer-cluster/out-of-resource.md" class="button issue">Edit this Page</a>
        
    
    </div>
</section>

<footer>
    <main class="light-text">
        <nav>
            <a href="/docs/tutorials/stateless-application/hello-minikube/">Get Started</a>
            <a href="/docs/home/">Documentation</a>
            <a href="http://blog.kubernetes.io/">Blog</a>
            <a href="/partners/">Partners</a>
            <a href="/community/">Community</a>
            <a href="/case-studies/">Case Studies</a>
        </nav>
        <div class="social">
            <div>
                <a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
                <a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
                <a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
            </div>
            <div>
                <a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
                <a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
                <a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
            </div>
            <div>
                <a href="/docs/setup/pick-right-solution/" class="button">Get Kubernetes</a>
                <a href="https://github.com/kubernetes/kubernetes" class="button">Contribute</a>
            </div>
        </div>
        <div id="miceType" class="center">
            &copy; 2018 The Kubernetes Authors | Documentation Distributed under <a href="https://git.k8s.io/website/LICENSE" class="light-text">CC BY 4.0</a>
        </div>
        <div id="miceType" class="center">
            Copyright &copy; 2018 The Linux Foundation&reg;. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href="https://www.linuxfoundation.org/trademark-usage" class="light-text">Trademark Usage page</a>
        </div>
    </main>
</footer>

<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
.cse .gsc-control-cse, .gsc-control-cse, {
    padding: 0;
}
  .gsc-control-cse table, .gsc-control-cse-en table {
      margin:0px !important;
  }
  .gsc-above-wrapper-area {
      border-bottom: 0;
  }
</style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-36037335-10', 'auto');
ga('send', 'pageview');

// hide docs nav area if no nav is present, or if nav only contains a link to the current page
(function () {
    window.addEventListener('DOMContentLoaded', init)

        // play nice with our neighbors
        function init() {
            window.removeEventListener('DOMContentLoaded', init)
                hideNav()
        }

    function hideNav(toc){
        if (!toc) toc = document.querySelector('#docsToc')
        if (!toc) return
            var container = toc.querySelector('.container')

                // container is built dynamically, so it may not be present on the first runloop
                if (container) {
                    if (container.childElementCount === 0 || toc.querySelectorAll('a.item').length === 1) {
                        toc.style.display = 'none'
                            document.getElementById('docsContent').style.width = '100%'
                    }
                } else {
                    requestAnimationFrame(function () {
                        hideNav(toc)
                    })
                }
    }
})();
</script>

<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
    <!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->


</body>
</html>
