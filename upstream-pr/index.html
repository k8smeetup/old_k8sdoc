<h1 id="上游文档贡献流程">上游文档贡献流程</h1>

<p>时间：2017-08-29 更新时间： 2017-09-26 作者：何小龙@caicloud.io 才云科技</p>

<p>为避免向上游社区提交的 <code class="highlighter-rouge">PR</code> 长时间不处理，不能及时 <code class="highlighter-rouge">Merge</code>。这里要求提交 <code class="highlighter-rouge">PR</code> 的译者及时回复。如果对上游 review 两周都没有回复，表示本人允许其他译者在其基础上重新修改提交 <code class="highlighter-rouge">PR</code>。另外由于上游的 Merge 工作量很大，而且大家的翻译已经在 K8SMeetup 已经有初步 Review, 针对短的文章，一个 PR 可以提 2 至 3 篇，长的文章，一个 PR 就提一个文件。</p>

<h4 id="针对近两个月的翻译试运行情况制定了如下的激励措施">针对近两个月的翻译试运行情况，制定了如下的激励措施：</h4>

<ol>
  <li>翻译文章数 30篇 + review 文章数 20篇 可以获得社区赠书一本</li>
  <li>由于译者可以向上游提交贡献，对校对者没有实质激励，在周报里除增加译者外，增加校对者的名字和<code class="highlighter-rouge">Github</code>链接</li>
  <li>周报增加校对者的贡献(以 1250 中文字为基准，对应译文权重为 0.8)</li>
  <li>增加译文权重，统计中文字数（以 1000 中文字为基准 1.0 权重）即文章越长，权重越高。</li>
  <li>鼓励大家结对 <code class="highlighter-rouge">review</code> 校对者校对完成 <code class="highlighter-rouge">cc @markthink @zhangxiaoyu-zidif</code> 即可，系统会完成 <code class="highlighter-rouge">merge</code></li>
</ol>

<p>目前 K8SMeetup 翻译社区的 Merge 可以直接 <code class="highlighter-rouge">cc @markthink</code>，上游 文档的 Merge 可以直接 <code class="highlighter-rouge">cc @zhangxiaoyu-zidif</code>。</p>

<p>按这样流程可以最快保证翻译的文章在两周之内 <code class="highlighter-rouge">Merge</code> 至上游文档库。</p>

<p>如果您还没有自己的 <code class="highlighter-rouge">Github</code> 账户, 可以按下面的方式注册一个。Kubernetes 中文社区的文档都是在 Github 完成翻译协作的，因此注册账户是必须步骤。</p>

<p>提交PR后一定要记得更新<a href="https://docs.google.com/spreadsheets/d/1FDFCv9RK5nSMgLXhPrJ5k7r5QvHnNEFnXbvoFiM8v20/edit#gid=1015862274">任务表</a> <code class="highlighter-rouge">Upstream Pull Request link</code>,方便我们 <code class="highlighter-rouge">Review</code> 跟进。</p>

<h2 id="step1-注册自己的代码托管账户">Step1. 注册自己的代码托管账户</h2>

<p><img src="media/15040131083654.jpg" alt="" /></p>

<p><img src="media/15040131486164.jpg" alt="" /></p>

<p><img src="media/15040132090871.jpg" alt="" /></p>

<p><img src="media/15040133559430.jpg" alt="" /></p>

<p><img src="media/15040133887523.jpg" alt="" /></p>

<p>邮箱验证完成，就可以开始我们的翻译之旅了…</p>

<h2 id="step2-fork-k8smeetup-翻译代码库和预览代码库">Step2. Fork K8SMeetup 翻译代码库和预览代码库</h2>

<p><img src="media/15040135830272.jpg" alt="" /></p>

<p><img src="media/15040136426199.jpg" alt="" /></p>

<p><img src="media/15040136772920.jpg" alt="" /></p>

<h2 id="step3-领取翻译任务并标记">Step3. 领取翻译任务并标记</h2>

<p>为了便于协作，任务表格存放在 Google Sheets 上面，需自行解决访问问题，有需要帮助的，可以在微信群里问。点击此<a href="https://docs.google.com/spreadsheets/d/1FDFCv9RK5nSMgLXhPrJ5k7r5QvHnNEFnXbvoFiM8v20/edit#gid=1015862274">链接</a>打开任务表格。</p>

<p>文章有六种状态，可参考翻译库的 README 说明：</p>

<p>领取任务，仅需更新 Status 、 Translator 两列，更新翻译状态，填写自己的姓名即可。</p>

<p>本文以首页 <code class="highlighter-rouge">/index.html</code> 翻译文件为例，首先领取任务，改变 <code class="highlighter-rouge">Status</code> 状态后，背景会自动标红，提示其他译者，此文已被领取。</p>

<p><img src="media/15040148141038.jpg" alt="" /></p>

<p><img src="media/15040147989903.jpg" alt="" /></p>

<h2 id="step4-k8smeetup-翻译过程状态变更">Step4. K8SMeetup 翻译过程状态变更</h2>

<p><img src="media/15040152170886.jpg" alt="" /></p>

<p>如上图，将 GITHUB 代码库克隆至本地。</p>

<p><img src="media/15040177196480.jpg" alt="" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/ &amp;&amp; mkdir brucehex
cd ~/brucehex
git clone https://github.com/brucehex/kubernetes.github.io.git
git clone https://github.com/brucehex/k8smeetup.github.io.git
</code></pre></div></div>

<p>建议使用 <code class="highlighter-rouge">atom</code> 安装 <code class="highlighter-rouge">markdown</code> 插件翻译文档，编辑器不做强制要求，建议翻译时看一下翻译库的 README 文档。</p>

<p>简单一句话：一段英文、一段中文，原始英文不要移除，有日期的版本文件不需要翻译，样例翻译：</p>

<p><img src="media/15040181823905.jpg" alt="" /></p>

<p>翻译完 <code class="highlighter-rouge">/index.html</code> 文件，提交到自己的代码仓库。</p>

<p><img src="media/15040183750403.jpg" alt="" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/brucehex/kubernetes.github.io
git add .
git commit -m 'index-pr-2017-08-15'
git push
</code></pre></div></div>

<p>建议 一个 PR 提交一个文件，方便 review, 翻译更新同步到自己的 github 代码库，同时更新任务表状态为 <code class="highlighter-rouge">Pull Request Sent</code>。</p>

<p><img src="media/15040148712332.jpg" alt="" /></p>

<p>进入自己的 GITHUB 翻译代码库，创建 K8SMeetup PR</p>

<p><img src="media/15040184624280.jpg" alt="" /></p>

<p><img src="media/15040184847039.jpg" alt="" /></p>

<p><img src="media/15040185401043.jpg" alt="" /></p>

<p><img src="media/15040185897252.jpg" alt="" /></p>

<p>同时更新任务表状态为 <code class="highlighter-rouge">Under Internal Review</code>,等待其他译者内部 review 。</p>

<p><img src="media/15040148330357.jpg" alt="" /></p>

<p><img src="media/15040186525586.jpg" alt="" /></p>

<p>其他译者可以能翻译文章进行评论，由译者修改更新，当内部 Review 完成，由管理员 Merge 代码仓库，任务表状态由 Merge 代码仓库权限的人更新翻译状态为 <code class="highlighter-rouge">Pull Request Merged</code>, 同时管理员每周会将已经 Merged 的文章同步更新到预览库中。
<img src="media/15040148994326.jpg" alt="" /></p>

<p><img src="media/15040188161563.jpg" alt="" /></p>

<p>每周我们会发布<a href="https://github.com/k8smeetup/kubernetes.github.io/blob/master/contribution.md">翻译周报</a>,含每周的译文和译者列表，各自的译者可以点击查看预览库翻译效果，如果有问题，在提新的PR，我们会及时更新。如果没有问题，就可以同步预览库，提取自己的翻译文档，向上游推送 PR。</p>

<p>注：建议向上游推送PR时，尽可能多篇一起提交，不建议一篇文档一个PR，上游的 PR 合并工作量很大，而且K8SMeetup 社区已经对翻译的内容进行了初步审核，因此多篇一次提交比较好。</p>

<h2 id="step5-查看任务表格和翻译效果链接">Step5. 查看任务表格和翻译效果链接</h2>

<p><img src="media/15040191690714.jpg" alt="" /></p>

<p><img src="media/15040192038983.jpg" alt="" /></p>

<p>通过预览库查看没有问题，此时就可以从预览库抽取我们的翻译文章了。</p>

<h2 id="step6-同步-k8smeetup-翻译文档库">Step6. 同步 K8SMeetup 翻译文档库</h2>

<p>进入我们自己的翻译库，查看翻译分支库：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/brucehex/kubernetes.github.io
git branch
</code></pre></div></div>

<p>当我们 <code class="highlighter-rouge">clone</code> 完一个项目，可以使用<code class="highlighter-rouge">git remote -v</code>来查看你fork的远程仓库的地址；默认的clone操作完成后，远端仓库的地址别名为：<code class="highlighter-rouge">origin</code>，为了需要与原项目保持更新，你还需要将原项目地址给添加进来，使用如下命令添加远端仓库地址:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 添加 Kubernetes 仓库(向上游提交 PR 使用)
git remote add k8s https://github.com/kubernetes/kubernetes.github.io.git
// 添加 K8SMeetup 仓库(同步 K8SMeetup 翻译库使用)
git remote add k8smeetup https://github.com/k8smeetup/kubernetes.github.io.git
</code></pre></div></div>
<p><img src="media/15040583956971.jpg" alt="" /></p>

<p>K8SMeetup 翻译文档库更新步骤:</p>

<ol>
  <li>打开<code class="highlighter-rouge">git</code>命令行工具，进入项目本地路径；</li>
  <li>执行<code class="highlighter-rouge">git fetch k8smeetup</code>命令，检出<code class="highlighter-rouge">k8smeetup</code>分支以及各自的更新；</li>
  <li>切换到自己的本地分支主干：<code class="highlighter-rouge">git checkout master</code></li>
  <li>命令:<code class="highlighter-rouge">git merge k8smeetup/master</code> 将原项目中的更改更新到本地分支，这样就能使本地的<code class="highlighter-rouge">fork</code>分支与原项目保持同步。</li>
  <li>执行<code class="highlighter-rouge">git push</code>将本地分支的修改推送到远端<code class="highlighter-rouge">fork</code>的项目；</li>
</ol>

<p><img src="media/15040604796842.jpg" alt="" /></p>

<p>更新同步翻译库至自己的 Github 仓库。
<img src="media/15040589928291.jpg" alt="" /></p>

<h2 id="step7-从预览库提取翻译文件向上游推送-pr">Step7. 从预览库提取翻译文件向上游推送 PR</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/works/brucehex/kubernetes.github.io
# 创建孤立分支
git checkout --orphan upstream
# 删除所有内容
git rm -rf .
# 拉取最新的 Kubernetes 官方文档库
git pull k8s master

# 将翻译文件移到 官方文档移到 `/cn/docs`目录
cp ../k8smeetup.github.io/index.html cn
git add .
git commit -m 'index-pr-2017-08-15'
git push origin upstream:upstream
</code></pre></div></div>
<p><img src="media/15040617387241.jpg" alt="" /></p>

<p>此时我们有一个新的分支 <code class="highlighter-rouge">upstream</code> 用于向 Kubernetes 官网提交 PR。</p>

<p><img src="media/15040618180389.jpg" alt="" /></p>

<p><img src="media/15040634913973.jpg" alt="" /></p>

<p><img src="media/15040635468308.jpg" alt="" /></p>

<p>提完 PR 记得更新任务表格 <code class="highlighter-rouge">Upstream Pull Request link</code> ，方便我们跟踪上游 Merge 进度。</p>

<p>此例更新地址：https://github.com/kubernetes/kubernetes.github.io/pull/5245</p>

<p><img src="media/15040639855099.jpg" alt="" /></p>

<p>接来我们 Review PR，Review PR 需要 CNCF 会员成员权限。</p>

<p><img src="media/15040640801241.jpg" alt="" /></p>

<p>至此，我们完成了此基础教程。</p>
